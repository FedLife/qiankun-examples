(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["system-recycle","system-recycle-utils"],{"650f":function(t,e,r){"use strict";var n;function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e,r){return e=i(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t){var e=c(t,"string");return"symbol"===o(e)?e:String(e)}function c(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}r.r(e),r.d(e,"RECYCLE_STATUS_ENUM",(function(){return u})),r.d(e,"recycleStatusMap",(function(){return l}));var u={DELETION:0,DELETED:1,DELETED_FAIL:2,DELETING:3,RESTORING:4,RESTORED:5},l=(n={},a(n,u.DELETION,{status:"待删除",tag:""}),a(n,u.DELETED,{status:"已删除",tag:"success"}),a(n,u.DELETED_FAIL,{status:"删除失败",tag:"danger"}),a(n,u.DELETING,{status:"删除中",tag:"warning"}),a(n,u.RESTORING,{status:"还原中",tag:"warning"}),a(n,u.RESTORED,{status:"已还原",tag:"success"}),n)},"78fd":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"head-container"},[r("cdOperation",[r("div",{attrs:{slot:"right"},slot:"right"},[r("el-button",{staticClass:"filter-item with-border",staticStyle:{padding:"8px"},attrs:{icon:"el-icon-refresh"},on:{click:t.onResetFresh}})],1)]),t._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.crud.loading,expression:"crud.loading"}],ref:"table",attrs:{data:t.crud.data,"highlight-current-row":""},on:{"selection-change":t.crud.selectionChangeHandler}},[r("el-table-column",{attrs:{type:"selection",width:"40",selectable:t.canDelete}}),t._v(" "),r("el-table-column",{attrs:{prop:"recycleNote","show-overflow-tooltip":"",label:"回收说明"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.recycleNote||"--")+"\n        ")]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"recycleModule",label:"回收模块"},scopedSlots:t._u([{key:"header",fn:function(){return[r("dropdown-header",{attrs:{title:"回收模块",list:t.onEnumeration(t.moduleMap),filtered:Boolean(t.crud.query.recycleModel)},on:{command:function(e){return t.filter("recycleModel",e)}}})]},proxy:!0},{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.moduleMap[e.row.recycleModule])+"\n        ")]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"recycleStatus",align:"center",label:"回收任务状态"},scopedSlots:t._u([{key:"header",fn:function(){return[r("dropdown-header",{attrs:{title:"回收任务状态",list:t.onEnumeration(t.statusMap),filtered:Boolean(t.crud.query.recycleStatus)},on:{command:function(e){return t.filter("recycleStatus",e)}}})]},proxy:!0},{key:"default",fn:function(e){return[r("el-tag",{attrs:{effect:"plain",type:t.tagMap[e.row.recycleStatus]}},[t._v("\n            "+t._s(t.statusMap[e.row.recycleStatus])+"\n          ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"recycleDelayDate",label:"执行操作时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(t.parseTime(e.row.recycleDelayDate)))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"操作",fixed:"right"},scopedSlots:t._u([{key:"header",fn:function(){return[r("span",[t._v("操作")]),t._v(" "),r("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n              单击立即删除后状态改变可能会有延迟，"),r("br"),t._v("可以单击右上角手动刷新\n            ")]),t._v(" "),r("i",{staticClass:"el-icon-question"})])]},proxy:!0},{key:"default",fn:function(e){return[r("el-button",{attrs:{id:"delete_"+e.$index,type:"text",disabled:!t.canDelete(e.row)},on:{click:function(r){return r.stopPropagation(),t.doDelete(e.row.id)}}},[t._v("\n            立即删除\n          ")]),t._v(" "),r("el-button",{attrs:{id:"restore_"+e.$index,type:"text",disabled:!t.canRestore(e.row)},on:{click:function(r){return r.stopPropagation(),t.doRestore(e.row.id)}}},[t._v("\n            立即还原\n          ")])]}}])})],1),t._v(" "),r("pagination")],1)])},o=[],a=r("b775"),i=r("f121");function c(t){return Object(a["a"])({url:"/".concat(i["a"].ADMIN,"/recycleTask"),method:"get",params:t})}function u(t){return Object(a["a"])({url:"/".concat(i["a"].ADMIN,"/recycleTask"),method:"delete",data:{recycleTaskIdList:t}})}function l(t){return Object(a["a"])({url:"/".concat(i["a"].ADMIN,"/recycleTask"),method:"put",params:t})}function s(){return Object(a["a"])({url:"/".concat(i["a"].ADMIN,"/recycleTask/recycleModuleMap"),method:"get"})}var f,p={list:c,del:u},d=r("c6db"),h=r("5897"),y=r("55b8"),v=r("aaa4"),m=r("ed08"),b=r("650f");function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */w=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(M){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var a=e&&e.prototype instanceof p?e:p,i=Object.create(a.prototype),c=new T(o||[]);return n(i,"_invoke",{value:_(t,r,c)}),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(M){return{type:"throw",arg:M}}}t.wrap=l;var f={};function p(){}function d(){}function h(){}var y={};u(y,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(j([])));m&&m!==e&&r.call(m,a)&&(y=m);var b=h.prototype=p.prototype=Object.create(y);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function o(n,a,i,c){var u=s(t[n],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==g(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,i,c)}),(function(t){o("throw",t,i,c)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return o("throw",t,i,c)}))}c(u.arg)}var a;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return a=a?a.then(n,n):n()}})}function _(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return D()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=O(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=s(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function O(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,O(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function j(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:D}}function D(){return{value:void 0,done:!0}}return d.prototype=h,n(b,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=u(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},E(S.prototype),u(S.prototype,i,(function(){return this})),t.AsyncIterator=S,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new S(l(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},E(b),u(b,c,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=j,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:j(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function E(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(l){return void r(l)}c.done?e(u):Promise.resolve(u).then(n,o)}function S(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){E(a,n,o,i,c,"next",t)}function c(t){E(a,n,o,i,c,"throw",t)}i(void 0)}))}}function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function O(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){L(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function L(t,e,r){return e=x(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function x(t){var e=T(t,"string");return"symbol"===g(e)?e:String(e)}function T(t,e){if("object"!==g(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var j={name:"Recycle",components:{cdOperation:h["a"],pagination:y["a"],DropdownHeader:v["a"]},cruds:function(){return Object(d["b"])({optShow:{add:!1},props:{optText:{del:"批量删除"}},crudMethod:O({},p)})},mixins:[Object(d["f"])(),Object(d["d"])(),Object(d["a"])()],data:function(){return{moduleMap:{},pollMap:Object.create(null),RECYCLE_STATUS_ENUM:b["RECYCLE_STATUS_ENUM"],recycleStatusMap:b["recycleStatusMap"]}},computed:{statusMap:function(){return Object(m["S"])(b["recycleStatusMap"],"status")},tagMap:function(){return Object(m["S"])(b["recycleStatusMap"],"tag")}},mounted:function(){var t=S(w().mark((function t(){var e=this;return w().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s();case 2:this.moduleMap=t.sent,this.$once("hook:beforeDestroy",(function(){e.pollMap=Object.create(null)}));case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:(f={onEnumeration:function(t){var e=[{label:"全部",value:null}];for(var r in t)e.push({label:t[r],value:r});return e},filter:function(t,e){this.crud.query[t]=e,this.crud.refresh()},canDelete:function(t){return[b["RECYCLE_STATUS_ENUM"].DELETION,b["RECYCLE_STATUS_ENUM"].DELETED_FAIL].includes(t.recycleStatus)},canRestore:function(t){return this.canDelete(t)&&t.restoreCustom},doDelete:function(t){var e=this;this.$confirm("此操作将立即永久删除该文件或表数据, 是否继续?","请确认").then(S(w().mark((function r(){return w().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,u([t]);case 2:e.$message({message:"资源删除中",type:"success"}),e.crud.refresh();case 4:case"end":return r.stop()}}),r)}))))},doRestore:function(t){var e=this;this.$confirm("此操作将会立即还原该文件或表数据, 是否继续?","请确认").then(S(w().mark((function r(){return w().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,l({taskId:t});case 2:e.$message({message:"还原成功",type:"success"}),e.crud.refresh();case 4:case"end":return r.stop()}}),r)}))))},onResetFresh:function(){this.crud.query={},this.crud.toQuery()},onUpdateStatus:function(){var t=S(w().mark((function t(e){var r,n,o,a,i,u,l=this,s=arguments;return w().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},t.next=3,c({recycleTaskIdList:[e]});case 3:if(n=t.sent,o=n.result,a=o[0],i=this.crud.data.find((function(t){return t.id===e})),i){t.next=9;break}return t.abrupt("return");case 9:u=r.pollId,Object.assign(i,a),this.needPoll(a.recycleStatus)&&u&&this.pollMap[e]===u&&setTimeout((function(){l.onUpdateStatus(e,r)}),1e3);case 12:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),needPoll:function(t){return[b["RECYCLE_STATUS_ENUM"].DELETING,b["RECYCLE_STATUS_ENUM"].RESTORING].includes(t)}},L(f,d["b"].HOOK.afterRefresh,(function(){var t=this,e=this.crud.data.filter((function(e){return t.needPoll(e.recycleStatus)}));e.forEach((function(e){t.poll(e.id)}))})),L(f,"poll",(function(t){this.pollMap[t]=(new Date).getTime(),this.onUpdateStatus(t,{pollId:this.pollMap[t]})})),f)},D=j,M=r("2877"),k=Object(M["a"])(D,n,o,!1,null,null,null);e["default"]=k.exports}}]);