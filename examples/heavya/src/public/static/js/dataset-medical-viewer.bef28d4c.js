(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["dataset-medical-viewer","dataset-medical-constant","dataset-medical-lib-gui","dataset-medical-lib-overlays","dataset-medical-viewer-controls","dataset-medical-viewer-helpInfo","dataset-medical-viewer-infoLayer","dataset-medical-viewer-toolbar","dataset-medical-viewer-toolbarButton","dataset-medical-viewer-toolbarItem","dataset-medical-viewer-toolbarMore"],{"0843":function(t,e,n){"use strict";n("6131")},"0903":function(t,e,n){"use strict";n.d(e,"e",(function(){return o})),n.d(e,"g",(function(){return i})),n.d(e,"j",(function(){return s})),n.d(e,"f",(function(){return l})),n.d(e,"a",(function(){return u})),n.d(e,"k",(function(){return f})),n.d(e,"n",(function(){return d})),n.d(e,"d",(function(){return p})),n.d(e,"b",(function(){return m})),n.d(e,"m",(function(){return b})),n.d(e,"h",(function(){return g})),n.d(e,"l",(function(){return h})),n.d(e,"i",(function(){return y}));var r=n("b775"),a=n("f121");function o(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/detail/").concat(t),method:"get"})}var i=function(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/getAuto/").concat(t),method:"get"})},s=function(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/getFinished/").concat(t),method:"get"})};function c(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical"),method:"get",params:t})}function l(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/list"),method:"get",params:t})}function u(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical"),method:"post",data:t})}function f(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/annotation/save"),method:"post",data:t})}function d(t,e){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/files"),method:"post",data:{id:t,dataMedicineFileCreateList:e}})}function v(t){var e={ids:t};return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical"),method:"delete",data:e})}function p(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/").concat(t.medicalId),method:"put",data:t})}function m(t,e){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/annotation/auto"),method:"post",data:{medicalId:t.id,modelServiceId:e.modelServiceId,fileStatus:e.fileStatus}})}function b(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/task/").concat(t,"/stop"),method:"put"})}function g(t){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/annotation/schedule"),method:"get",params:t})}function h(t,e){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/lesion/").concat(t),method:"post",data:e})}function y(t,e){return Object(r["a"])({url:"/".concat(a["a"].DCM,"/datasets/medical/lesion/").concat(t),method:"get",params:e})}e["c"]={list:c,add:u,del:v}},1104:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ToolbarButton usn",class:t.getklass(),on:{click:function(e){return t.handleClick(t.item)}}},[t.item.icon?n("IconFont",{attrs:{type:t.item.icon}}):t._e(),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v(t._s(t.item.text))])],1)},a=[],o=n("4d26"),i=n.n(o),s={name:"ToolbarButton",props:{item:Object,activeTool:String},setup:function(t,e){var n=function(){return i()({active:t.activeTool===t.item.command})},r=function(n){n.command!==t.activeTool&&e.emit("change",n)};return{getklass:n,handleClick:r}}},c=s,l=(n("b440"),n("2877")),u=Object(l["a"])(c,r,a,!1,null,null,null);e["default"]=u.exports},"1cac":function(t,e,n){},"2c0a":function(t,e,n){"use strict";n("e7f3")},"2e0f":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"infoLayer"},[t._l(["tl","tr","bl"],(function(e){return n("div",{key:e,class:t.klass(e)},[n("ul",t._l(t.state.overlayData[e],(function(e){return n("li",{key:e.value},[t._v(t._s(e.value))])})),0)])})),t._v(" "),n("div",{staticClass:"info-br info-element"},[n("ul",[n("li",[t._v("WW/WC："+t._s(t.overlayInfo.ww)+" / "+t._s(t.overlayInfo.wc))]),t._v(" "),n("li",[t._v("Zoom："+t._s(t.overlayInfo.zoom.scale))]),t._v(" "),n("li",[t._v("Image: "+t._s(t.stack.currentImageIdIndex+1)+" / "+t._s(t.stack.imageIds.length))])])])],2)},a=[],o=n("4e9b"),i=n.n(o),s=n("4d26"),c=n.n(s),l=n("ed09"),u=n("460e");function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function d(t,e,n){return e=v(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t){var e=p(t,"string");return"symbol"===f(e)?e:String(e)}function p(t,e){if("object"!==f(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function m(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=b(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function b(t,e){if(t){if("string"===typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var h={name:"InfoLayer",props:{seriesInfo:{type:Object,default:function(){return{}}},curInstanceID:String,overlayInfo:{type:Object,default:function(){return{}}},stack:{type:Object,default:function(){return{}}}},setup:function(t){var e=Object(l["n"])({overlayData:{}}),n=function(t){var e={},n=t.getFromKey("x00080060");if(!n)return{};var r,a=m(u);try{var o=function(){var n=r.value,a=n.value,o=n.tags,s=n.format,c=n.pos;if("undefined"!==typeof o&&0!==o.length){var l=[];o.forEach((function(e){l.push(t.getElementValueAsStringFromKey(e))})),"undefined"!==typeof s&&null!==s||(s=i.a.utils.createDefaultReplaceFormat(l)),a=i.a.utils.replaceFlags2(s,l)}if(!a||0===a.length)return"continue";e[c]||(e[c]=[]),e[c].push({value:a.trim(),format:s})};for(a.s();!(r=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}return e},r=function(r){var a=t.seriesInfo[r],o=new i.a.dicom.DicomElementsWrapper(a),s=n(o);Object.assign(e,{overlayData:s})},a=function(t){return c()("info-element",d({},"info-".concat(t),!!t))};return Object(l["r"])((function(){return t.curInstanceID}),(function(t){t&&r(t)}),{immediate:!0}),{state:e,klass:a}}},y=h,w=(n("a29e"),n("2877")),O=Object(w["a"])(y,r,a,!1,null,null,null);e["default"]=O.exports},"32de":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"wrapperRef",staticClass:"ToolbarButton controls usn rel",class:t.getklass(),attrs:{active:t.state.isOpen?"true":"false"}},[n("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.onClickOutside,expression:"onClickOutside"}],on:{click:t.toggleDropdown}},[n("IconFont",{attrs:{type:t.item.icon}}),t._v(" "),n("div",{staticClass:"toolbarText"},[n("span",[t._v(t._s(t.item.text))]),t._v(" "),n("span",{staticClass:"arrow"})])],1),t._v(" "),t.state.isOpen?n("div",[n("div",{staticClass:"control-options"},[n("ul",t._l(Object.keys(t.item.options),(function(e){return n("li",{key:e},[n("label",{staticClass:"control-option-label",class:t.value===e?"active":"",attrs:{for:e}},[n("input",{attrs:{id:e,name:t.item.command,type:"radio"},domProps:{value:e,checked:t.value===e},on:{change:t.updatePreset}}),t._v("\n            "+t._s(t.accessor(e))+"\n            "),n("div",{staticClass:"control-indicator"})])])})),0)])]):t._e()])},a=[],o=n("4d26"),i=n.n(o),s=n("ed09"),c=n("c28b"),l=n.n(c),u=n("2ef0"),f=n("e4e1");function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e,n){return e=b(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b(t){var e=g(t,"string");return"symbol"===d(e)?e:String(e)}function g(t,e){if("object"!==d(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var h={name:"ToolbarControls",directives:{clickOutside:l.a.directive},props:{item:{type:Object,default:function(){return{}}},value:String,activeTool:String,valueAccessor:Function},setup:function(t,e){var n=Object(s["o"])(null),r=Object(s["n"])({isOpen:!1}),a=function(){return i()({active:t.activeTool===t.item.command})},o=function(e){return t.item.options[e].name},c=function(n){var a=Object(u["isNil"])(n)?!r.isOpen:n;Object.assign(r,{isOpen:a}),e.emit("open",n,t.item)},l=function(t){n.value.contains(t.target)||c(!1)},d=function(n){t.value!==n.target.value&&e.emit("change",p({value:n.target.value},t.item))},v=t.valueAccessor||o;return{state:r,getklass:a,defaultWlPresets:f["defaultWlPresets"],onClickOutside:l,toggleDropdown:c,updatePreset:d,accessor:v,wrapperRef:n}}},y=h,w=(n("bae2"),n("2877")),O=Object(w["a"])(y,r,a,!1,null,"863ad00e",null);e["default"]=O.exports},"460e":function(t){t.exports=[{tags:["x00100020"],pos:"tl"},{tags:["x00100010","x00100040"],pos:"tl",format:"{v0} [{v1}]"},{tags:["x00100030"],pos:"tl"},{tags:["x00200011","x00200012","x00200013"],pos:"bl",format:"{v0}:{v1}:{v2}"},{tags:["x00185100"],pos:"bl"},{tags:["x00201041"],pos:"bl",format:"SL: {v0}"},{tags:["x00180050"],pos:"bl",format:"ST: {v0}"},{tags:["x00280010","x00280011"],pos:"bl",format:"RES: {v0}x{v1}"},{tags:["x00080080"],pos:"tr"},{tags:["x00080020","x00080030"],pos:"tr",format:"{v0} {v1}"},{tags:["x00080060"],pos:"tr"},{tags:["x00180015"],pos:"tr"},{value:"Wwwc",pos:"br",format:"{v0} / {v1}"},{value:"zoom",pos:"br",format:"Z: {v0}"},{value:"offset",pos:"br",format:"Off: {v0},{v1}"},{value:"position",pos:"br",format:"Pos: {v0},{v1},{v2}"},{value:"value",pos:"br",format:"Value: {v0}"}]},"4d2d":function(t,e,n){"use strict";n("c11a")},"4d76":function(t,e,n){},"5c04":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dwv-toolbar toolbar-section"},[t._l(t.tools,(function(e){return n("ToolbarItem",{key:e.command,attrs:{item:e,wlPreset:t.wlPreset,shape:t.shape,activeTool:t.activeTool},on:{change:t.handleChange,open:t.handleTriggerOpen}})})),t._v(" "),n("ToolbarMore",{attrs:{precision:t.precision,annotations:t.annotations,status:t.status},on:{change:t.handleChange}})],2)},a=[],o=n("93af"),i=n("de47"),s=n("e4e1"),c={name:"ToolBar",components:{ToolbarItem:o["default"],ToolbarMore:i["default"]},props:{tools:{type:Array},activeTool:String,updateState:Function,wlPreset:String,shape:String,precision:Number,annotations:String,status:Number},setup:function(t,e){var n=function(t){e.emit("change",t)},r=function(t,n){e.emit("open",t,n)};return{handleChange:n,defaultWlPresets:s["defaultWlPresets"],handleTriggerOpen:r}}},l=c,u=(n("f672"),n("2877")),f=Object(u["a"])(l,r,a,!1,null,null,null);e["default"]=f.exports},6131:function(t,e,n){},"63e7":function(t,e,n){"use strict";n.r(e),n.d(e,"medicalProgressMap",(function(){return r})),n.d(e,"medicalAnnotationCodeMap",(function(){return a})),n.d(e,"medicalFirstLevelCodeMap",(function(){return o})),n.d(e,"medicalAnnotationMap",(function(){return i})),n.d(e,"annotationList",(function(){return s})),n.d(e,"modalityMap",(function(){return c})),n.d(e,"bodyPartMap",(function(){return l})),n.d(e,"medicalStatusMap",(function(){return u})),n.d(e,"getAnnotateType",(function(){return f}));var r={unfinished:"未标注",autoFinished:"自动标注完成",manualAnnotating:"手动标注中",finished:"标注完成"},a={OrganSegmentation:1001,LesionDetection:2001,Other:2999},o={1e3:{name:"器官分割"},2e3:{name:"病灶识别"}},i={1001:{name:"器官分割",urlPrefix:"organSegmentation",parentName:"器官分割"},2001:{name:"肺结节检测",urlPrefix:"lesionDetection",parentName:"病灶识别"},2999:{name:"其它",urlPrefix:"other",parentName:"病灶识别"}},s=Object.keys(i).map((function(t){return{label:i[t].name,value:Number(t)}})),c={CT:"CT",MR:"MR",US:"US","X-Ray":"X-Ray",OTHER:"OTHER"},l={BRAIN:"BRAIN",LUNG:"LUNG",LIVER:"LIVER",SOFTTISSUE:"SOFTTISSUE",OTHER:"OTHER"},u={101:{name:"未标注",type:"info"},102:{name:"标注中",type:"warning"},103:{name:"自动标注中",type:"danger"},104:{name:"自动标注完成",type:""},105:{name:"标注完成",type:"success"}},f=function(t){return Number(t)>2e3&&Number(t)<3e3?1:(Number(t)>1e3&&Number(t),0)}},"6ea5":function(t,e,n){"use strict";n.r(e);var r=n("4e9b"),a=n.n(r);a.a.gui.getElement=a.a.gui.base.getElement,a.a.gui.prompt=a.a.gui.base.prompt},"6f10":function(t,e,n){},"7f3c":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"action-section flex"},[n("div",{staticClass:"ToolbarButton",on:{click:t.fullScreen}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"full-screen"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("全屏")])]),t._v(" "),n("div",{staticClass:"rel"},[n("div",{staticClass:"ToolbarButton",on:{click:t.showTags}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"tag"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("查看标签")])]),t._v(" "),t.state.tagsOpen?n("div",{staticClass:"popup"},[n("div",{staticClass:"fullBg",on:{mousedown:t.closePopup}}),t._v(" "),n("portal",{attrs:{to:"toolsAction"}},[n("div",{staticClass:"dwv-popup",staticStyle:{background:"#fff"}},[n("div",{staticStyle:{width:"30%",padding:"10px"}},[n("el-input",{attrs:{clearable:"",placeholder:"查询标签"},on:{input:t.handleTagFilter},model:{value:t.state.tagSearch,callback:function(e){t.$set(t.state,"tagSearch",e)},expression:"state.tagSearch"}})],1),t._v(" "),n("InfoTable",{attrs:{tableAttrs:t.tableProps,columns:t.columns,dataSource:t.state.metaData,showPagination:!1}})],1)])],1):t._e()]),t._v(" "),n("div",[n("div",{staticClass:"ToolbarButton",on:{click:t.showHelp}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"help"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("帮助")])]),t._v(" "),t.state.helpOpen?n("div",{staticClass:"popup"},[n("div",{staticClass:"fullBg",on:{mousedown:t.closePopup}}),t._v(" "),n("portal",{attrs:{to:"toolsAction"}},[n("div",{staticClass:"dwv-popup"},[n("HelpInfo")],1)])],1):t._e()]),t._v(" "),n("div",{staticClass:"ToolbarButton",class:t.state.saveIng?"pen":"",on:{click:function(e){return t.saveAnnotation(0)}}},[n("div",{staticClass:"icon-wrapper"},[t.saveState.loading?n("i",{staticClass:"el-icon-loading"}):n("IconFont",{attrs:{type:"baocun"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("保存")])]),t._v(" "),n("div",{staticClass:"ToolbarButton",class:t.state.finishIng?"pen":"",on:{click:function(e){return t.saveAnnotation(1)}}},[n("div",{staticClass:"round icon-wrapper"},[t.saveState.loading?n("i",{staticClass:"el-icon-loading"}):n("IconFont",{attrs:{type:"finish"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("完成")])])])},a=[],o=n("4e9b"),i=n.n(o),s=n("93bf"),c=n.n(s),l=n("2ef0"),u=n("5c96"),f=n("ed09"),d=n("ed35"),v=n("22a3"),p=n("e8c4");function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e,n){return e=y(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t){var e=w(t,"string");return"symbol"===m(e)?e:String(e)}function w(t,e){if("object"!==m(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var O={name:"ToolAction",components:{InfoTable:d["a"],HelpInfo:p["default"]},props:{tools:{type:Array},getApp:Function,save:Function,medicalId:String,rawAutoAnnotationIds:{type:Array,default:function(){return[]}},changedDrawId:{type:Array,default:function(){return[]}},sliceDrawingMap:{type:Object,default:function(){return{}}},saveState:{type:Object,default:function(){return{}}}},setup:function(t){var e=t.getApp,n=Object(f["n"])({tagsOpen:!1,helpOpen:!1,metaData:[],rawMetaData:[],tagSearch:"",saveIng:!1,finishIng:!1,isFullscreen:!1}),r={0:"saveIng",1:"finishIng"},a=function(){Object.assign(n,{tagsOpen:!1,helpOpen:!1})},o=function(t){var e=g({},t);"undefined"!==typeof e.InstanceNumber&&delete e.InstanceNumber;var n=e;return i.a.utils.isObject(e)&&!i.a.utils.isArray(e)&&(n=i.a.utils.objectToArray(e)),n},s=function(a){var o=r[a],s={};Object.assign(n,h({},o,!0));var c=e(),f=c.getDrawController().getDrawLayer();Object(v["removeAnchorsFromDrawer"])(f);var d=f.toObject(),p=c.getDrawStoreDetails(),m=c.getMetaData(),b=m.SOPInstanceUID.value,g=Object(l["isPlainObject"])(b)?b:[b],y=f.getChildren(),w=[];y.forEach((function(e){var n=i.a.draw.getPositionFromGroupId(e.id()),r=e.getChildren().map((function(t){return t.id()})),a=!Object(l["isEqual"])(r,t.sliceDrawingMap[n.sliceNumber])||Object(l["intersection"])(r,t.changedDrawId).length>0,o=Object.keys(g);a&&w.push(o[n.sliceNumber])})),w.length&&y.forEach((function(t){var e=i.a.draw.getPositionFromGroupId(t.id()),n=t.getChildren().map((function(t){return t.id()}));s[e.sliceNumber]=n}));var O={medicalId:Number(t.medicalId),type:a,annotations:JSON.stringify({drawings:d,drawingsDetails:p,sliceDrawingMap:w.length?s:t.sliceDrawingMap})};return 0===a&&w.length&&(O.medicalFiles=w.map((function(t){return g[t]}))),t.save({drawing:O}).then((function(){var t=0===a?"保存成功":"数据集标注完成";u["Message"].success(t)})).finally((function(){Object.assign(n,h({},o,!1))}))},d=function(){var t=e(),r=o(t.getMetaData());Object.assign(n,{tagsOpen:!0,helpOpen:!1,metaData:r,rawMetaData:r})},p=function(){if(!c.a.isEnabled)return u["Message"].info("当前浏览器不支持全屏模式"),!1;n.isFullscreen=!n.isFullscreen,c.a.toggle()},m=function(){Object.assign(n,{tagsOpen:!1,helpOpen:!0})},b=function(t){var e=n.rawMetaData.filter((function(e){for(var n=!1,r=0,a=Object.values(e);r<a.length;r++){var o=a[r];if(String(o).toLowerCase().indexOf(t.toLowerCase())>-1){n=!0;break}}return n}));Object.assign(n,{metaData:e})},y={stripe:!0},w=[{prop:"name",label:"名称",minWidth:150},{prop:"value",label:"值",minWidth:120},{prop:"group",label:"组标签"},{prop:"element",label:"元素标签"},{prop:"vr",label:"VR"}];return{state:n,columns:w,tableProps:y,saveAnnotation:s,showTags:d,fullScreen:p,showHelp:m,handleTagFilter:b,closePopup:a}}},_=O,j=(n("fede"),n("2877")),I=Object(j["a"])(_,r,a,!1,null,"129f3f18",null);e["default"]=I.exports},"93af":function(t,e,n){"use strict";n.r(e);var r=n("2638"),a=n.n(r),o=n("1104"),i=n("32de"),s={name:"ToolbarItem",inheritAttrs:!1,components:{ToolbarButton:o["default"],ToolbarControls:i["default"]},props:{item:Object,activeTool:String,wlPreset:String,shape:String},render:function(){var t=arguments[0],e={props:{item:this.item,activeTool:this.activeTool},on:this.$listeners};return"Draw"===this.item.command?t(i["default"],a()([{attrs:{value:this.shape}},e])):"SetWlPreset"===this.item.command?t(i["default"],a()([{attrs:{value:this.wlPreset}},e])):t(o["default"],a()([{},e]))}};e["default"]=s},"93bf":function(t,e,n){
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var e="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},n=t.exports,r=function(){for(var t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,a=n.length,o={};r<a;r++)if(t=n[r],t&&t[1]in e){for(r=0;r<t.length;r++)o[n[0][r]]=t[r];return o}return!1}(),a={change:r.fullscreenchange,error:r.fullscreenerror},o={request:function(t,n){return new Promise(function(a,o){var i=function(){this.off("change",i),a()}.bind(this);this.on("change",i),t=t||e.documentElement;var s=t[r.requestFullscreen](n);s instanceof Promise&&s.then(i).catch(o)}.bind(this))},exit:function(){return new Promise(function(t,n){if(this.isFullscreen){var a=function(){this.off("change",a),t()}.bind(this);this.on("change",a);var o=e[r.exitFullscreen]();o instanceof Promise&&o.then(a).catch(n)}else t()}.bind(this))},toggle:function(t,e){return this.isFullscreen?this.exit():this.request(t,e)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,n){var r=a[t];r&&e.addEventListener(r,n,!1)},off:function(t,n){var r=a[t];r&&e.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),n?t.exports=o:window.screenfull=o):n?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()},"9ca0":function(t,e,n){},"9f25":function(t,e,n){},a29e:function(t,e,n){"use strict";n("c5b5")},a338:function(t,e,n){"use strict";n("1cac")},b409:function(t,e,n){"use strict";n("4d76")},b440:function(t,e,n){"use strict";n("6f10")},b525:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"rel dwv-container"},[n("div",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"dwv-wrapper viewer rel",attrs:{id:"dwv"}},[n("div",{staticClass:"dwv-page-header flex flex-between"},[n("ToolBar",{attrs:{tools:t.state.actions,activeTool:t.state.activeTool,updateState:t.updateState,wlPreset:t.state.wlPreset,shape:t.state.shape,precision:t.state.precision,annotations:t.state.annotations,status:t.state.caseInfo.status},on:{change:t.handleChangeTool,open:t.handleOpenTool}}),t._v(" "),n("Action",{attrs:{getApp:t.getApp,medicalId:t.medicalId,save:t.saveAction,sliceDrawingMap:t.state.sliceDrawingMap,changedDrawId:t.state.changedDrawId,rawAutoAnnotationIds:t.state.rawAutoAnnotationIds}})],1),t._v(" "),n("div",{staticClass:"layer-content flex flex-beween"},[n("div",{staticClass:"rel flex flex-beween",staticStyle:{flex:"1"}},[n("div",{staticStyle:{width:"100%"}},[n("div",{staticClass:"layerContainer mx-auto rel",class:t.state.loading?"hidden":""},[n("canvas",{ref:"canvasRef",staticClass:"imageLayer"}),t._v(" "),n("div",{staticClass:"drawDiv"})]),t._v(" "),t.state.curInstanceID&&t.state.showInfo?n("InfoLayer",{attrs:{seriesInfo:t.state.seriesDicomInfo,curInstanceID:t.state.curInstanceID,overlayInfo:t.state.overlayInfo,stack:t.state.stack}}):t._e()],1),t._v(" "),t.state.loading?n("div",{staticClass:"flex flex-center dwv-placeholder"},[t._v("加载中...")]):t._e()]),t._v(" "),t.state.showLesionInfo?n("div",{staticClass:"settingsInfo",staticStyle:{width:"22%"}},[n("LesionInfo",{attrs:{lesions:t.state.lesions,deleteDraw:t.deleteDraw,setCurrentSlice:t.setCurrentSlice,editDrawDetail:t.editDrawDetail,editLesionItem:t.editLesionItem,editLesionOrder:t.editLesionOrder,getApp:t.getApp}})],1):t._e()]),t._v(" "),n("div",{staticStyle:{height:"16px"}}),t._v(" "),n("portal-target",{attrs:{name:"toolsAction"}})],1)])},a=[],o=n("4e9b"),i=n.n(o),s=n("ed09"),c=n("2ef0"),l=n("ed08"),u=n("0903"),f=n("3da5"),d=n("fffb"),v=n("2e0f"),p=n("5c04"),m=n("7f3c"),b=n("e4e1"),g=n("22a3"),h=n("63e7");n("6ea5");function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function w(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=O(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function O(t,e){if(t){if("string"===typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function j(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */j=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(E){c=function(t,e,n){return t[e]=n}}function l(t,e,n,a){var o=e&&e.prototype instanceof d?e:d,i=Object.create(o.prototype),s=new C(a||[]);return r(i,"_invoke",{value:_(t,n,s)}),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(E){return{type:"throw",arg:E}}}t.wrap=l;var f={};function d(){}function v(){}function p(){}var m={};c(m,o,(function(){return this}));var b=Object.getPrototypeOf,g=b&&b(b(x([])));g&&g!==e&&n.call(g,o)&&(m=g);var h=p.prototype=d.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function a(r,o,i,s){var c=u(t[r],t,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==y(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){a("next",t,i,s)}),(function(t){a("throw",t,i,s)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return a("throw",t,i,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){a(t,n,e,r)}))}return o=o?o.then(r,r):r()}})}function _(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return k()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var s=I(i,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function I(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,I(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=u(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,f;var o=a.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function x(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:k}}function k(){return{value:void 0,done:!0}}return v.prototype=p,r(h,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:v,configurable:!0}),v.displayName=c(p,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,s,"GeneratorFunction")),t.prototype=Object.create(h),t},t.awrap=function(t){return{__await:t}},w(O.prototype),c(O.prototype,i,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new O(l(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(h),c(h,s,"Generator"),c(h,o,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=x,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),D(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function I(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(l){return void n(l)}s.done?e(c):Promise.resolve(c).then(r,a)}function S(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){I(o,r,a,i,s,"next",t)}function s(t){I(o,r,a,i,s,"throw",t)}i(void 0)}))}}function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e=k(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k(t){var e=E(t,"string");return"symbol"===y(e)?e:String(e)}function E(t,e){if("object"!==y(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var T={name:"DatasetMedicalViewer",components:{InfoLayer:v["default"],ToolBar:p["default"],Action:m["default"],LesionInfo:d["default"]},setup:function(t,e){var n=e.root,r=n.$route,a=n.$router,o=r.params,d=void 0===o?{}:o,v=Object(s["o"])(null),p={count:0},m=Object(s["n"])({actions:b["default"],activeTool:"Scroll",annotations:null,caseInfo:{},loading:!1,loadItemCount:0,loadProgress:0,receivedError:0,seriesMetadata:[],curInstanceID:void 0,seriesDicomInfo:{},showInfo:!0,overlayInfo:{zoom:{scale:1}},stack:{imageIds:[],currentImageIdIndex:0},shape:"Rectangle",wlPreset:"",autoAnnotationIds:[],rawAutoAnnotationIds:[],sliceDrawingMap:{},changedDrawId:[],precision:.5,showLesionInfo:!1,lesions:[]}),y={Scroll:{},ZoomAndPan:{},WindowLevel:{},Draw:{options:["Roi","Rectangle"],type:"factory",events:["draw-create","draw-change","draw-move","draw-delete"]}},O=null,_=function(t){return Object.keys(y).includes(t)},I=function(t){if("function"!==typeof t)Object.assign(m,t);else{var e=t(m);Object.assign(m,e)}},D=function(t){var e=t.data,n=Object(g["getSOPInstanceUID"])(e);if(!m.seriesDicomInfo[n]){var r=C(C({},m.seriesDicomInfo),{},x({},n,e));Object.assign(m,{seriesDicomInfo:r})}},k=function(t,e){var n=e||m.activeTool;O&&"Draw"===n&&""!==t&&O.setDrawShape(t)},E=function(t,e){!1===e?t.setAttribute("style","pointer-events: none;"):t.setAttribute("style","pointer-events: auto;")},T=function(t,e){var n=Object(g["getDrawLayer"])(O);E(v.value,e);var r="Draw"===t.command||"tool"!==t.type?e:!e;E(n.parent.content,r)},P=function(t,e){t&&("Draw"===e.command&&m.shape&&(O.setTool(e.command),k(m.shape,"Draw"),T(e,!0)),I({activeTool:e.command}))},L=function(t){if("tool"===t.type)O.setTool(t.command),"Draw"===t.command&&(k(t.value,"Draw"),t.value&&I({shape:t.value})),_(m.activeTool)||T(t,!0);else{var e=O.getToolboxController().getSelectedTool();e&&T(t,!1),b["viewerCommands"][t.command](O,I,t,m)}I({activeTool:t.command})},A=function(t){if("function"!==typeof t)Object.assign(m,{overlayInfo:C(C({},m.overlayInfo),t)});else{var e=t(m.overlayInfo);Object.assign(m,{overlayInfo:C(C({},m.overlayInfo),e)})}},N=function(t){A({ww:t.ww,wc:t.wc})},F=function(t){"zoom-change"===t.type&&A({zoom:C(C({},t),{},{scale:Object(l["Qb"])(t.scale,0,2)})})},M=function(t){m.changedDrawId.includes(t)||m.changedDrawId.push(t)},R=function(){},B=function(t){I((function(e){return{stack:C(C({},e.stack),{},{currentImageIdIndex:t.value})}}))},$=function(t){var e=t.drawing,n=Object(u["k"])(e),r=[n];if(m.showLesionInfo){var a=Object(u["l"])(d.medicalId,m.lesions);r.push(a)}return Promise.all(r)},W=function(){var t=m.lesions.reduce((function(t,e){return Object(c["isNil"])(e.lesionOrder)||t.push(e.lesionOrder),t}),[]);p.count=t.length?Object(c["isNil"])(Object(c["max"])(t))?1:Object(c["max"])(t):m.lesions.length},U=function(){var t=S(j().mark((function t(e){var n,r,o,i,s;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=m.caseInfo,o=function(){var t=S(j().mark((function t(){var n,a,o,i,s,c;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["g"])(r.id);case 2:n=t.sent,a=Object(g["genDrawingFromAnnotations"])(JSON.parse(n.annotations)||[],m.precision),o=a.drawings,i=a.drawingsDetails,s=a.drawingIds,c=a.sliceDrawingMap,Object.assign(m,{sliceDrawingMap:c,annotations:n.annotations,autoAnnotationIds:s,rawAutoAnnotationIds:s}),e.setDrawings(o,i);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),i=function(){var t=S(j().mark((function t(){var n,a,o,i;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["j"])(r.id);case 2:n=t.sent,a=n.drawings,o=n.drawingsDetails,i=n.sliceDrawingMap,Object.assign(m,{sliceDrawingMap:i}),e.setDrawings(a,o);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.t0=null===(n=f["datasetStatusMap"][r.status])||void 0===n?void 0:n.status,t.next="AUTO_ANNOTATED"===t.t0?6:"ANNOTATING"===t.t0?8:"ANNOTATED"===t.t0?10:"UNANNOTATED"===t.t0?12:13;break;case 6:return o(),t.abrupt("break",15);case 8:return r.stop?o():i(),t.abrupt("break",15);case 10:return i(),t.abrupt("break",15);case 12:return t.abrupt("break",15);case 13:throw setTimeout((function(){a.replace("/data/datasets/medical")}),2e3),new Error("当前数据集状态不允许查看");case 15:m.showLesionInfo&&(s=e.getDrawDisplayDetails(),Object(u["i"])(d.medicalId).then((function(t){try{var e=t.map((function(t){var e=JSON.parse(t.list).map((function(t){return C(C({},t),{},{id:t.drawId})}));return C(C({},t),{},{list:Object(l["sb"])(e,s,"id")})}));Object.assign(m,{lesions:e}),W()}catch(n){throw n}})));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),G=function(t,e){var n=e(m[t]);if(n>-1){var r=Object(l["Ib"])(m[t],n);Object.assign(m,x({},t,r))}},z=function(t){m.showLesionInfo&&t&&G("lesions",(function(e){return Object(c["findIndex"])(e,(function(e){return(e.list||[]).map((function(t){return t.drawId})).includes(t)}))}))},q=function(t){t&&(G("changedDrawId",(function(e){return Object(c["findIndex"])(e,(function(e){return e===t}))})),z(t))},V=function(t){if(t){var e,n=Object(g["getDrawLayer"])(O),r=n.getChildren(),a=w(r);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=o.getChildren((function(e){return e.id()===t}));1===i.length&&O.getDrawController().deleteDrawGroup(i[0],l["xb"],l["xb"])}}catch(s){a.e(s)}finally{a.f()}}},H=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(e.list||[]).map((function(t){return t.drawId})).filter((function(t){return!!t})),r=w(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;V(a),q(a)}}catch(o){r.e(o)}finally{r.f()}},J=function(t){O.getViewController().setCurrentSlice(t)},K=function(t,e){var n=O.getDrawDisplayDetails();t.forEach((function(t){var r=n.find((function(e){return e.id===t}));r&&(r.color=e,M(t),O.updateDraw(r))}))},Z=function(t,e){var n=Object(c["findIndex"])(m.lesions,(function(e){return e.lesionOrder===Number(t)}));if(n>-1){var r=m.lesions[n],a=String(r.sliceDesc).split(",").concat(String(e.sliceDesc).split(",")),o=r.list[0].color,i=r.list.concat(e.list),s=Object(l["Kb"])(m.lesions,n,C(C({},r),{},{sliceDesc:Object(c["uniq"])(a).sort().join(","),list:i})),u=Object(c["findIndex"])(s,(function(t){return t.id===e.id}));u>-1&&(s=Object(l["Ib"])(s,u)),Object.assign(m,{lesions:s});var f=i.map((function(t){return t.drawId}));K(f,o)}else{var d=Object(c["findIndex"])(m.lesions,(function(t){return t.id===e.id})),v=C(C({},e),{},{lesionOrder:Number(t)}),p=Object(l["Kb"])(m.lesions,d,v);Object.assign(m,{lesions:p})}W()},X=function(t,e,n){switch(t){case"color":var r=n.list.map((function(t){return t.drawId}));K(r,e);break;default:return!1}},Y=function(t,e){var n=Object(c["findIndex"])(m.lesions,(function(t){return t.id===e.id})),r=Object(l["Kb"])(m.lesions,n,C(C({},e),{},{sliceDesc:t}));Object.assign(m,{lesions:r})},Q=Object(s["a"])((function(){return{delete:R,backspace:R,esc:H}}));return Object(s["k"])(S(j().mark((function t(){var e,n,r,a,o,s;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return O=new i.a.App,O.init({containerDivId:"dwv",tools:y}),t.next=4,Object(u["e"])(Number(d.medicalId));case 4:return e=t.sent,m.caseInfo=e,n=e.annotateType,r=1===Object(h["getAnnotateType"])(n),t.next=10,g["dwc"].retrieveSeriesMetadata(e);case 10:if(a=t.sent,a&&a.length){t.next=13;break}throw new Error("找不到数据");case 13:o=Object(g["getImageIdsForSeries"])(a),s=o.map(g["buildWADOUrl"]),Object.assign(m,{caseInfo:e,showLesionInfo:r,seriesMetadata:a,stack:C(C({},m.stack),{},{imageIds:s})}),O.addEventListener("load-start",(function(){Object.assign(m,{loadItemCount:0,loading:!0})})),O.addEventListener("load-progress",(function(t){Object.assign(m,{loadProgress:t.loaded})})),O.addEventListener("load-item",(function(t){Object.assign(m,{loadItemCount:m.loadItemCount+1}),"image"===t.loadtype&&D(t)})),O.addEventListener("load",(function(t){var e=new URL(s[0]).searchParams.get("objectUID");t.source.length&&Object.assign(m,{curInstanceID:e})})),O.addEventListener("load-end",S(j().mark((function t(){var e;return j().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={loading:!1,loadProgress:100},m.nReceivedError>0&&Object.assign(e,{loadProgress:0,loadItemCount:0}),O.setTool(m.activeTool),O.getViewController().goFirstSlice(),t.next=6,U(O);case 6:Object.assign(m,e);case 7:case"end":return t.stop()}}),t)})))),O.addEventListener("error",(function(t){Object.assign(m,{receivedError:m.receivedError+1})})),O.addEventListener("draw-move",(function(t){var e=t.id;M(e)})),O.addEventListener("draw-create",(function(t){var e=t.id,n=O.getDrawDisplayDetails(),r=n.find((function(t){return t.id===e}))||{};if(m.showLesionInfo){var a=p.count+=1,o=m.stack.currentImageIdIndex+1;m.lesions.push({id:Object(l["T"])(),lesionOrder:a,sliceDesc:o,list:[C({drawId:e,sliceNumber:o},r)]})}})),O.addEventListener("draw-delete",(function(t){var e=t.id;q(e)})),O.addEventListener("wl-width-change",N),O.addEventListener("wl-center-change",N),O.addEventListener("zoom-change",F),O.addEventListener("slice-change",B),O.addEventListener("keydown",(function(t){39===t.keyCode&&(t.preventDefault(),O.getViewController().incrementSliceNb()),37===t.keyCode&&(t.preventDefault(),O.getViewController().decrementSliceNb())})),O.loadURLs(s,{batchSize:5});case 31:case"end":return t.stop()}}),t)})))),Object(s["j"])((function(){O.abortLoad()})),{state:m,medicalId:d.medicalId,updateState:I,keymap:Q,canvasRef:v,handleChangeTool:L,handleOpenTool:P,saveAction:$,deleteDraw:H,setCurrentSlice:J,editLesionOrder:Z,editLesionItem:Y,editDrawDetail:X,getApp:function(){return O}}}},P=T,L=(n("a338"),n("b409"),n("2877")),A=Object(L["a"])(P,r,a,!1,null,"a18a4a0a",null);e["default"]=A.exports},bae2:function(t,e,n){"use strict";n("9f25")},c11a:function(t,e,n){},c5b5:function(t,e,n){},da76:function(t,e,n){},de47:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.showMore?n("div",{staticClass:"ToolbarButton more usn rel",attrs:{active:t.state.isOpen?"true":"false"}},[n("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.onClickOutside,expression:"onClickOutside"}],on:{click:t.toggleDropdown}},[n("IconFont",{attrs:{type:"more"}}),t._v(" "),t._m(0)],1),t._v(" "),t.state.isOpen?n("div",[n("div",{staticClass:"control-options"},[t._v("\n      标注精度\n      "),n("el-slider",{attrs:{min:.01,max:1,step:.01,"format-tooltip":t.formatTooltip},model:{value:t.state.precision,callback:function(e){t.$set(t.state,"precision",e)},expression:"state.precision"}})],1)]):t._e()]):t._e()},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("span",[t._v("更多")]),t._v(" "),n("span",{staticClass:"arrow"})])}],o=n("3da5"),i=n("ed09"),s=n("c28b"),c=n.n(s),l=n("2ef0"),u={name:"ToolbarMore",directives:{clickOutside:c.a.directive},props:{item:Object,precision:Number,annotations:String,status:Number},setup:function(t,e){var n=Object(i["n"])({isOpen:!1,precision:t.precision}),r=function(t){var e=Object(l["isNil"])(t)?!n.isOpen:t;Object.assign(n,{isOpen:e})},a=function(){t.precision!==n.precision&&e.emit("change",{command:"SetPrecision",precision:n.precision,annotations:t.annotations})},s=function(t){t.target.closest(".more")||r(!1),a()},c=function(t){return String((100*t).toFixed(0)).concat("%")},u=Object(i["a"])((function(){return Object(o["isStatus"])(t,"AUTO_ANNOTATED")}));return{state:n,onClickOutside:s,toggleDropdown:r,updatePrecision:a,formatTooltip:c,showMore:u}}},f=u,d=(n("4d2d"),n("2877")),v=Object(d["a"])(f,r,a,!1,null,"57fa3f9a",null);e["default"]=v.exports},e7f3:function(t,e,n){},e8c4:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dwv-content"},[n("p",[t._v("欢迎使用医疗影像标注工具！")]),t._v(" "),n("p",[t._v("\n    在这里，你可以通过上传标准\n    "),n("el-link",{attrs:{href:"https://www.dicomstandard.org/",target:"_blank"}},[t._v("DICOM")]),t._v("\n    文件就能实现随时随地进行医疗影像查询、阅片、智能识别、影像标注等常见操作。系统还提供了一些标准工具对影像文件进行操作，包括滚动浏览，缩放/拖拽，窗宽/窗位，对比，预设窗口等工具。\n  ")],1),t._v(" "),n("p",[t._v("所有 DICOM 标签都可以点击「查看标签」按钮进行查询，你可以指定搜索条件对信息进行过滤。")]),t._v(" "),n("p",[t._v("下列工具定义了与用户操作相关的产品交互行为：")]),t._v(" "),n("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[n("el-collapse-item",{attrs:{title:"滚动浏览（Scroll）",name:"Scroll"}},[n("div",[t._v("鼠标滚轮：使用快速浏览模式，可以通过鼠标滚轮动作对图像切片（slice）进行快速切换。")]),t._v(" "),n("div",[t._v("键盘快键：按住键盘快捷键右键可以切换下一张切片，左键切换上一张切片。")]),t._v(" "),n("div",[t._v("自动播放：双击切片开始切片逐帧自动切换模式，再次单击停止。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"缩放拖拽（ZoomAndPan）",name:"ZoomAndPan"}},[n("div",[t._v("缩放/拖拽工具用于放大缩小和拖拽图像。")]),t._v(" "),n("div",[t._v("缩放：鼠标滚轮用于缩放图像。")]),t._v(" "),n("div",[t._v("拖拽：按住鼠标拖动图片到想要的位置")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"窗宽窗位（WW/WC）",name:"WindowLevel"}},[n("div",[t._v("改变图像的窗位和窗宽。")]),t._v(" "),n("div",[t._v("按住鼠标按住拖动图像，沿水平方向改变窗宽，沿竖直方向改变窗位。")]),t._v(" "),n("div",[t._v("双击影像，可将该点作为窗位窗宽中心值。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"绘制标注（Draw）",name:"Draw"}},[n("div",[t._v("基于锚点绘制标注")]),t._v(" "),n("div",[t._v("\n        绘制标注：按下鼠标开始绘制锚点，移动鼠标到想要的地点，再次单击鼠标连接两个锚点，双击完成绘制。\n      ")]),t._v(" "),n("div",[t._v("\n        修改标注：单击选中标注路径，路径出现锚点，拖动锚点到想要的位置，点击「保存」按钮完成修改\n      ")]),t._v(" "),n("div",[t._v("删除标注：单击选中标注，按住 delete 快捷键删除标注")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"展示、隐藏信息（Info）",name:"Info"}},[n("div",[t._v("切换影像信息展示")]),t._v(" "),n("div",[t._v("展示信息：点击「展示信息」按钮。")]),t._v(" "),n("div",[t._v("隐藏信息：点击「隐藏信息」按钮。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"重置（Reset）",name:"Reset"}},[n("div",[t._v("重置标注工具状态")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"预设窗口（PresetLevel）",name:"PresetLevel"}},[n("div",{staticClass:"mb-10"},[t._v("提供一些不同器官标准预设窗口、窗位设置。")]),t._v(" "),n("div",[t._v("以下数据按照（窗口/窗位）格式提供。")]),t._v(" "),n("div",[t._v("软组织：400/40")]),t._v(" "),n("div",[t._v("肺：1500/-600")]),t._v(" "),n("div",[t._v("肝脏：150/90")]),t._v(" "),n("div",[t._v("大脑：80/40")]),t._v(" "),n("p"),t._v(" "),n("div",[t._v("注：实际以图像真实窗口、窗位信息为准")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"更多（More）",name:"More"}},[n("div",{staticClass:"ml-40"},[n("el-collapse",{attrs:{accordion:""},model:{value:t.activeSubNames,callback:function(e){t.activeSubNames=e},expression:"activeSubNames"}},[n("el-collapse-item",{attrs:{title:"标注精度（AnnotationPrecision）",name:"AnnotationPrecision"}},[n("div",[t._v("设置自动标注生成路径的显示精度")]),t._v(" "),n("div",[t._v("精度可调范围为1%~100%，手动标注结果不支持调节。")]),t._v(" "),n("div",[t._v("100%时显示算法生成的所有标注点。")])])],1)],1)])],1)],1)},a=[],o={name:"DCOMHelpInfo",data:function(){return{activeNames:["Scroll"],activeSubNames:[]}}},i=o,s=(n("0843"),n("2877")),c=Object(s["a"])(i,r,a,!1,null,"1a39669b",null);e["default"]=c.exports},f672:function(t,e,n){"use strict";n("9ca0")},fede:function(t,e,n){"use strict";n("da76")},fffb:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lesion-table-wrapper"},[n("el-form",{attrs:{"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[n("div",{staticClass:"el-form-item__label"},[t._v("\n      可疑结节\n      "),n("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[n("div",{attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"label-tooltip"},[n("div",{staticClass:"tips-wrapper f12",staticStyle:{"line-height":"1.5"}},[n("div",[t._v("不同层面的相同结节（同一个 ID）可以合并，")]),t._v(" "),n("div",[t._v("层面代表当前结节所处的影像位置，支持1层或多层")]),t._v(" "),n("div",[t._v("单一结节多层面位置之间通过,(逗号)分割")])])])]),t._v(" "),n("i",{staticClass:"el-icon-warning-outline cp",staticStyle:{color:"#fff"}})])],1),t._v(" "),n("el-table",{staticClass:"lesionInfo-table",attrs:{data:t.state.lesions,"max-height":385}},[n("el-table-column",{attrs:{label:"序号","min-width":40},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.$index+1))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"ID","min-width":64},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",[t._v(t._s(r.lesionOrder))]),t._v(" "),n("Edit",{attrs:{row:r,title:"修改ID",valueBy:"lesionOrder",rules:"required|validateLesionId",label:"ID"},on:{handleOk:t.editLesionOrder}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"层面","min-width":60},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("span",[t._v(t._s(r.sliceDesc))]),t._v(" "),n("Edit",{attrs:{row:r,title:"修改层面",valueBy:"sliceDesc",rules:"required|validateLesionSliceNumber",label:"层面"},on:{handleOk:t.editLesionItem}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"颜色","min-width":60},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("el-color-picker",{on:{change:function(e){return t.editDrawDetail("color",e,r)}},model:{value:r.list[0].color,callback:function(e){t.$set(r.list[0],"color",e)},expression:"row.list[0].color"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作","min-width":60},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[n("el-tooltip",{attrs:{effect:"dark",content:"跳转到结节层面",placement:"top","open-delay":800}},[n("i",{staticClass:"el-icon-d-arrow-right cp",staticStyle:{color:"#fff"},on:{click:function(e){return t.toPosition(r)}}})]),t._v(" "),n("el-popconfirm",{attrs:{title:"确定删除标注？"},on:{onConfirm:function(){return t.deleteDrawItem(r)}}},[n("span",{attrs:{slot:"reference"},slot:"reference"},[n("i",{staticClass:"el-icon-delete cp ml-4"})])])]}}])})],1)],1)],1)},a=[],o=n("ed09"),i=n("e3a3"),s=n("22a3"),c={name:"LesionInfo",components:{Edit:i["a"]},props:{lesions:{type:Array,default:function(){return[]}},deleteDraw:Function,setCurrentSlice:Function,editLesionItem:Function,editLesionOrder:Function,getApp:Function,editDrawDetail:Function},setup:function(t){var e=t.deleteDraw,n=t.setCurrentSlice,r=t.getApp,a=Object(o["n"])({lesions:t.lesions}),i=function(t){e(t)},c=function(t){var e=t.list[0],a=e.sliceNumber,o=e.drawId;n(a-1);var i=Object(s["getDrawLayer"])(r()),c=Object(s["getShapeGroup"])(o,i);c&&Object(s["activeShapeGroup"])(r(),c)};return Object(o["r"])((function(){return t.lesions}),(function(t){a.lesions=t})),{state:a,deleteDrawItem:i,toPosition:c}}},l=c,u=(n("2c0a"),n("2877")),f=Object(u["a"])(l,r,a,!1,null,null,null);e["default"]=f.exports}}]);