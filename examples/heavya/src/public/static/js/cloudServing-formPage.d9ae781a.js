(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["cloudServing-formPage","cloudServing-components-servingCallGuide","cloudServing-components-forms-batchUploadDialog","cloudServing-components-forms-servingForm","cloudServing-util"],{"0370":function(e,t,r){"use strict";r("5e70")},"0ff8":function(e,t,r){"use strict";r.d(t,"i",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"k",(function(){return u})),r.d(t,"l",(function(){return f})),r.d(t,"f",(function(){return d})),r.d(t,"e",(function(){return m})),r.d(t,"h",(function(){return h})),r.d(t,"g",(function(){return p})),r.d(t,"j",(function(){return g}));var n=r("b775"),o=r("f121");function i(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services"),method:"get",params:e})}function a(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services"),method:"post",data:e})}function s(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services"),method:"put",data:e})}function c(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services"),method:"delete",data:{id:e}})}function l(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/detail"),method:"get",params:{id:e}})}function u(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/start"),method:"post",data:{id:e}})}function f(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/stop"),method:"post",data:{id:e}})}function d(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/predictParam"),method:"get",params:{id:e}})}function m(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/metrics/").concat(e),method:"get"})}function h(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/servingConfig/pod/").concat(e),method:"get"})}function p(e){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/rollback/").concat(e),method:"get"})}function g(e,t){return Object(n["a"])({url:"/".concat(o["a"].CLOUD_SERVING,"/services/predict"),method:"post",headers:{"Content-Type":"multipart/form-data"},params:t,data:e})}},2020:function(e,t,r){},"26b3":function(e,t,r){"use strict";r.d(t,"g",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return f})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return m}));var n=r("b775"),o=r("f121");function i(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices"),method:"get",params:e})}function a(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices"),method:"post",data:e})}function s(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices"),method:"put",data:e})}function c(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices"),method:"delete",data:{id:e}})}function l(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices/detail"),method:"get",params:{id:e}})}function u(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices/start"),method:"post",data:{id:e}})}function f(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices/stop"),method:"post",data:{id:e}})}function d(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices/pod/").concat(e),method:"get"})}function m(e){return Object(n["a"])({url:"/".concat(o["a"].BATCH_SERVING,"/batchServices/queryById/").concat(e),method:"get"})}},2988:function(e,t,r){"use strict";r.r(t),r.d(t,"SERVING_STATUS_ENUM",(function(){return h})),r.d(t,"ONLINE_SERVING_STATUS_MAP",(function(){return p})),r.d(t,"BATCH_SERVING_STATUS_MAP",(function(){return g})),r.d(t,"ONLINE_SERVING_TYPE",(function(){return v})),r.d(t,"serviceTypeMap",(function(){return y})),r.d(t,"map2Array",(function(){return b})),r.d(t,"numFormatter",(function(){return w})),r.d(t,"upload",(function(){return O})),r.d(t,"cpuFormatter",(function(){return C})),r.d(t,"memFormatter",(function(){return P})),r.d(t,"batchServingProgressColor",(function(){return L})),r.d(t,"getPollId",(function(){return _})),r.d(t,"parseObj",(function(){return j}));var n,o,i,a=r("ed08");function s(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function c(e,t){if(e){if("string"===typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function f(e,t,r){return t=d(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){var t=m(e,"string");return"symbol"===u(t)?t:String(t)}function m(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var h={EXCEPTION:"0",IN_DEPLOYMENT:"1",WORKING:"2",STOP:"3",COMPLETED:"4",UNKNOWN:"5"},p=(n={},f(n,h.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),f(n,h.WORKING,{name:"运行中",tagMap:"success"}),f(n,h.STOP,{name:"已停止",tagMap:"info"}),f(n,h.EXCEPTION,{name:"运行失败",tagMap:"danger"}),n),g=(o={},f(o,h.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),f(o,h.WORKING,{name:"运行中",tagMap:""}),f(o,h.STOP,{name:"已停止",tagMap:"info"}),f(o,h.EXCEPTION,{name:"运行失败",tagMap:"danger"}),f(o,h.COMPLETED,{name:"运行完成",tagMap:"success"}),f(o,h.UNKNOWN,{name:"未知",tagMap:"info"}),o),v={HTTP:0,GRPC:1},y=(i={},f(i,v.HTTP,"HTTP 模式"),f(i,v.GRPC,"GRPC 模式"),i);function b(e){var t=[];if("object"!==u(e)||null===e)return t;for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];t.push({name:o,type:e[o]})}return t}function w(e){return e<1e4?"".concat(e):"".concat(Math.round(e/1e3)/10,"万")}function S(e){var t=e.response||e.responseText;try{return JSON.parse(t)}catch(r){return t}}function O(e){var t,r=new XMLHttpRequest,n=new FormData,o=s(e.fileList);try{for(o.s();!(t=o.n()).done;){var i=t.value;n.append(e.uploadName,i,i.name)}}catch(a){o.e(a)}finally{o.f()}return r.upload&&e.onUploadProgress&&(r.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onUploadProgress(t)}),r.onreadystatechange=function(){if(4===r.readyState){var t=S(r);if(r.status<200||r.status>=300){var n=new Error(t.msg||"未知错误");return e.onUploadError(n)}e.onUploadSuccess(t)}},r.open("post",e.requestUrl,!0),r.send(n),r}function C(e,t){return t?("n"===t&&(e/=1e6,t="m"),"m"===t?"".concat(Math.round(10*e)/10,"m"):e+t):"".concat(e,"核")}function P(e,t){return"".concat(Math.round(10*Object(a["qb"])(e,t))/10," Gi")}var L=[{color:"#67c23a",percentage:100}];function _(){return(new Date).getTime()}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"; ";return e instanceof Object?Object.keys(e).filter((function(t){return null!==e[t]||""!==e[t]})).map((function(t){return"".concat(t,": ").concat(e[t])})).join(t):""}},5346:function(e,t,r){"use strict";r("986a")},"5d71":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"服务名称",prop:"name"}},[r("el-input",{ref:"nameInput",attrs:{maxlength:"32","show-word-limit":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"服务类型",prop:"type"}},[r("el-radio-group",{on:{change:e.onTypeChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[r("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("HTTP 模式")]),e._v(" "),r("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("GRPC 模式")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"服务描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:4,maxlength:"200","show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),r("el-divider"),e._v(" "),e._l(e.modelConfigList,(function(t,n){return r("el-card",{key:t.id,staticClass:"mb-10 ml-120"},[r("ServingModelConfig",{ref:"modelConfig",refInFor:!0,attrs:{"label-width":"120px",deletable:e.modelConfigList.length>=2,config:t,"model-disabled":0!==n,"model-address-map":e.modelBranchIdMap,"release-rate-disabled":1===e.modelConfigList.length,"release-rate-sum-valid":e.releaseRateSumValid,"node-count-valid":e.nodeCountValid},on:{"model-resource-change":e.onModelResourceChange,"model-change":e.onModelChange,"model-version-change":function(r){return e.onModelVersionChange(t.id,r)},"release-rate-change":function(t){return e.onModelReleaseRateChange(t,n)},change:function(t){return e.onModelConfigChange(t,n)},delete:e.onModelConfigDelete}})],1)})),e._v(" "),r("el-button",{staticClass:"ml-120",attrs:{icon:"el-icon-circle-plus-outline",disabled:e.disableAddModelConfig},on:{click:e.addModelConfig}},[e._v("添加模型版本进行灰度发布")])],2)},o=[],i=r("61f7"),a=r("f121"),s=r("2988"),c=r("c844");function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e){return h(e)||m(e)||d(e)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){if(e){if("string"===typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function m(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function h(e){if(Array.isArray(e))return p(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t=b(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e){var t=w(e,"string");return"symbol"===l(t)?t:String(t)}function w(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var S={id:null,name:null,type:s["ONLINE_SERVING_TYPE"].HTTP,description:null,modelConfigList:[]},O={modelResource:0,modelId:null,modelBranchId:null,imageName:null,imageTag:null,resourcesPoolType:0,resourcesPoolSpecs:null,resourcesPoolNode:1,releaseRate:100,deployParams:{},useScript:!1,algorithmId:null},C=1,P={name:"ServingForm",components:{ServingModelConfig:c["default"]},data:function(){return{modelConfigList:[],modelBranchIdMap:{},isPresetModel:!1,releaseRateSumValid:!0,nodeCountValid:!0,form:v(v({},S),{},{modelConfigList:[]}),rules:{name:[{required:!0,message:"请输入服务名称",trigger:["blur","change"]},{max:32,message:"长度在 32 个字符以内",trigger:["blur","change"]},{validator:i["q"],trigger:["blur","change"]}],type:[{required:!0,message:"请选择服务类型",trigger:"change"}]}}},computed:{disableAddModelConfig:function(){return this.form.type===s["ONLINE_SERVING_TYPE"].GRPC||this.modelConfigList.length>=2||this.isPresetModel}},methods:{onTypeChange:function(e){e===s["ONLINE_SERVING_TYPE"].GRPC&&this.modelConfigList.length>1&&(this.modelBranchIdMap=y({},this.modelConfigList[0].id,this.modelConfigList[0].modelBranchId),this.modelConfigList.splice(1,this.modelConfigList.length-1),this.modelConfigList.length&&this.$refs.modelConfig[0].updateReleaseRate(100))},onModelResourceChange:function(e){this.modelBranchIdMap={},this.isPresetModel=1===e,this.modelConfigList.splice(1,this.modelConfigList.length-1),this.modelConfigList.length&&this.$refs.modelConfig[0].updateReleaseRate(100)},onModelChange:function(e){for(var t=1;t<this.modelConfigList.length;t+=1)this.$refs.modelConfig[t].updateModel(e);this.modelBranchIdMap={}},onModelVersionChange:function(e,t){this.updateModelAddressMap(e,t)},onModelReleaseRateChange:function(e,t){this.modelConfigList[t].releaseRate=e,2===this.modelConfigList.length&&this.$refs.modelConfig[1-t].updateReleaseRate(100-e),this.validateReleaseRate()},onModelConfigChange:function(e,t){this.modelConfigList[t]=e,this.validateReleaseRate(),this.validateNodeCount()},onModelConfigDelete:function(e){var t=this,r=this.modelConfigList.findIndex((function(t){return t.id===e}));-1!==r&&(this.modelConfigList.splice(r,1),Reflect.deleteProperty(this.modelBranchIdMap,e)),this.$nextTick((function(){1===t.modelConfigList.length?t.$refs.modelConfig[0].updateReleaseRate(100):t.validateReleaseRate()}))},initForm:function(e){var t=this,r=e||Object.create(null);Object.keys(this.form).forEach((function(e){r[e]&&(t.form[e]=r[e])})),this.modelConfigList=u(this.form.modelConfigList)||[],this.modelConfigList.length||this.modelConfigList.push(v({},O)),this.isPresetModel=1===this.modelConfigList[0].modelResource,this.modelConfigList.forEach((function(e){Object.keys(O).forEach((function(t){void 0===e[t]&&(e[t]=O[t])})),e.id=C++,t.modelBranchIdMap[e.id]=e.modelBranchId||void 0})),this.$nextTick((function(){t.clearValidate()}))},resetForm:function(){var e=this;this.form=v(v({},S),{},{modelConfigList:[]}),this.modelBranchIdMap={},this.$nextTick((function(){e.clearValidate()}))},validate:function(e,t){var r=!0;this.$refs.form.validate((function(e){e||(r=!1)})),this.$refs.modelConfig.forEach((function(e){e.validate(null,(function(){r=!1}))})),r=r&&this.releaseRateSumValid&&this.nodeCountValid,r?(this.form.modelConfigList=this.modelConfigList,e&&e(this.form)):t&&t()},clearValidate:function(){this.releaseRateSumValid=!0;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.$refs.form.clearValidate.apply(this,t)},addModelConfig:function(){var e=v(v({},O),{},{id:C++}),t=100;this.modelConfigList.forEach((function(e){t-=e.releaseRate})),e.releaseRate=t>=0?t:0,this.modelConfigList.length&&(e.modelId=this.modelConfigList[0].modelId),this.modelConfigList.push(e)},validateReleaseRate:function(){var e=0;this.modelConfigList.forEach((function(t){e+=t.releaseRate})),this.releaseRateSumValid=100===e},validateNodeCount:function(){var e=this.modelConfigList.reduce((function(e,t){return e+t.resourcesPoolNode}),0);this.nodeCountValid=e<=a["h"].onlineServingNodeSumMax},updateModelAddressMap:function(e,t){this.modelBranchIdMap=v(v({},this.modelBranchIdMap),{},y({},e,t))}}},L=P,_=(r("dc97"),r("2877")),j=Object(_["a"])(L,n,o,!1,null,"2c7892bd",null);t["default"]=j.exports},"5e70":function(e,t,r){},"777e":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",staticClass:"model-config-wrapper",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[r("BatchUploadDialog",{ref:"imgUploadDialog",attrs:{action:"fackApi",params:e.uploadParams,accept:"unspecified",limit:5e3,filters:e.uploadFilters,"data-type":"text"},on:{"upload-success":e.onUploadSuccess,close:e.onUploadClose}}),e._v(" "),r("el-form-item",{attrs:{label:"服务名称",prop:"name"}},[r("el-input",{ref:"nameInput",attrs:{maxlength:"32","show-word-limit":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"服务描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:4,maxlength:"200","show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),r("el-divider"),e._v(" "),r("el-form-item",{attrs:{label:"模型类型",prop:"modelResource"}},[r("el-radio-group",{on:{change:e.onModelResourceChange},model:{value:e.form.modelResource,callback:function(t){e.$set(e.form,"modelResource",t)},expression:"form.modelResource"}},[r("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("我的模型")]),e._v(" "),r("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("预训练模型")])],1)],1),e._v(" "),r("el-form-item",{ref:"modelBranchId",attrs:{prop:"modelBranchId",label:"模型"}},[r("el-select",{attrs:{placeholder:"请选择模型",filterable:""},on:{change:e.onModelChange},model:{value:e.form.modelId,callback:function(t){e.$set(e.form,"modelId",t)},expression:"form.modelId"}},e._l(e.modelList,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.name+" ("+e.dict.label.frame_type[t.frameType]+")"}})})),1),e._v(" "),e.isPresetModel?e._e():r("el-select",{attrs:{placeholder:"请选择模型版本",filterable:""},on:{change:e.onModelVersionChange},model:{value:e.form.modelBranchId,callback:function(t){e.$set(e.form,"modelBranchId",t)},expression:"form.modelBranchId"}},e._l(e.modelVersionList,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.version}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"自定义推理脚本"}},[r("el-switch",{on:{change:e.onUseScriptChange},model:{value:e.form.useScript,callback:function(t){e.$set(e.form,"useScript",t)},expression:"form.useScript"}})],1),e._v(" "),e.form.useScript?r("el-form-item",{staticClass:"form-item-follower",attrs:{prop:"algorithmId",error:e.scriptErrMsg}},[r("div",{staticClass:"tip px-20"},[e._v("\n      开启该选项将会使用自定义推理脚本进行推理\n    ")]),e._v(" "),r("el-select",{staticClass:"w-200 mt-10",attrs:{placeholder:"请选择自定义推理脚本",filterable:""},model:{value:e.form.algorithmId,callback:function(t){e.$set(e.form,"algorithmId",t)},expression:"form.algorithmId"}},e._l(e.algorithmList,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.algorithmName}})})),1),e._v(" "),r("span",{staticClass:"ml-10"},[e._v("\n      推理脚本未上传？点击\n      "),r("el-link",{staticClass:"lh-20",attrs:{type:"primary"},on:{click:e.goCreateAlgorithm}},[e._v("\n        这里\n      ")]),e._v("\n      上传推理脚本\n    ")],1)],1):e._e(),e._v(" "),r("el-form-item",{ref:"imageTag",attrs:{label:"镜像选择",prop:"imageTag"}},[r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择镜像",clearable:"",filterable:""},on:{change:e.onImageNameChange},model:{value:e.form.imageName,callback:function(t){e.$set(e.form,"imageName",t)},expression:"form.imageName"}},e._l(e.imageNameList,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1),e._v(" "),r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择镜像版本",clearable:"",filterable:""},on:{change:function(t){return e.validateField("imageTag")}},model:{value:e.form.imageTag,callback:function(t){e.$set(e.form,"imageTag",t)},expression:"form.imageTag"}},e._l(e.imageTagList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.imageTag,value:e.imageTag}})})),1)],1),e._v(" "),r("el-form-item",{staticClass:"is-required",attrs:{prop:"inputPath",label:"上传预测文件",error:e.inputPathErrorMsg}},[r("el-button",{on:{click:e.onUploadDialogClick}},[e._v("上传文件")]),e._v(" "),!e.isAdd||e.uploaded?r("i",{staticClass:"el-icon-circle-check success f18 vm"}):e._e(),e._v(" "),e.isAdd?e._e():r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑服务和 Fork 服务时，无需重新上传文件",placement:"right"}},[r("i",{staticClass:"el-icon-warning-outline primary f18 vm"})])],1),e._v(" "),r("RunParamForm",{ref:"deployParamForm",staticClass:"w120",attrs:{"run-param-obj":e.form.deployParams||{},prop:"runParams","param-label-width":"120px"},on:{updateRunParams:e.updateDeployParams}}),e._v(" "),r("el-form-item",{attrs:{label:"节点类型",prop:"resourcesPoolType"}},[r("el-radio-group",{on:{change:e.onNodeTypeChange},model:{value:e.form.resourcesPoolType,callback:function(t){e.$set(e.form,"resourcesPoolType",t)},expression:"form.resourcesPoolType"}},[r("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("CPU")]),e._v(" "),r("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("GPU")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"节点规格",prop:"resourcesPoolSpecs"}},[r("el-select",{attrs:{placeholder:"请选择节点规格",filterable:""},model:{value:e.form.resourcesPoolSpecs,callback:function(t){e.$set(e.form,"resourcesPoolSpecs",t)},expression:"form.resourcesPoolSpecs"}},e._l(e.specsList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.specsName,value:e.specsName}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"resourcesPoolNode",label:"节点数量"}},[r("el-input-number",{staticClass:"w-200",attrs:{min:1,max:10,"step-strictly":""},model:{value:e.form.resourcesPoolNode,callback:function(t){e.$set(e.form,"resourcesPoolNode",t)},expression:"form.resourcesPoolNode"}})],1),e._v(" "),r("BaseModal",{attrs:{visible:e.algorithmFormVisible,title:"上传自定义推理脚本",loading:e.algorithmFormSubmitting,width:"800px"},on:{"update:visible":function(t){e.algorithmFormVisible=t},close:e.onDialogClose,cancel:function(t){e.algorithmFormVisible=!1},ok:e.onSubmitForm}},[r("AlgorithmForm",{ref:"algorithmForm",attrs:{"form-type":"serving"}})],1)],1)},o=[],i=r("2f62"),a=r("ed08"),s=r("8bbd"),c=r("0be6"),l=r("a40c"),u=r("9eb2"),f=r("0c61"),d=r("61f7"),m=r("42b1"),h=r("f109"),p=r("9a71"),g=r("c83b");function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function y(e,t){return C(e)||O(e,t)||w(e,t)||b()}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){if(e){if("string"===typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(u){l=!0,o=u}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}function C(e){if(Array.isArray(e))return e}function P(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */P=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(E){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),s=new j(o||[]);return n(a,"_invoke",{value:O(e,r,s)}),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(E){return{type:"throw",arg:E}}}e.wrap=l;var f={};function d(){}function m(){}function h(){}var p={};c(p,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(I([])));y&&y!==t&&r.call(y,i)&&(p=y);var b=h.prototype=d.prototype=Object.create(p);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function o(n,i,a,s){var c=u(e[n],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==v(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function O(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=C(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function C(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=u(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return m.prototype=h,n(b,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:m,configurable:!0}),m.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(S.prototype),c(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(b),c(b,s,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function L(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(l){return void r(l)}s.done?t(c):Promise.resolve(c).then(n,o)}function _(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){L(i,n,o,a,s,"next",e)}function s(e){L(i,n,o,a,s,"throw",e)}a(void 0)}))}}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){T(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function T(e,t,r){return t=E(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){var t=x(e,"string");return"symbol"===v(t)?t:String(t)}function x(e,t){if("object"!==v(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var N={id:null,name:null,description:null,modelResource:0,modelId:null,modelBranchId:null,imageName:null,imageTag:null,inputPath:null,resourcesPoolType:0,resourcesPoolSpecs:null,resourcesPoolNode:1,deployParams:{},useScript:!1,algorithmId:null},k={name:"BatchServingForm",dicts:["frame_type"],components:{RunParamForm:m["a"],BatchUploadDialog:g["default"],BaseModal:h["a"],AlgorithmForm:p["default"]},data:function(){var e=this;return{formType:"add",modelList:[],modelVersionList:[],algorithmList:[],imageNameList:[],imageTagList:[],specsList:[],uploadVisiable:!1,uploaded:!1,inputPathValid:!0,scriptValid:!0,form:I({},N),rules:{name:[{required:!0,message:"请输入服务名称",trigger:["blur","change"]},{max:32,message:"长度在 32 个字符以内",trigger:["blur","change"]},{validator:d["q"],trigger:["blur","change"]}],modelBranchId:[{required:!0,trigger:"manual",validator:function(t,r,n){e.isPresetModel&&!e.form.modelId&&n(new Error("请选择模型")),e.isPresetModel||e.form.modelBranchId||n(new Error("请选择模型及版本")),n()}}],modelResource:[{required:!0,message:"请选择模型类型",trigger:"change"}],resourcesPoolType:[{required:!0,message:"请选择节点类型",trigger:"change"}],resourcesPoolSpecs:[{required:!0,message:"请选择节点规格",trigger:"change"}],imageTag:[{required:!0,message:"请选择镜像",trigger:"manual"}]},uploadFilters:[a["ib"]],algorithmFormVisible:!1,algorithmFormSubmitting:!1}},computed:I(I({},Object(i["d"])(["user"])),{},{isAdd:function(){return"add"===this.formType},isFork:function(){return"fork"===this.formType},isPresetModel:function(){return 1===this.form.modelResource},inputPathErrorMsg:function(){return this.inputPathValid?null:"请先上传文件"},scriptErrMsg:function(){return this.scriptValid?"":"请选择自定义推理脚本"},uploadParams:function(){return{objectPath:this.form.inputPath}}}),methods:{getModels:function(){var e=_(P().mark((function e(t){var r,n,o=this,i=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],e.next=3,Object(s["k"])(t);case 3:if(this.modelList=e.sent,r&&this.form.modelId){e.next=8;break}this.form.modelBranchId=null,e.next=14;break;case 8:if(n=this.modelList.find((function(e){return e.id===o.form.modelId})),n){e.next=13;break}return this.$message.warning("原有模型不存在或不支持部署，请重新选择"),this.form.modelId=this.form.modelBranchId=null,e.abrupt("return");case 13:0===t&&this.getModelVersions(n.id,!0);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getModelVersions:function(){var e=_(P().mark((function e(t){var r,n,o,i=this,a=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]&&a[1],e.next=3,Object(c["f"])({parentId:t,current:1,size:500});case 3:n=e.sent,this.modelVersionList=n.result,r&&this.form.modelBranchId&&(o=this.modelVersionList.find((function(e){return e.id===i.form.modelBranchId})),o||(this.form.modelBranchId=null,this.$message.warning("原有模型版本不存在，请重新选择")));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),clearValidateField:function(e){this.$refs[e].clearValidate()},validateField:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual";this.$refs[e].validate(t)},onModelResourceChange:function(e){this.form.modelId=this.form.modelBranchId=null,this.getModels(e),this.clearValidateField("modelBranchId")},onModelChange:function(e){this.form.modelId=e,this.isPresetModel?this.validateField("modelBranchId"):(this.getModelVersions(e),this.form.modelBranchId=null)},onModelVersionChange:function(){this.validateField("modelBranchId")},onUploadSuccess:function(){this.uploaded=!0,this.inputPathValid=!0},onUploadClose:function(){this.inputPathValid=!this.isAdd||this.uploaded},onNodeTypeChange:function(){var e=_(P().mark((function e(){return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.getSpecList();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),validate:function(){var e=_(P().mark((function e(t,r){var n,o,i,a,s,c,l,u,f=this;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=!0,o=function(e){n=n&&e},this.$refs.form.validate(o),this.inputPathValid=!this.isAdd||this.uploaded,n=n&&this.inputPathValid,n=this.validateScript()&&n,n?(i=this.specsList.find((function(e){return e.specsName===f.form.resourcesPoolSpecs})),i&&(a=i.cpuNum,s=i.gpuNum,c=i.memNum,l=i.workspaceRequest,u={cpuNum:1e3*a,gpuNum:s,memNum:c,workspaceRequest:"".concat(l,"M")},this.form.poolSpecsInfo=JSON.stringify(u)),this.form.deployParams=I({},this.deployParams),t&&t(this.form)):r&&r();case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),initForm:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add",n=e||Object.create(null);this.formType=r,Object.keys(this.form).forEach((function(e){n[e]&&(t.form[e]=n[e])})),this.form.deployParams=n.deployParams||Object.create(null),"fork"===r&&(this.form.name+="-Fork"),this.getModels(this.form.modelResource,!0),this.getImageNames(!0),this.getAlgorithms(!0),this.getSpecList(!0),this.form.inputPath||this.updateObjectPath(),this.$nextTick((function(){t.$refs.form.clearValidate()}))},resetForm:function(){var e=this;this.form=I({},N),this.form.deployParams=Object.create(null),this.$nextTick((function(){e.clearValidate()}))},clearValidate:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.$refs.form.clearValidate.apply(this,t)},updateObjectPath:function(){this.form.inputPath="serving/input/".concat(this.user.id,"/").concat(Object(a["ab"])())},onUploadDialogClick:function(){this.$refs.imgUploadDialog.show()},getAlgorithms:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(u["e"])().then((function(r){e.algorithmList=r,t&&e.form.algorithmId&&(e.algorithmList.some((function(t){return t.id===e.form.algorithmId}))||(e.$message.warning("原有算法不存在，请重新选择"),e.form.algorithmId=null))}))},onUseScriptChange:function(e){this.form.algorithmId=null,!e&&this.validateScript()},goCreateAlgorithm:function(){var e=this;this.algorithmFormVisible=!0,this.$nextTick((function(){e.$refs.algorithmForm.initForm({inference:!0})}))},validateScript:function(){return this.form.useScript?this.scriptValid=null!==this.form.algorithmId:this.scriptValid=!0,this.scriptValid},getImageNames:function(){var e=_(P().mark((function e(){var t,r=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.next=3,Object(l["d"])({imageTypes:[a["g"].SERVING]});case 3:this.imageNameList=e.sent,t&&this.form.imageName?this.imageNameList.includes(this.form.imageName)?this.getImageTags(this.form.imageName,!0):(this.$message.warning("原有镜像不存在，请重新选择"),this.form.imageName=this.form.imageTag=null):this.form.imageTag=null;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getImageTags:function(){var e=_(P().mark((function e(t){var r,n=this,o=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]&&o[1],e.next=3,Object(l["e"])({imageName:t});case 3:this.imageTagList=e.sent,r&&this.form.imageTag&&(this.imageTagList.some((function(e){return e.imageTag===n.form.imageTag}))||(this.$message.warning("原有镜像版本不存在，请重新选择"),this.form.imageTag=null));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onImageNameChange:function(e){this.form.imageTag=null,e?this.getImageTags(e):this.imageTagList=[]},updateDeployParams:function(e){this.deployParams=e},onDialogClose:function(){var e=this;setTimeout((function(){e.$refs.algorithmForm.resetForm()}),700)},onSubmitForm:function(){var e=this;this.$refs.algorithmForm.validate(function(){var t=_(P().mark((function t(r){var n,o;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.algorithmFormSubmitting=!0,t.next=3,Object(u["a"])(r).finally((function(){e.algorithmFormSubmitting=!1}));case 3:n=t.sent,o=y(n,1),e.form.algorithmId=o[0],e.algorithmFormVisible=!1,e.getAlgorithms(!0);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getSpecList:function(){var e=_(P().mark((function e(){var t,r=this,n=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,Object(f["d"])({module:a["p"].SERVING,resourcesPoolType:this.form.resourcesPoolType,current:1,size:500});case 3:this.specsList=e.sent.result,t&&this.form.resourcesPoolSpecs?this.specsList.find((function(e){return e.specsName===r.form.resourcesPoolSpecs}))||(this.$message.warning("原有资源规格不存在，请重新选择"),this.specsList.length&&(this.form.resourcesPoolSpecs=this.specsList[0].specsName)):this.specsList.length&&(this.form.resourcesPoolSpecs=this.specsList[0].specsName);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},R=k,M=(r("c6cf"),r("2877")),V=Object(M["a"])(R,n,o,!1,null,"dc0d5dbc",null);t["default"]=V.exports},7946:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container",attrs:{id:"form-page-wrapper"}},["onlineServing"===e.pageType?r("ServingForm",{ref:"form",attrs:{"label-width":"120px"}}):e._e(),e._v(" "),"batchServing"===e.pageType?r("BatchServingForm",{ref:"form",attrs:{"label-width":"120px"}}):e._e(),e._v(" "),r("div",{attrs:{id:"btns-wrapper"}},[r("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submit}},[e._v("提交")])],1)],1)},o=[],i=r("0ff8"),a=r("26b3"),s=r("ed08"),c=r("5d71"),l=r("777e");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function f(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(E){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),s=new j(o||[]);return n(a,"_invoke",{value:C(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(E){return{type:"throw",arg:E}}}e.wrap=l;var m={};function h(){}function p(){}function g(){}var v={};c(v,i,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(I([])));b&&b!==t&&r.call(b,i)&&(v=b);var w=g.prototype=h.prototype=Object.create(v);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function o(n,i,a,s){var c=d(e[n],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==u(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function C(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=P(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function P(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,P(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=d(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,m;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=g,n(w,"constructor",{value:g,configurable:!0}),n(g,"constructor",{value:p,configurable:!0}),p.displayName=c(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},S(O.prototype),c(O.prototype,a,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(w),c(w,s,"Generator"),c(w,i,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},e}function d(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(l){return void r(l)}s.done?t(c):Promise.resolve(c).then(n,o)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){d(i,n,o,a,s,"next",e)}function s(e){d(i,n,o,a,s,"throw",e)}a(void 0)}))}}var h={onlineServing:{title:"在线",listPageName:"CloudServing",submitFunc:{add:i["a"],edit:i["d"]}},batchServing:{title:"批量",listPageName:"BatchServing",submitFunc:{add:a["a"],edit:a["d"],fork:a["a"]}}},p={name:"CloudServingFormPage",components:{ServingForm:c["default"],BatchServingForm:l["default"]},data:function(){return{formType:"add",submitting:!1,pageType:null}},beforeRouteEnter:function(e,t,r){var n,o=e.query.type,i=e.params,a=i.id,c=i.formType,l=-1!==["onlineServing","batchServing"].indexOf(o)?o:"onlineServing",u=a?c||"edit":"add",f=null===(n=h[l])||void 0===n?void 0:n.title,d="".concat(s["f"].FORM_TYPE_MAP[u]).concat(f,"服务");e.meta.title=d,Object(s["Tb"])(d),r()},created:function(){var e=m(f().mark((function e(){var t,r,n,o,i,a,s,c,l,u=this;return f().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.$route.query.type,r=this.$route.params,n=r.id,o=r.formType,this.formType=n?o||"edit":"add",this.pageType=-1!==["onlineServing","batchServing"].indexOf(t)?t:"onlineServing",e.t0=this.formType,e.next="edit"===e.t0||"fork"===e.t0?7:(e.t0,9);break;case 7:return this.$nextTick(m(f().mark((function e(){return f().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=u.$refs.form,e.next=3,u.getServingDetail(n);case 3:e.t1=e.sent,e.t2=u.formType,e.t0.initForm.call(e.t0,e.t1,e.t2);case 6:case"end":return e.stop()}}),e)})))),e.abrupt("break",11);case 9:return"model"===this.$route.params.from?(i=this.$route.params,a=i.modelId,s=i.modelBranchId,c=i.modelAddress,l=i.modelResource,this.$nextTick((function(){u.$refs.form.initForm(u.getInitForm({modelId:a,modelBranchId:s,modelAddress:c,modelResource:l}))}))):this.$nextTick((function(){u.$refs.form.initForm()})),e.abrupt("break",11);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{getServingDetail:function(e){switch(this.pageType){case"onlineServing":return Object(i["c"])(e);case"batchServing":default:return Object(a["c"])(e)}},getInitForm:function(e){var t=e.modelId,r=e.modelBranchId,n=e.modelAddress,o=e.modelResource;switch(this.pageType){case"onlineServing":return{modelConfigList:[{modelId:t,modelBranchId:r,modelAddress:n,modelResource:o}]};case"batchServing":default:return{modelId:t,modelBranchId:r,modelAddress:n,modelResource:o}}},submit:function(){var e=this;this.submitting||this.$refs.form.validate((function(t){var r,n=null===(r=h[e.pageType])||void 0===r?void 0:r.submitFunc[e.formType];n&&(e.submitting=!0,n(t).then((function(){e.$router.push({name:h[e.pageType].listPageName,params:{pageType:e.pageType,formType:e.formType}})})).finally((function(){e.submitting=!1})))}))}}},g=p,v=(r("0370"),r("2877")),y=Object(v["a"])(g,n,o,!1,null,"0c855247",null);t["default"]=y.exports},"986a":function(e,t,r){},c6cf:function(e,t,r){"use strict";r("ceb4")},c83b:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("BaseModal",{staticClass:"upload-dialog",attrs:{title:"上传文件",visible:e.visible,width:"600px"},on:{"update:visible":function(t){e.visible=t},close:e.onClose},scopedSlots:e._u([{key:"footer",fn:function(){return[r("div",[r("el-button",{on:{click:e.onClickCancel}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.uploading},on:{click:e.onClickConfirm}},[e._v(e._s(e.confirmText))])],1)]},proxy:!0}])},[r("el-steps",{attrs:{active:e.activeStep,"align-center":"","finish-status":"success"}},[r("el-step",{attrs:{title:"选择文件"}}),e._v(" "),r("el-step",{attrs:{title:"上传文件",status:e.uploadStatus}})],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.activeStep,expression:"activeStep === 0"}]},[r("UploadInline",e._b({ref:"upload",attrs:{"before-remove":e.onBeforeRemove},on:{fileChange:e.onFileChange,uploadError:e.onUploadError}},"UploadInline",e.$attrs,!1))],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.activeStep,expression:"activeStep === 1"}]},[r("el-progress",{staticClass:"progress",attrs:{type:"circle",status:e.uploadStatus,percentage:e.uploadPercent}})],1)],1)},o=[],i=r("5c96"),a=r("ed09"),s=r("ed08"),c=r("f109"),l=r("7f969");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t=h(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){var t=p(e,"string");return"symbol"===u(t)?t:String(t)}function p(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var g={name:"BatchUploadDialog",components:{BaseModal:c["a"],UploadInline:l["a"]},setup:function(e,t){var r={activeStep:0,uploadPercent:0,uploadStatus:void 0,uploading:!1,visible:!1,fileList:[],errFileList:[]},n=Object(a["n"])(d({},r)),o=Object(a["o"])(null),c=function(e,t){n.fileList=t},l=function(){i["Message"].error("上传失败"),n.uploading=!1},u=function(e,t){return t.includes(e)},f=function(){n.visible=!1,o.value.formRef.cancelUpload()},m=0,h=0,p=function(){if(h===n.fileList.length)return n.uploadStatus="success",i["Message"].success("上传成功"),n.uploading=!1,void t.emit("upload-success");n.errFileList.length&&n.errFileList.length+h===n.fileList.length&&(n.uploadStatus="exception",i["Message"].error("文件 ".concat(n.errFileList.map((function(e){return e.name})).join("、")," 上传错误")),n.uploading=!1)},g=function(){var e=m;switch(n.activeStep){case 0:h=0,n.errFileList=[],o.value.uploadSubmit((function(t,r){if(e===m){h=t;var o=Object(s["Qb"])(t/r.length);n.uploadPercent=o>100?100:o,p()}}),(function(t){e===m&&(n.errFileList.push(t),p())})),n.activeStep=1,n.uploading=!0;break;case 1:default:n.visible=!1;break}},v=Object(a["a"])((function(){return 0===n.activeStep?"下一步":"完成"})),y=function(){o.value.formRef.reset(),setTimeout((function(){Object.assign(n,Object(a["n"])(d({},r))),m+=1}))},b=function(){t.emit("close"),y()},w=function(){n.visible=!1},S=function(){n.visible=!0};return d(d({},Object(a["q"])(n)),{},{upload:o,onFileChange:c,onUploadError:l,onBeforeRemove:u,onClickCancel:f,onClickConfirm:g,confirmText:v,onClose:b,onCancel:w,show:S})}},v=g,y=(r("5346"),r("2877")),b=Object(y["a"])(v,n,o,!1,null,"df52fbbc",null);t["default"]=b.exports},ceb4:function(e,t,r){},dc97:function(e,t,r){"use strict";r("2020")}}]);