(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["dataset-pointCloud-editor-core-editor","dataset-pointCloud-editor-core-boundingBox","dataset-pointCloud-editor-core-consts","dataset-pointCloud-editor-core-pointCloudView"],{"66e9":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return b}));var r=i("5c96"),n=i("6eb8"),o=i("6b42"),a=i("d0bd");function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){m(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */u=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(C){l=function(e,t,i){return e[t]=i}}function h(e,t,i,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new P(n||[]);return r(a,"_invoke",{value:E(e,i,s)}),a}function v(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(C){return{type:"throw",arg:C}}}e.wrap=h;var d={};function f(){}function p(){}function m(){}var y={};l(y,o,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(j([])));b&&b!==t&&i.call(b,o)&&(y=b);var O=m.prototype=f.prototype=Object.create(y);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(r,o,a,c){var l=v(e[r],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==s(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var o;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return o=o?o.then(r,r):r()}})}function E(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return N()}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=S(a,i);if(s){if(s===d)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var c=v(e,t,i);if("normal"===c.type){if(r=i.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r="completed",i.method="throw",i.arg=c.arg)}}}function S(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=v(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function V(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(V,this),this.reset(!0)}function j(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:N}}function N(){return{value:void 0,done:!0}}return p.prototype=m,r(O,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(O),e},e.awrap=function(e){return{__await:e}},g(T.prototype),l(T.prototype,a,(function(){return this})),e.AsyncIterator=T,e.async=function(t,i,r,n,o){void 0===o&&(o=Promise);var a=new T(h(t,i,r,n),o);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(O),l(O,c,"Generator"),l(O,o,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;x(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:j(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function h(e,t,i,r,n,o,a){try{var s=e[o](a),c=s.value}catch(l){return void i(l)}s.done?t(c):Promise.resolve(c).then(r,n)}function v(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var o=e.apply(t,i);function a(e){h(o,r,n,a,s,"next",e)}function s(e){h(o,r,n,a,s,"throw",e)}a(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function p(e,t,i){return t&&f(e.prototype,t),i&&f(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t,i){return t=y(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function y(e){var t=w(e,"string");return"symbol"===s(t)?t:String(t)}function w(e,t){if("object"!==s(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var b=function(){function e(){var t=this;d(this,e),m(this,"render",(function(){t.view.animationRender()})),this.data=new o["DataProcessing"],this.view=new n["PointCloudView"](this.data),this.storeFunction=null}return p(e,[{key:"html",value:function(){return this.view.canvasDom()}},{key:"loadPcd",value:function(){this.view.loadPointCloud()}},{key:"switchTools",value:function(){this.view.changeCameraContorl()}},{key:"resetEditor",value:function(){var e=v(u().mark((function e(){return u().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.data.resetState(),e.next=3,this.data.getAnnotatedInfo();case 3:this.view.resetView();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isAllVisible",get:function(){var e,t,i,r=null===(e=this.view.views.main.scene.children[0])||void 0===e||null===(t=e.children)||void 0===t||null===(i=t.filter((function(e){return!0===e.visible&&"virtual"!==e.name})))||void 0===i?void 0:i.length;return[0,void 0].includes(r)}},{key:"selectObject",get:function(){var e,t;return null===(e=this.view.selected)||void 0===e||null===(t=e.main)||void 0===t?void 0:t.name}},{key:"getVisible",value:function(e){var t,i;return null===(t=this.view.views.main.scene.children[0])||void 0===t||null===(i=t.children)||void 0===i?void 0:i.filter((function(t){var i,r;return(null===(i=t.userData)||void 0===i||null===(r=i.labelInfo)||void 0===r?void 0:r.name)===e&&t.visible})).length}},{key:"setMeshOpacity",value:function(e){var t,i=this;this.data.meshOpacity=e,null===(t=this.view.views.main.scene.children[0])||void 0===t||t.traverseVisible((function(t){var r,n=t.material,o=t.name,a=t.type;n&&o!==(null===(r=i.view.selected)||void 0===r?void 0:r.main.name)&&"Sprite"!==a&&(n.opacity=e/100)}))}},{key:"setAllVisible",value:function(e){var t,i;null===(t=this.view.views.main.scene.children[0])||void 0===t||null===(i=t.children)||void 0===i||i.forEach((function(t){"virtual"!==t.name&&(t.visible=e)})),this.view.selected&&this.view.selected.setOtherVisible(!1),this.view.setHelperVisible(!1),this.view.selected=null}},{key:"setVisibleObject",value:function(e){var t,i;this.view.views.main.scene.children[0].getObjectByName(e).visible=!this.view.views.main.scene.children[0].getObjectByName(e).visible,(null===(t=this.view.selected)||void 0===t||null===(i=t.main)||void 0===i?void 0:i.name)===e&&(this.view.selected.setOtherVisible(!1),this.view.setHelperVisible(!1),this.view.selected=null)}},{key:"setVisibleLabel",value:function(e,t){var i,r=this;null===(i=this.view.views.main.scene.children[0])||void 0===i||i.traverse((function(i){var n,o,a,s;(null===(n=i.userData)||void 0===n||null===(o=n.labelInfo)||void 0===o?void 0:o.name)===t&&(i.visible=e,(null===(a=r.view.selected)||void 0===a||null===(s=a.main)||void 0===s?void 0:s.name)===i.name&&(r.view.selected.setOtherVisible(!1),r.view.setHelperVisible(!1),r.view.selected=null))}))}},{key:"deleteObject",value:function(e){var t,i,n=this;Object.keys(this.view.views).forEach((function(t){var i,r;null===(i=n.view.views[t].scene)||void 0===i||i.children[0].remove(null===(r=n.view.views[t].scene)||void 0===r?void 0:r.children[0].getObjectByName(e))})),(null===(t=this.view.selected)||void 0===t||null===(i=t.main)||void 0===i?void 0:i.name)===e&&(this.view.setHelperVisible(!1),this.view.selected=null);var o=this.data.cuboidStroage.findIndex((function(t){return t.main.name===e}));-1!==o&&(this.data.cuboidStroage.splice(o,1),r["Message"].success("标注物体已删除"))}},{key:"onSaveObject",value:function(e,t){var i=this.data.cuboidStroage.find((function(e){return e.main.name===t}));if(i){Object.assign(i.main.userData.labelInfo,l({},e));var n=this.view.views.main.scene.children[0].getObjectByName(t);n.material.color.set(e.color),n.getObjectByName("mainLine").material.color.set(e.color),Object(a["setText"])(n),r["Message"].success("标签修改成功")}}}]),e}()},"6eb8":function(e,t,i){"use strict";i.r(t),i.d(t,"Planes",(function(){return T})),i.d(t,"PointCloudView",(function(){return V}));var r=i("ed09"),n=i("5a89"),o=i("edd4"),a=i("a550"),s=i("5c96"),c=i("2ef0"),l=i("88be"),u=i("d0bd"),h=i("6b42"),v=i("7966");function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){b(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function w(e,t,i){return t&&y(e.prototype,t),i&&y(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e,t,i){return t=O(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function O(e){var t=g(e,"string");return"symbol"===d(t)?t:String(t)}function g(e,t){if("object"!==d(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var T={TOP:"topPlane",SIDE:"sidePlane",FRONT:"frontPlane",MAIN:"mainPlane"},E=7,S=window.innerWidth/window.innerHeight,V=function(){function e(t){var i=this;m(this,e),b(this,"renderRayCaster",(function(){if(i.state.toolType===h["ToolType"].ANNOTATION){var e=i.views.main.rayCaster.renderer.intersectObjects(i.views.main.scene.children,!1);if(e.length>0){i.views.main.scene.children[0].add(i.moveBox);var t=e[0];i.moveBox.position.copy(t.point)}}else if(i.views.main.scene.children[0].remove(i.moveBox),i.state.toolType===h["ToolType"].SELECT){if(!i.state.multiView)return;var r=i.views.main.scene.children[0].children,n=i.views.main.rayCaster.renderer,o=n.intersectObjects(r,!1);if(0!==o.length){if(!o[0].object.visible)return;var a=o[0].object.name;if(!a)return;i.changeSelected(a,!1)}}})),this.state=t,this.views={main:{renderer:new n["WebGLRenderer"]({antialias:!0}),scene:new n["Scene"],rayCaster:{renderer:new n["Raycaster"],mouseVector:new n["Vector2"]}},top:{renderer:new n["WebGLRenderer"]({antialias:!0}),scene:new n["Scene"],rayCaster:{renderer:new n["Raycaster"],mouseVector:new n["Vector2"]}},side:{renderer:new n["WebGLRenderer"]({antialias:!0}),scene:new n["Scene"],rayCaster:{renderer:new n["Raycaster"],mouseVector:new n["Vector2"]}},front:{renderer:new n["WebGLRenderer"]({antialias:!0}),scene:new n["Scene"],rayCaster:{renderer:new n["Raycaster"],mouseVector:new n["Vector2"]}}},this.loadSuccess=!1,this.selected=null,this.active={frameCoordinates:{x:0,y:0,z:0},scan:null,detachCam:!1,selectable:!0,detected:!1,translation:{status:!1,helper:null,coordinates:null,offset:new n["Vector3"],inverseMatrix:new n["Matrix4"]},rotation:{status:!1,helper:null,recentMouseVector:new n["Vector2"](0,0),screenInit:{x:0,y:0},screenMove:{x:0,y:0}},resize:{status:!1,helper:null,recentMouseVector:new n["Vector2"](0,0),initScales:{x:1,y:1,z:1},memScales:{x:1,y:1,z:1},resizeVector:new n["Vector3"](0,0,0)}},this.moveBox=e.createVirtualBox(),this.globalHelpers={top:{resize:[],rotate:[]},side:{resize:[],rotate:[]},front:{resize:[],rotate:[]}},this.clock=new n["Clock"],Object.keys(this.views).forEach((function(e){i.views[e].scene.background=new n["Color"](v["default"].MAIN_VIEW_BG)})),a["a"].install({THREE:n}),this.initCameraConfig(),this.initCameraContorl(),this.views.main.renderer.domElement.addEventListener("mousemove",(function(e){if(e.preventDefault(),i.state.toolType!==h["ToolType"].SHIFT){var t=i.views.main.renderer.domElement,r=t.getBoundingClientRect(),n=i.views.main.rayCaster.mouseVector;n.set((e.clientX-(t.offsetLeft+r.left))/t.clientWidth*2-1,-(e.clientY-(t.offsetTop+r.top))/t.clientHeight*2+1)}})),this.views.main.renderer.domElement.addEventListener("mousedown",(function(e){if(e.preventDefault(),i.state.toolType!==h["ToolType"].SHIFT&&!i.loadSuccess){if(i.state.toolType===h["ToolType"].ANNOTATION){var t=i.moveBox.clone(),r=t.position,n=r.x,o=r.y,a=r.z,s=t.scale,c=s.x,l=s.y,u=s.z,v=t.rotation.z,d=[0,0,0,0,0,0,0,u,l,c,n,o,a,v].join(" ");i.dispatchEvent(new CustomEvent("annodown",{bubbles:!1,cancelable:!0,detail:{boxInfo:d,clientX:e.clientX,clientY:e.clientY}}))}if(i.state.toolType===h["ToolType"].SELECT){var f=i.views.main;f.rayCaster.renderer.setFromCamera(f.rayCaster.mouseVector,f.camera);var p=f.rayCaster.renderer.intersectObjects(f.scene.children[0].children,!1);0===p.length&&(i.selected&&(i.selected.setOpacity(i.state.meshOpacity),i.selected.setOtherVisible(!1)),i.setHelperVisible(!1),i.selected=null)}}})),[h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].forEach((function(e){var t=i.views[e].renderer.domElement;t.addEventListener("mousedown",i.startAction.bind(i,e)),t.addEventListener("mousemove",i.moveAction.bind(i,e)),t.addEventListener("mouseup",i.completeActions.bind(i)),t.addEventListener("mouseleave",i.completeActions.bind(i)),t.addEventListener("wheel",(function(t){t.preventDefault();var r=i.views[e].camera;t.deltaY<v["default"].FOV_MIN&&r.zoom<v["default"].FOV_MAX?r.zoom+=v["default"].FOV_INC:t.deltaY>v["default"].FOV_MIN&&r.zoom>v["default"].FOV_MIN+.1&&(r.zoom-=v["default"].FOV_INC),i.setHelperSize(e)}),{passive:!1})}))}return w(e,[{key:"initCameraConfig",value:function(){this.views.main.camera=new n["PerspectiveCamera"](50,S,1,500),this.views.main.camera.position.set(-15,0,4),this.views.main.camera.up.set(0,0,1),this.views.main.camera.lookAt(0,0,10),this.views.main.camera.name="cameramain",this.views.top.camera=new n["OrthographicCamera"](-S*E/2-2,S*E/2+2,E/2+2,-E/2-2,-50,50),this.views.top.camera.position.set(0,0,5),this.views.top.camera.lookAt(0,0,0),this.views.top.camera.up.set(0,0,1),this.views.top.camera.name="cameraTop",this.views.side.camera=new n["OrthographicCamera"](-S*E/2,S*E/2,E/2,-E/2,-50,50),this.views.side.camera.position.set(0,5,0),this.views.side.camera.lookAt(0,0,0),this.views.side.camera.up.set(0,0,1),this.views.side.camera.name="cameraSide",this.views.front.camera=new n["OrthographicCamera"](-S*E/2,S*E/2,E/2,-E/2,-50,50),this.views.front.camera.position.set(3,0,0),this.views.front.camera.up.set(0,0,1),this.views.front.camera.lookAt(0,0,0),this.views.front.camera.name="cameraFront"}},{key:"initCameraContorl",value:function(){var e=this;Object.keys(this.views).forEach((function(t){var i=e.views[t];i.camera&&(t!==h["ViewType"].MAIN?(i.controls=new a["a"](i.camera,i.renderer.domElement),i.controls.mouseButtons.left=a["a"].ACTION.NONE,i.controls.mouseButtons.right=a["a"].ACTION.NONE,i.controls.enabled=!1):(i.controls=new a["a"](i.camera,i.renderer.domElement),i.controls.mouseButtons.left=a["a"].ACTION.NONE,i.controls.mouseButtons.right=a["a"].ACTION.NONE,i.controls.mouseButtons.wheel=a["a"].ACTION.NONE,i.controls.touches.one=a["a"].ACTION.NONE,i.controls.touches.two=a["a"].ACTION.NONE,i.controls.touches.three=a["a"].ACTION.NONE))}))}},{key:"dispatchEvent",value:function(e){this.views.main.renderer.domElement.dispatchEvent(e)}},{key:"resetView",value:function(){var e;null===(e=this.views.main.controls)||void 0===e||e.reset(!1),this.loadPointCloud(),this.changeCameraContorl(),this.resetActives(),this.selected=null}},{key:"startAction",value:function(e,t){if(1===t.detail&&this.state.toolType!==h["ToolType"].SHIFT&&!this.state.isCheck){var i=this.views[e].renderer.domElement,r=i.getBoundingClientRect(),n=this.views[e].rayCaster.mouseVector,o=t.clientX-r.left,a=t.clientY-r.top;n.x=o/i.clientWidth*2-1,n.y=-a/i.clientHeight*2+1,this.active.rotation.screenInit={x:o,y:a},this.active.rotation.screenMove={x:o,y:a},this.selected&&(this.active.scan=e,this.active.selectable=!1)}}},{key:"moveAction",value:function(e,t){if(t.preventDefault(),this.state.toolType!==h["ToolType"].SHIFT&&!this.state.isCheck){var i=this.views[e].renderer.domElement,r=i.getBoundingClientRect(),n=this.views[e].rayCaster.mouseVector,o=t.clientX-r.left,a=t.clientY-r.top;n.x=o/i.clientWidth*2-1,n.y=-a/i.clientHeight*2+1,this.active.rotation.screenMove={x:o,y:a}}}},{key:"completeActions",value:function(){var e=this.active,t=e.scan,i=e.detected;if(this.state.toolType!==h["ToolType"].SHIFT&&!this.state.isCheck)if(i){this.active.rotation.status&&this.detachCamera(t),this.adjustPerspectiveCameras();var r=this.selected[t].position,o=r.x,a=r.y,s=r.z;this.translateReferencePlane(new n["Vector3"](o,a,s)),this.resetActives()}else this.resetActives()}},{key:"resetActives",value:function(){this.active=p(p({},this.active),{},{scan:null,detected:!1,translation:{status:!1,helper:null},rotation:{status:!1,helper:null,recentMouseVector:new n["Vector2"](0,0)},resize:p(p({},this.active.resize),{},{status:!1,helper:null,recentMouseVector:new n["Vector2"](0,0)})}),this.active.selectable=!0}},{key:"adjustPerspectiveCameras",value:function(){var e=this.selected.getReferenceCoordinates(h["ViewType"].TOP),t=new n["Spherical"];t.setFromVector3(e),this.views.top.camera.position.setFromSpherical(t),this.views.top.camera.updateProjectionMatrix();var i=this.selected.getReferenceCoordinates(h["ViewType"].SIDE),r=new n["Spherical"];r.setFromVector3(i),this.views.side.camera.position.setFromSpherical(r),this.views.side.camera.updateProjectionMatrix();var o=this.selected.getReferenceCoordinates(h["ViewType"].FRONT),a=new n["Spherical"];a.setFromVector3(o),this.views.front.camera.position.setFromSpherical(a),this.views.front.camera.updateProjectionMatrix()}},{key:"loadPointCloud",value:function(){var e,t=this;if(this.clearScene(),this.loadSuccess=!1,null!==(e=this.state.currentFile)&&void 0!==e&&e.url){var i="".concat(l["b"].minioBaseUrl,"/").concat(this.state.currentFile.url),r=new o["a"];r.load(i,this.addScene.bind(this),(function(){}),(function(e){t.loadSuccess=!0,s["Notification"].error({title:"解析错误",message:e.message})}))}}},{key:"addScene",value:function(t){var i=this;t.material.size=.05,t.material.color.set("#fff");var r=t.material.clone(),o=t.geometry.boundingSphere.center,a=t.geometry.boundingSphere||{radius:0},s=a.radius;if(this.views.main.camera){var c=-s/2<this.views.main.camera.position.x-o.x&&s/2>this.views.main.camera.position.x-o.x,l=-s/2<this.views.main.camera.position.y-o.y&&s/2>this.views.main.camera.position.y-o.y,u=-s/2<this.views.main.camera.position.z-o.z&&s/2>this.views.main.camera.position.z-o.z,v=0,d=0,f=0;c||(v=o.x),l||(d=o.y),u||(f=o.z),(v||d||f)&&(this.active.frameCoordinates={x:v,y:d,z:f},this.positionAllViews(v,d,f,!1)),[h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].forEach((function(e){i.globalHelpers[e].resize=[],i.globalHelpers[e].rotation=[]})),this.views.main.scene.add(t.clone());var p=new n["Shape"],m=this.state.distanceRange,y=m.front,w=m.behind,b=m.left,O=m.right;p.moveTo(y,b,0),p.lineTo(y,O,0),p.lineTo(w,O,0),p.lineTo(w,b,0),p.autoClose=!0;var g=p.getPoints(),E=(new n["BufferGeometry"]).setFromPoints(g),S=new n["Line"](E,new n["LineBasicMaterial"]({color:13421772,linewidth:30}));this.views.main.scene.add(S);var V=new n["AxesHelper"];this.views.main.scene.add(V);var x=this.views.top.renderer.domElement,P=new n["Mesh"](new n["PlaneBufferGeometry"](x.offsetHeight,x.offsetWidth,x.offsetHeight,x.offsetWidth),new n["MeshBasicMaterial"]({color:16777215,alphaTest:0,visible:!1,transparent:!0,opacity:0}));P.position.set(0,0,0),P.name=T.TOP,P.material.side=n["DoubleSide"],P.verticesNeedUpdate=!0,t.material=r,r.size=.5,this.views.top.scene.add(t.clone()),this.views.top.scene.add(P);var j=e.setupRotationHelper();this.globalHelpers.top.rotation.push(j),this.views.top.scene.add(j),this.setupResizeHelper(h["ViewType"].TOP);var N=this.views.side.renderer.domElement,C=new n["Mesh"](new n["PlaneBufferGeometry"](N.offsetHeight,N.offsetWidth,N.offsetHeight,N.offsetWidth),new n["MeshBasicMaterial"]({color:16777215,alphaTest:0,visible:!1,transparent:!0,opacity:0}));C.position.set(0,0,0),C.rotation.set(-Math.PI/2,Math.PI/2e3,Math.PI),C.name=T.SIDE,C.material.side=n["DoubleSide"],C.verticesNeedUpdate=!0,this.views.side.scene.add(t.clone()),this.views.side.scene.add(C),this.setupResizeHelper(h["ViewType"].SIDE);var R=this.views.front.renderer.domElement,k=new n["Mesh"](new n["PlaneBufferGeometry"](R.offsetHeight,R.offsetWidth,R.offsetHeight,R.offsetWidth),new n["MeshBasicMaterial"]({color:16777215,alphaTest:0,visible:!1,transparent:!0,opacity:0}));k.position.set(0,0,0),k.rotation.set(0,Math.PI/2,0),k.name=T.FRONT,k.material.side=n["DoubleSide"],k.verticesNeedUpdate=!0,this.views.front.scene.add(t.clone()),this.views.front.scene.add(k),this.setupResizeHelper(h["ViewType"].FRONT),this.setHelperVisible(!1),Array.isArray(this.state.oldAnnotatedInfo)&&this.state.oldAnnotatedInfo.length&&this.createBoundingBoxs()}}},{key:"createBoundingBoxs",value:function(){var e,t=this;this.views.main.scene.children[0]&&(this.clearSceneObjects(),this.setHelperVisible(!1),null===(e=this.state.oldAnnotatedInfo)||void 0===e||e.forEach((function(e){t.createBoundingBox(e,!1)})))}},{key:"createBoundingBox",value:function(e,t){var i=this;this.selected&&this.selected.setOtherVisible(!1);var o=e.split(" ").map((function(e,t){return 0===t?e:parseFloat(e)})),a=new u["BoundingBox"],s=a.main.uuid;a.setName(s);var c=this.state.labelGroup.find((function(e){return o[0]===e.name})),l=c||{name:o[0],color:"#58d1c9"};a.setOriginalColor(l.color),a.setColor(l.color),a.setOpacity(this.state.meshOpacity),a.setMainLine(l.color),Object.assign(a.main.userData,{labelInfo:p({},l)}),Object(u["createRotationHelper"])(a.top,h["ViewType"].TOP),Object(u["setTranslationHelper"])(a.top),Object(u["setTranslationHelper"])(a.side),Object(u["setTranslationHelper"])(a.front),Object(u["setEdges"])(a.top),Object(u["setEdges"])(a.side),Object(u["setEdges"])(a.front),this.translateReferencePlane(new n["Vector3"](o[11],o[12],o[13])),a.setPosition(o[11],o[12],o[13]),a.setScale(o[10],o[9],o[8]),a.setRotation(o[14]),Object(u["setText"])(a.main),t?(this.selected=a,a.attachCameraReference(),Object(r["g"])((function(){return i.rotatePlane(0,null)})),this.active.detachCam=!0,this.setSelectedChildScale(1/a.top.scale.x,1/a.top.scale.y,1/a.top.scale.z),this.setHelperVisible(!0),this.updateRotationHelperPos(),this.updateResizeHelperPos()):(a.setOtherVisible(!1),this.setHelperVisible(!1)),this.addSceneChildren(a),this.state.cuboidStroage.push(a)}},{key:"addSceneChildren",value:function(e){this.views.main.scene.children[0].add(e.main),this.views.top.scene.children[0].add(e.top),this.views.side.scene.children[0].add(e.side),this.views.front.scene.children[0].add(e.front)}},{key:"clearScene",value:function(){var e=this;Object.keys(this.views).forEach((function(t){e.views[t].scene.children=[]}))}},{key:"clearSceneObjects",value:function(){var e=this;Object.keys(this.views).forEach((function(t){e.views[t].scene.children[0].children=[]}))}},{key:"changeCameraContorl",value:function(){var e=this.views.main.controls,t=this.state.toolType===h["ToolType"].SHIFT;e.mouseButtons.left=t?a["a"].ACTION.ROTATE:a["a"].ACTION.NONE,e.mouseButtons.right=t?a["a"].ACTION.TRUCK:a["a"].ACTION.NONE,e.mouseButtons.wheel=t?a["a"].ACTION.DOLLY:a["a"].ACTION.NONE}},{key:"positionAllViews",value:function(e,t,i,r){this.views.main.controls&&this.views.top.controls&&this.views.side.controls&&this.views.front.controls&&(this.views.main.controls.setLookAt(e-8,t-8,i+3,e,t,i,r),this.views.top.camera.position.set(e,t,i+8),this.views.top.camera.lookAt(e,t,i),this.views.top.camera.zoom=1,this.views.side.camera.position.set(e,t+8,i),this.views.side.camera.lookAt(e,t,i),this.views.side.camera.zoom=1,this.views.front.camera.position.set(e+8,t,i),this.views.front.camera.lookAt(e,t,i),this.views.front.camera.zoom=1)}},{key:"setDefaultZoom",value:function(){var e=this.views.top.renderer.domElement,t=(new n["Box3"]).setFromObject(this.selected.top),i=.4*Math.min(e.offsetWidth/(t.max.x-t.min.x),e.offsetHeight/(t.max.y-t.min.y));this.views.top.camera.zoom=i/100,this.views.top.camera.updateProjectionMatrix(),this.views.top.camera.updateMatrix(),this.setHelperSize(h["ViewType"].TOP);var r=this.views.front.renderer.domElement,o=(new n["Box3"]).setFromObject(this.selected.front),a=.4*Math.min(r.offsetWidth/(o.max.y-o.min.y),r.offsetHeight/(o.max.z-o.min.z));this.views.front.camera.zoom=a/100,this.views.front.camera.updateProjectionMatrix(),this.views.front.camera.updateMatrix(),this.setHelperSize(h["ViewType"].FRONT);var s=this.views.side.renderer.domElement,c=(new n["Box3"]).setFromObject(this.selected.side),l=.4*Math.min(s.offsetWidth/(c.max.x-c.min.x),s.offsetHeight/(c.max.z-c.min.z));this.views.side.camera.zoom=l/100,this.views.side.camera.updateProjectionMatrix(),this.views.side.camera.updateMatrix(),this.setHelperSize(h["ViewType"].SIDE)}},{key:"detachCamera",value:function(e){var t=this.selected.getReferenceCoordinates(h["ViewType"].TOP),i=new n["Spherical"];i.setFromVector3(t);var r=this.selected.getReferenceCoordinates(h["ViewType"].SIDE),o=new n["Spherical"];o.setFromVector3(r);var a=this.selected.getReferenceCoordinates(h["ViewType"].FRONT),s=new n["Spherical"];s.setFromVector3(a);var c=this.selected,l=c.side,u=c.front,v=c.top,d=this.views.side.camera,f=this.views.front.camera,p=this.views.top.camera;switch(e){case h["ViewType"].TOP:var m=l.getObjectByName("cameraSide").getWorldQuaternion(new n["Quaternion"]);l.remove(d),d.position.setFromSpherical(o),d.lookAt(l.position.x,l.position.y,l.position.z),d.setRotationFromQuaternion(m),d.scale.set(1,1,1);var y=u.getObjectByName("cameraFront").getWorldQuaternion(new n["Quaternion"]);u.remove(f),f.position.setFromSpherical(s),f.lookAt(u.position.x,u.position.y,u.position.z),f.setRotationFromQuaternion(y),f.scale.set(1,1,1);break;case h["ViewType"].SIDE:var w=u.getObjectByName("cameraFront").getWorldQuaternion(new n["Quaternion"]);u.remove(f),f.position.setFromSpherical(s),f.lookAt(u.position.x,u.position.y,u.position.z),f.setRotationFromQuaternion(w),f.scale.set(1,1,1),v.remove(p),p.position.setFromSpherical(i),p.lookAt(v.position.x,v.position.y,v.position.z),p.setRotationFromEuler(v.rotation),p.scale.set(1,1,1);break;case h["ViewType"].FRONT:var b=l.getObjectByName("cameraSide").getWorldQuaternion(new n["Quaternion"]);l.remove(d),d.position.setFromSpherical(o),d.lookAt(l.position.x,l.position.y,l.position.z),d.setRotationFromQuaternion(b),d.scale.set(1,1,1),v.remove(p),p.position.setFromSpherical(i),p.lookAt(v.position.x,v.position.y,v.position.z),p.setRotationFromEuler(v.rotation),p.scale.set(1,1,1);break;default:d.position.setFromSpherical(o),d.lookAt(l.position.x,l.position.y,l.position.z),d.rotation.z=this.views.side.scene.getObjectByName(T.SIDE).rotation.z,d.scale.set(1,1,1),p.position.setFromSpherical(i),p.lookAt(v.position.x,v.position.y,v.position.z),p.setRotationFromEuler(v.rotation),p.scale.set(1,1,1);var O=u.getObjectByName("camRefRot").getWorldQuaternion(new n["Quaternion"]);f.position.setFromSpherical(s),f.lookAt(u.position.x,u.position.y,u.position.z),f.setRotationFromQuaternion(O),f.scale.set(1,1,1)}}},{key:"attachCamera",value:function(e){switch(e){case h["ViewType"].TOP:this.selected.side.attach(this.views.side.camera),this.selected.front.attach(this.views.front.camera);break;case h["ViewType"].SIDE:this.selected.front.attach(this.views.front.camera),this.selected.top.attach(this.views.top.camera);break;case h["ViewType"].FRONT:this.selected.side.attach(this.views.side.camera),this.selected.top.attach(this.views.top.camera);break;default:}}},{key:"setupResizeHelper",value:function(e){for(var t=new n["SphereGeometry"](.15),i=new n["MeshBasicMaterial"]({color:"#ffffff",opacity:1,visible:!0}),r=[],o=0;o<8;o+=1)r[o]=new n["Mesh"](t.clone(),i.clone()),r[o].name="globalResizeHelper".concat(o),this.globalHelpers[e].resize.push(r[o]),this.views[e].scene.add(r[o])}},{key:"setHelperSize",value:function(e){if([h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].includes(e)){var t=this.views[e].camera;if(!t||t instanceof n["PerspectiveCamera"])return;var i=(t.top-t.bottom)/t.zoom,r=this.views[e].scene.getObjectByName("globalRotationHelper");r&&r.scale.set(1,1,1).multiplyScalar(i/10);for(var o=0;o<8;o+=1){var a=this.views[e].scene.getObjectByName("globalResizeHelper".concat(o));a&&a.scale.set(1,1,1).multiplyScalar(i/10)}}}},{key:"updateRotationHelperPos",value:function(){var e=new n["Vector3"](0,0,0);this.selected.top.getObjectByName("rotationHelper").getWorldPosition(e);var t=this.views.top.scene.getObjectByName("globalRotationHelper");t&&t.position.set(e.x,e.y,e.z)}},{key:"updateResizeHelperPos",value:function(){var e=this;[h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].forEach((function(t){var i=0;e.selected[t].children.forEach((function(r){if("resizeHelper"===r.name){var o=new n["Vector3"](0,0,0);r.getWorldPosition(o);var a="globalResizeHelper".concat(i),s=e.views[t].scene.getObjectByName(a);s&&s.position.set(o.x,o.y,o.z),i+=1}}))}))}},{key:"setHelperVisible",value:function(e){var t=this;[h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].forEach((function(i){var r=t.views[i].scene.getObjectByName("globalRotationHelper");r&&(r.visible=e);for(var n=0;n<8;n+=1){var o=t.views[i].scene.getObjectByName("globalResizeHelper".concat(n));o&&(o.visible=e)}}))}},{key:"setSelectedChildScale",value:function(e,t,i){var r=this;[h["ViewType"].TOP,h["ViewType"].SIDE,h["ViewType"].FRONT].forEach((function(n){r.selected[n].children.forEach((function(r){r.name!==v["default"].CUBOID_EDGE_NAME&&r.scale.set(null==e?r.scale.x:e,null==t?r.scale.y:t,null==i?r.scale.z:i)}))}))}},{key:"changeSelected",value:function(e,t){var i=this.state.cuboidStroage.find((function(t){return e===t.main.name})),r=null===i||void 0===i?void 0:i.main.position,n=r.x,o=r.y;if(!(Object(c["isNil"])(n)&&Object(c["isNil"])(o)||null===i||void 0===i)&&i.main.visible&&i){var a;if((null===(a=this.selected)||void 0===a?void 0:a.main.name)===i.main.name)return;this.selected&&(this.selected.setOpacity(this.state.meshOpacity),this.selected.setOtherVisible(!1)),this.selected=i;var s=this.state.meshOpacity;if(this.selected.setOpacity(s>50?s-30:s+30),this.selected.setOtherVisible(!0),this.selected.attachCameraReference(),this.setSelectedChildScale(1/this.selected.top.scale.x,1/this.selected.top.scale.y,1/this.selected.top.scale.z),this.rotatePlane(0,null),this.setHelperVisible(!0),this.updateRotationHelperPos(),this.updateResizeHelperPos(),this.active.detachCam=!0,t){var l=this.views.main.controls,u=this.selected.main.position,h=u.x,v=u.y,d=u.z;l.moveTo(h,v,d,!0)}}}},{key:"initiateAction",value:function(e,t){var i=t.rayCaster.renderer.intersectObjects(this.globalHelpers[e].resize,!1);if(0!==i.length){this.active.resize.helper=t.rayCaster.mouseVector.clone(),this.active.resize.status=!0,this.active.detected=!0;var r=this.selected[e].scale,o=r.x,a=r.y,s=r.z;return this.active.resize.initScales={x:o,y:a,z:s},this.active.resize.memScales={x:o,y:a,z:s},this.active.resize.frontBool=!1,void(this.active.resize.resizeVector=new n["Vector3"](0,0,0))}var c=t.rayCaster.renderer.intersectObjects(this.globalHelpers[e].rotation,!1);if(0!==c.length)return this.active.rotation.helper=t.rayCaster.mouseVector.clone(),this.active.rotation.status=!0,this.active.detected=!0,void this.attachCamera(e);var l,u,h=t.rayCaster.renderer.intersectObject(this.selected[e],!1),v=t.rayCaster.renderer.intersectObjects([t.scene.getObjectByName("".concat(e,"Plane"))]);0!==h.length&&(this.active.translation.helper=t.rayCaster.mouseVector.clone(),this.active.translation.inverseMatrix=h[0].object.parent.matrixWorld.invert(),this.active.translation.offset=null===(l=v[0])||void 0===l||null===(u=l.point)||void 0===u?void 0:u.sub((new n["Vector3"]).setFromMatrixPosition(h[0].object.matrixWorld)),this.active.translation.status=!0,this.active.detected=!0)}},{key:"renderTranslateAction",value:function(e,t){if(this.active.translation.helper.x!==this.views[e].rayCaster.mouseVector.x||this.active.translation.helper.y!==this.views[e].rayCaster.mouseVector.y){var i=t.rayCaster.renderer.intersectObjects([t.scene.getObjectByName("".concat(e,"Plane"))]);if(0!==i.length&&i[0].point){var r=i[0].point;this.active.translation.coordinates=r,this.moveObject(r)}}}},{key:"renderResizeAction",value:function(e,t){var i=t.rayCaster.renderer.intersectObjects([t.scene.getObjectByName("".concat(e,"Plane"))]);if(0!==i.length){var r=this.active.resize.initScales,n=r.x,o=r.y,a=r.z,s=this.active.resize.memScales,c=s.x,l=s.y,u=s.z,v=this.active.resize.helper,d=v.x,f=v.y,m=t.rayCaster.mouseVector,y=m.x,w=m.y,b=this.active.resize.resizeVector;if((this.active.resize.helper.x!==y||this.active.resize.helper.y!==w)&&(this.active.resize.recentMouseVector.x!==y||this.active.resize.recentMouseVector.y!==w)){switch(this.active.resize.recentMouseVector=t.rayCaster.mouseVector.clone(),e){case h["ViewType"].TOP:var O=n*(y/d),g=o*(w/f);g<0&&(g=.2),O<0&&(O=.2),this.selected.setScale(O,g,this.selected.top.scale.z),this.setSelectedChildScale(1/O,1/g,null);var T=O/2-c/2,E=g/2-l/2;y>0&&w<0?(b.x+=T,b.y-=E):y>0&&w>0?(b.x+=T,b.y+=E):y<0&&w<0?(b.x-=T,b.y-=E):y<0&&w>0&&(b.x-=T,b.y+=E),this.active.resize.memScales.x=O,this.active.resize.memScales.y=g;break;case h["ViewType"].SIDE:var S=n*(y/d),V=a*(w/f);S<0&&(S=.2),V<0&&(V=.2),this.selected.setScale(S,this.selected.top.scale.y,V),this.setSelectedChildScale(1/S,null,1/V);var x=S/2-c/2,P=V/2-u/2;y>0&&w<0?(b.x+=x,b.y-=P):y>0&&w>0?(b.x+=x,b.y+=P):y<0&&w<0?(b.x-=x,b.y-=P):y<0&&w>0&&(b.x-=x,b.y+=P),this.active.resize.memScales=p(p({},this.active.resize.memScales),{},{x:S,z:V});break;case h["ViewType"].FRONT:var j,N,C=o*(y/d),R=a*(w/f);C<0&&(C=.2),R<0&&(R=.2),this.selected.setScale(this.selected.top.scale.x,C,R),this.setSelectedChildScale(null,1/C,1/R),this.active.resize.frontBool?(j=R/2-l/2,N=C/2-u/2):(j=R/2-u/2,N=C/2-l/2,this.active.resize.frontBool=!0),y>0&&w<0?(b.x+=j,b.y+=N):y>0&&w>0?(b.x-=j,b.y+=N):y<0&&w<0?(b.x+=j,b.y-=N):y<0&&w>0&&(b.x-=j,b.y-=N),this.active.resize.memScales.y=R,this.active.resize.memScales.z=C;break;default:}var k=b.clone();i[0].object.localToWorld(k),this.moveObject(k),this.adjustPerspectiveCameras()}}}},{key:"renderRotateAction",value:function(t,i){var r=Math.PI/v["default"].ROTATION_SPEED,n=i.renderer,o=n.domElement;if(o){var a={x:o.offsetLeft+o.offsetWidth/2,y:o.offsetTop+o.offsetHeight/2};this.active.rotation.screenInit.x===this.active.rotation.screenMove.x&&this.active.rotation.screenInit.y===this.active.rotation.screenMove.y||this.active.rotation.recentMouseVector.x===this.views[t].rayCaster.mouseVector.x&&this.active.rotation.recentMouseVector.y===this.views[t].rayCaster.mouseVector.y||(this.active.rotation.recentMouseVector=this.views[t].rayCaster.mouseVector.clone(),e.isLeft(a,this.active.rotation.screenInit,this.active.rotation.screenMove)?(this.rotateCube(this.selected,-r,t),this.rotatePlane(-r,t)):(this.rotateCube(this.selected,r,t),this.rotatePlane(r,t)),this.active.rotation.screenInit.x=this.active.rotation.screenMove.x,this.active.rotation.screenInit.y=this.active.rotation.screenMove.y)}}},{key:"rotateCube",value:function(e,t,i){switch(i){case h["ViewType"].TOP:e.main.rotateZ(t),e.top.rotateZ(t),e.side.rotateZ(t),e.front.rotateZ(t),this.rotateCamera(t,i);break;case h["ViewType"].FRONT:e.main.rotateX(t),e.top.rotateX(t),e.side.rotateX(t),e.front.rotateX(t),this.rotateCamera(t,i);break;case h["ViewType"].SIDE:e.main.rotateY(t),e.top.rotateY(t),e.side.rotateY(t),e.front.rotateY(t),this.rotateCamera(t,i);break;default:}}},{key:"rotateCamera",value:function(e,t){switch(t){case h["ViewType"].TOP:this.views.top.camera.rotateZ(e);break;case h["ViewType"].FRONT:this.views.front.camera.rotateZ(e);break;case h["ViewType"].SIDE:this.views.side.camera.rotateZ(e);break;default:}}},{key:"rotatePlane",value:function(e,t){var i=this.views.top.scene.getObjectByName(T.TOP),r=this.views.side.scene.getObjectByName(T.SIDE),o=this.views.front.scene.getObjectByName(T.FRONT);switch(t){case h["ViewType"].TOP:i.rotateZ(e),r.rotateY(e),o.rotateX(-e);break;case h["ViewType"].SIDE:i.rotateY(e),r.rotateZ(e),o.rotateY(e);break;case h["ViewType"].FRONT:i.rotateX(e),r.rotateX(-e),o.rotateZ(e);break;default:var a=this.selected,s=a.top,c=a.side,l=a.front;s.add(i),c.add(r),l.add(o),s.getObjectByName(T.TOP).rotation.set(0,0,0),c.getObjectByName(T.SIDE).rotation.set(-Math.PI/2,Math.PI/2e3,Math.PI),l.getObjectByName(T.FRONT).rotation.set(0,Math.PI/2,0);var u=new n["Quaternion"];c.getObjectByName(T.SIDE).getWorldQuaternion(u);var v=new n["Euler"];v.setFromQuaternion(u);var d=new n["Quaternion"];l.getObjectByName(T.FRONT).getWorldQuaternion(d);var f=new n["Euler"];f.setFromQuaternion(d);var p=new n["Quaternion"];s.getObjectByName(T.TOP).getWorldQuaternion(p);var m=new n["Euler"];m.setFromQuaternion(p),s.remove(i),c.remove(r),l.remove(o);var y=this.views.top.renderer.domElement,w=new n["Mesh"](new n["PlaneBufferGeometry"](y.offsetHeight,y.offsetWidth),new n["MeshBasicMaterial"]({color:16711680,alphaTest:0,visible:!1,transparent:!0,opacity:.1}));w.name=T.TOP,w.material.side=n["DoubleSide"];var b=this.views.side.renderer.domElement,O=new n["Mesh"](new n["PlaneBufferGeometry"](b.offsetHeight,b.offsetWidth),new n["MeshBasicMaterial"]({color:65280,alphaTest:0,visible:!1,transparent:!0,opacity:.1}));O.name=T.SIDE,O.material.side=n["DoubleSide"];var g=this.views.front.renderer.domElement,E=new n["Mesh"](new n["PlaneBufferGeometry"](g.offsetHeight,g.offsetWidth),new n["MeshBasicMaterial"]({color:255,alphaTest:0,visible:!1,transparent:!0,opacity:.5}));E.name=T.FRONT,E.material.side=n["DoubleSide"];var S={x:s.position.x,y:s.position.y,z:s.position.z};w.rotation.set(m.x,m.y,m.z),O.rotation.set(v.x,v.y,v.z),E.rotation.set(f.x,f.y,f.z),this.views.top.scene.add(w),this.views.side.scene.add(O),this.views.front.scene.add(E),this.translateReferencePlane(S)}}},{key:"translateReferencePlane",value:function(e){var t=this.views.top.scene.getObjectByName(T.TOP);t&&(t.position.x=e.x,t.position.y=e.y,t.position.z=e.z);var i=this.views.side.scene.getObjectByName(T.SIDE);i&&(i.position.x=e.x,i.position.y=e.y,i.position.z=e.z);var r=this.views.front.scene.getObjectByName(T.FRONT);r&&(r.position.x=e.x,r.position.y=e.y,r.position.z=e.z)}},{key:"moveObject",value:function(e){var t=this.selected,i=t.main,r=t.top,n=t.side,o=t.front,a=e;this.active.translation.status&&(a=e.clone().sub(this.active.translation.offset).applyMatrix4(this.active.translation.inverseMatrix)),i.position.copy(a.clone()),r.position.copy(a.clone()),n.position.copy(a.clone()),o.position.copy(a.clone())}},{key:"animationRender",value:function(){var t=this;if(Object.keys(this.views).forEach((function(i){var r,n=t.views[i];n.controls&&n.camera&&n.rayCaster&&(n.rayCaster.renderer.setFromCamera(n.rayCaster.mouseVector,n.camera),e.resizeRendererSize(n),null!==(r=n.controls)&&void 0!==r&&r.enabled?n.controls.update(t.clock.getDelta()):n.camera.updateProjectionMatrix(),n.renderer.render(n.scene,n.camera),i===h["ViewType"].MAIN&&0!==n.scene.children.length&&t.renderRayCaster(),i!==h["ViewType"].MAIN&&t.active.scan===i&&(t.active.translation.status||t.active.resize.status||t.active.rotation.status||t.initiateAction(i,n),t.active.detected?(t.active.translation.status?t.renderTranslateAction(i,n):t.active.resize.status?t.renderResizeAction(i,n):t.renderRotateAction(i,n),t.updateResizeHelperPos(),t.updateRotationHelperPos()):t.resetActives()))})),this.active.detachCam)try{this.detachCamera(null)}finally{this.active.detachCam=!1}}},{key:"canvasDom",value:function(){return{main:this.views.main.renderer.domElement,top:this.views.top.renderer.domElement,side:this.views.side.renderer.domElement,front:this.views.front.renderer.domElement}}}],[{key:"setupRotationHelper",value:function(){var e=new n["SphereGeometry"](.15),t=new n["MeshBasicMaterial"]({color:"#ffffff",opacity:1,visible:!0}),i=new n["Mesh"](e,t);return i.name="globalRotationHelper",i}},{key:"resizeRendererSize",value:function(e){var t=e.camera,i=e.renderer,r=i.domElement;if(r.parentElement){var o=r.parentElement.clientWidth,a=r.parentElement.clientHeight,s=r.clientWidth!==o||r.clientHeight!==a;if(s&&t&&e.camera){if(t instanceof n["PerspectiveCamera"])t.aspect=o/a;else{var c=0,l=7,u=o/a;t instanceof n["PerspectiveCamera"]||(t.left=-u*l/2-c,t.right=u*l/2+c,t.top=l/2+c,t.bottom=-l/2-c),t.near=-50,t.far=50}e.renderer.setSize(o,a),e.camera.updateProjectionMatrix()}}}},{key:"createVirtualBox",value:function(){var e=new n["BoxGeometry"](1,1,1),t=new n["MeshBasicMaterial"]({color:v["default"].PRIMARY,wireframe:!1,transparent:!0,opacity:.4}),i=new n["Mesh"](e,t);i.name="virtual";var r=new n["LineSegments"](new n["EdgesGeometry"](i.geometry),new n["LineBasicMaterial"]({color:v["default"].PRIMARY,linewidth:3}));return r.computeLineDistances(),r.renderOrder=1,i.add(r),i}},{key:"isLeft",value:function(e,t,i){return(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x)>0}}]),e}()},7966:function(e,t,i){"use strict";i.r(t),t["default"]={CAMERA_REFERENCE:"camRef",CUBOID_EDGE_NAME:"edges",ROTATION_HELPER:"rotationHelper",ROTATION_HELPER_OFFSET:.1,ROTATION_SPEED:80,FOV_MAX:2,FOV_MIN:0,FOV_INC:.08,MAIN_VIEW_BG:0,PRIMARY:5820873}},d0bd:function(e,t,i){"use strict";i.r(t),i.d(t,"BoundingBox",(function(){return T})),i.d(t,"setEdges",(function(){return E})),i.d(t,"setTranslationHelper",(function(){return S})),i.d(t,"createRotationHelper",(function(){return V})),i.d(t,"getTextCanvas",(function(){return P})),i.d(t,"setText",(function(){return j}));var r=i("5a89"),n=i("9037"),o=i("6b42"),a=i("7966");function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){return d(e)||v(e,t)||u(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"===typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function v(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;c=!1}else for(;!(c=(r=o.call(i)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,n=u}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw n}}return s}}function d(e){if(Array.isArray(e))return e}function f(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?f(Object(i),!0).forEach((function(t){m(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function m(e,t,i){return t=O(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function b(e,t,i){return t&&w(e.prototype,t),i&&w(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function O(e){var t=g(e,"string");return"symbol"===s(t)?t:String(t)}function g(e,t){if("object"!==s(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var T=function(){function e(){y(this,e);var t=new r["BoxGeometry"](1,1,1),i=new r["MeshBasicMaterial"]({color:5820873,wireframe:!1,transparent:!0});this.main=new r["Mesh"](t,i),this.top=new r["Mesh"](t,i),this.side=new r["Mesh"](t,i),this.front=new r["Mesh"](t,i);var n=new r["Object3D"];n.translateX(-2),n.name="camRefRot",n.up=new r["Vector3"](0,0,1),n.lookAt(new r["Vector3"](0,0,0)),this.front.add(n.clone())}return b(e,[{key:"setMainLine",value:function(e){var t=new r["LineSegments"](new r["EdgesGeometry"](this.main.geometry),new r["LineBasicMaterial"]({color:e,linewidth:4}));t.computeLineDistances(),t.renderOrder=1,t.name="mainLine",this.main.add(t)}},{key:"setPosition",value:function(e,t,i){var r=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(n){r[n].position.set(e,t,i)}))}},{key:"setScale",value:function(e,t,i){var r=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(n){r[n].scale.set(e,t,i)}))}},{key:"setRotation",value:function(e){var t=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(i){t[i].rotation.set(0,0,e)}))}},{key:"attachCameraReference",value:function(){var e=new r["Object3D"];e.translateZ(2),e.name=a["default"].CAMERA_REFERENCE,this.top.add(e),this.top.userData=p(p({},this.top.userData),{},{camReference:e});var t=new r["Object3D"];t.translateY(2),t.name=a["default"].CAMERA_REFERENCE,this.side.add(t),this.side.userData=p(p({},this.side.userData),{},{camReference:t});var i=new r["Object3D"];i.translateX(2),i.name=a["default"].CAMERA_REFERENCE,this.front.add(i),this.front.userData=p(p({},this.front.userData),{},{camReference:i})}},{key:"setName",value:function(e){var t=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(i){t[i].name=e}))}},{key:"setOriginalColor",value:function(e){var t=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(i){t[i].originalColor=e}))}},{key:"setColor",value:function(e){var t=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(i){t[i].material.color.set(e)}))}},{key:"setOpacity",value:function(e){var t=this;[o["ViewType"].MAIN,o["ViewType"].TOP,o["ViewType"].SIDE,o["ViewType"].FRONT].forEach((function(i){t[i].material.opacity=e/100}))}},{key:"setOtherVisible",value:function(e){var t=new Array(3).fill(e),i=c(t,3);this.top.visible=i[0],this.front.visible=i[1],this.side.visible=i[2]}},{key:"getReferenceCoordinates",value:function(e){var t=this[e].getObjectByName(a["default"].CAMERA_REFERENCE).matrixWorld.elements;return new r["Vector3"](t[12],t[13],t[14])}}]),e}();function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16777215,i=new r["EdgesGeometry"](e.geometry),n=new r["LineSegments"](i,new r["LineBasicMaterial"]({color:t,linewidth:3}));return n.name=a["default"].CUBOID_EDGE_NAME,e.add(n),n}function S(e){var t=new r["SphereGeometry"](.1),i=new r["MeshBasicMaterial"]({color:"#ffffff",opacity:1});e.geometry.deleteAttribute("normal"),e.geometry.deleteAttribute("uv"),e.geometry=Object(n["a"])(e.geometry);for(var o=[],a=e.geometry.getAttribute("position"),s=0;s<a.count;s+=1){var c=new r["Vector3"];c.fromBufferAttribute(a,s),o.push(c)}for(var l=[],u=0;u<o.length;u+=1)l[u]=new r["Mesh"](t.clone(),i.clone()),l[u].position.set(o[u].x,o[u].y,o[u].z),l[u].up.set(0,0,1),l[u].name="resizeHelper",e.add(l[u]),l[u].scale.set(1/e.scale.x,1/e.scale.y,1/e.scale.z);e.userData=p(p({},e.userData),{},{resizeHelpers:l})}function V(e,t){var i=new r["SphereGeometry"](.1),n=new r["MeshBasicMaterial"]({color:"#ffffff",opacity:1}),s=new r["Mesh"](i,n);switch(s.name=a["default"].ROTATION_HELPER,t){case o["ViewType"].TOP:s.position.set(e.geometry.parameters.height/2+a["default"].ROTATION_HELPER_OFFSET,e.position.y,e.position.z),e.add(s.clone()),e.userData=p(p({},e.userData),{},{rotationHelpers:s.clone()});break;case o["ViewType"].SIDE:case o["ViewType"].FRONT:s.position.set(e.position.x,e.position.y,e.geometry.parameters.depth/2+a["default"].ROTATION_HELPER_OFFSET),e.add(s.clone()),e.userData=p(p({},e.userData),{},{rotationHelpers:s.clone()});break;default:break}}var x=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},P=function(e,t){var i=document.createElement("canvas"),r=i.getContext("2d"),n=x(r);return i.width=80*n,i.height=30*n,r.scale(n,n),r.fillStyle=t,r.fillRect(1,1,78,28),r.fillStyle="white",r.font="normal 14px verdana",r.fillText(e,5,20),i};function j(e){var t=e.getObjectByName("mainLabel");t&&e.remove(t);var i=e.userData.labelInfo,n=new r["Texture"](P(i.name,i.color));n.needsUpdate=!0;var o=new r["SpriteMaterial"]({map:n}),a=new r["Sprite"](o);a.scale.set(.3,.15,.3);var s=e.geometry.attributes.position;a.position.set(s.getX(7),s.getY(7),s.getZ(7)+a.scale.y/2),e.add(a)}}}]);