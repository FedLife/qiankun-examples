(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["cloudServing-components-forms-servingModelConfig"],{"0be6":function(e,t,r){"use strict";r.d(t,"f",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"e",(function(){return u}));var o=r("b775"),n=r("f121");function a(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelBranch"),method:"get",params:e})}function i(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelBranch"),method:"post",data:e})}function s(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelBranch"),method:"put",data:e})}function l(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelBranch"),method:"delete",data:e})}function c(e){return Object(o["a"])({url:"".concat(n["a"].MODEL,"/ptModelBranch/convertPreset"),method:"post",data:e})}function u(e){return Object(o["a"])({url:"".concat(n["a"].MODEL,"/ptModelBranch/convertOnnx"),method:"post",data:{id:e}})}t["c"]={list:a,add:i,edit:s,del:l}},"0c61":function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return l}));var o=r("b775"),n=r("f121");function a(e){return Object(o["a"])({url:"/".concat(n["a"].ADMIN,"/resourceSpecs"),method:"get",params:e})}function i(e){return Object(o["a"])({url:"/".concat(n["a"].ADMIN,"/resourceSpecs"),method:"post",data:e})}function s(e){return Object(o["a"])({url:"/".concat(n["a"].ADMIN,"/resourceSpecs"),method:"delete",data:{ids:e}})}function l(e){return Object(o["a"])({url:"/".concat(n["a"].ADMIN,"/resourceSpecs"),method:"put",data:e})}},"11f4":function(e,t,r){},"8bbd":function(e,t,r){"use strict";r.d(t,"l",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return l})),r.d(t,"f",(function(){return c})),r.d(t,"m",(function(){return u})),r.d(t,"k",(function(){return m})),r.d(t,"b",(function(){return d})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return h})),r.d(t,"e",(function(){return p})),r.d(t,"h",(function(){return g})),r.d(t,"g",(function(){return v}));var o=r("b775"),n=r("f121");function a(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo"),method:"get",params:e})}function i(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo"),method:"post",data:e})}function s(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo"),method:"put",data:e})}function l(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo"),method:"delete",data:e})}function c(e,t){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/byResource"),method:"get",params:{modelResource:e,packaged:t}})}function u(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/package"),method:"post",data:e})}function m(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/servingModel"),method:"get",params:{modelResource:e}})}function d(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/uploadModel"),method:"post",data:e})}function f(){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelType"),method:"get"})}function h(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelSuffix"),method:"get",params:e})}function p(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/byModelId"),method:"get",params:{id:e}})}function g(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelStruct"),method:"get",params:e})}function v(e){return Object(o["a"])({url:"/".concat(n["a"].MODEL,"/ptModelInfo/atlasModel"),method:"get",params:e})}t["c"]={list:a,add:i,edit:s,del:l}},"9eb2":function(e,t,r){"use strict";r.d(t,"f",(function(){return a})),r.d(t,"g",(function(){return i})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"h",(function(){return u})),r.d(t,"e",(function(){return m})),r.d(t,"d",(function(){return d}));var o=r("b775"),n=r("f121");function a(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms"),method:"get",params:e})}function i(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms/getAll"),method:"get",params:e})}function s(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms"),method:"post",data:e})}function l(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms"),method:"put",data:e})}function c(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms"),method:"delete",data:e})}function u(){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms/myAlgorithmCount"),method:"get"})}function m(){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms/getInferenceAlgorithm"),method:"get"})}function d(e){return Object(o["a"])({url:"/".concat(n["a"].ALGORITHM,"/algorithms/findAlgorithmByName"),method:"get",params:e})}},b68e:function(e,t,r){"use strict";r("11f4")},c844:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",staticClass:"model-config-wrapper",attrs:{model:e.form,rules:e.rules,"label-width":e.labelWidth}},[r("el-row",[r("div",{staticClass:"model-config-column"},[e.modelDisabled?e._e():r("el-form-item",{attrs:{label:"模型类型",prop:"modelResource"}},[r("el-radio-group",{on:{change:e.onModelResourceChange},model:{value:e.form.modelResource,callback:function(t){e.$set(e.form,"modelResource",t)},expression:"form.modelResource"}},[r("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("我的模型")]),e._v(" "),r("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("预训练模型")])],1)],1),e._v(" "),r("el-form-item",{ref:"modelBranchId",attrs:{prop:"modelBranchId",label:"模型"}},[r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择模型",disabled:e.modelDisabled,filterable:""},on:{change:e.onModelChange},model:{value:e.form.modelId,callback:function(t){e.$set(e.form,"modelId",t)},expression:"form.modelId"}},e._l(e.modelList,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.name+" ("+e.dict.label.frame_type[t.frameType]+")"}})})),1),e._v(" "),e.isPresetModel?e._e():r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择模型版本",filterable:""},on:{change:e.onModelVersionChange},model:{value:e.form.modelBranchId,callback:function(t){e.$set(e.form,"modelBranchId",t)},expression:"form.modelBranchId"}},e._l(e.modelVersionList,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.version,disabled:-1!==e.modelBranchIdList.indexOf(t.id)}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"自定义推理脚本"}},[r("el-switch",{on:{change:e.onUseScriptChange},model:{value:e.form.useScript,callback:function(t){e.$set(e.form,"useScript",t)},expression:"form.useScript"}})],1),e._v(" "),e.form.useScript?r("el-form-item",{staticClass:"form-item-follower",attrs:{prop:"algorithmId",error:e.scriptErrMsg}},[r("div",{staticClass:"tip px-20"},[e._v("\n          开启该选项将会使用自定义推理脚本进行推理\n        ")]),e._v(" "),r("el-select",{staticClass:"w-200 mt-10",attrs:{placeholder:"请选择自定义推理脚本",filterable:""},model:{value:e.form.algorithmId,callback:function(t){e.$set(e.form,"algorithmId",t)},expression:"form.algorithmId"}},e._l(e.algorithmList,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.algorithmName}})})),1),e._v(" "),r("span",{staticClass:"ml-10"},[e._v("\n          推理脚本未上传？点击\n          "),r("el-link",{staticClass:"lh-20",attrs:{type:"primary"},on:{click:e.goCreateAlgorithm}},[e._v("\n            这里\n          ")]),e._v("\n          上传推理脚本\n        ")],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"releaseRate",label:"灰度发布分流(%)",error:e.releaseRateErrMsg}},[r("el-input-number",{staticClass:"w-200",attrs:{min:0,max:100,"step-strictly":"",disabled:e.releaseRateDisabled},on:{change:e.onReleaseRateChange},model:{value:e.form.releaseRate,callback:function(t){e.$set(e.form,"releaseRate",t)},expression:"form.releaseRate"}})],1),e._v(" "),r("RunParamForm",{ref:"deployParamForm",staticClass:"w120",attrs:{"run-param-obj":e.form.deployParams||{},prop:"runParams","param-label-width":"120px"},on:{updateRunParams:e.updateDeployParams}})],1),e._v(" "),r("div",{staticClass:"model-config-column"},[r("el-form-item",{ref:"imageTag",attrs:{label:"镜像选择",prop:"imageTag"}},[r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择镜像",clearable:"",filterable:""},on:{change:e.onImageNameChange},model:{value:e.form.imageName,callback:function(t){e.$set(e.form,"imageName",t)},expression:"form.imageName"}},e._l(e.imageNameList,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1),e._v(" "),r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择镜像版本",clearable:"",filterable:""},on:{change:function(t){return e.validateField("imageTag")}},model:{value:e.form.imageTag,callback:function(t){e.$set(e.form,"imageTag",t)},expression:"form.imageTag"}},e._l(e.imageTagList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.imageTag,value:e.imageTag}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"节点类型",prop:"resourcesPoolType"}},[r("el-radio-group",{on:{change:e.onResourcesPoolTypeChange},model:{value:e.form.resourcesPoolType,callback:function(t){e.$set(e.form,"resourcesPoolType",t)},expression:"form.resourcesPoolType"}},[r("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("CPU")]),e._v(" "),r("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("GPU")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"节点规格",prop:"resourcesPoolSpecs"}},[r("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择节点规格",filterable:""},model:{value:e.form.resourcesPoolSpecs,callback:function(t){e.$set(e.form,"resourcesPoolSpecs",t)},expression:"form.resourcesPoolSpecs"}},e._l(e.specsList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.specsName,value:e.specsName}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"resourcesPoolNode",label:"节点数量",error:e.poolNodeErrMsg}},[r("el-input-number",{staticClass:"w-200",attrs:{min:1,max:10,"step-strictly":""},on:{change:e.onPoolNodeChange},model:{value:e.form.resourcesPoolNode,callback:function(t){e.$set(e.form,"resourcesPoolNode",t)},expression:"form.resourcesPoolNode"}})],1)],1)]),e._v(" "),e.deletable?r("i",{staticClass:"el-icon-delete config-delete cp",on:{click:function(t){return e.$emit("delete",e.config.id)}}}):e._e(),e._v(" "),r("BaseModal",{attrs:{visible:e.algorithmFormVisible,title:"上传自定义推理脚本",loading:e.algorithmFormSubmitting,width:"800px"},on:{"update:visible":function(t){e.algorithmFormVisible=t},close:e.onDialogClose,cancel:function(t){e.algorithmFormVisible=!1},ok:e.onSubmitForm}},[r("AlgorithmForm",{ref:"algorithmForm",attrs:{"form-type":"serving"}})],1)],1)},n=[],a=r("8bbd"),i=r("0be6"),s=r("a40c"),l=r("9eb2"),c=r("0c61"),u=r("f121"),m=r("ed08"),d=r("42b1"),f=r("f109"),h=r("9a71");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function g(e,t){return O(e)||w(e,t)||b(e,t)||v()}function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,t){if(e){if("string"===typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function w(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,n,a,i,s=[],l=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(o=a.call(r)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(u){c=!0,n=u}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw n}}return s}}function O(e){if(Array.isArray(e))return e}function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t,r){return t=j(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e){var t=S(e,"string");return"symbol"===p(t)?t:String(t)}function S(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==p(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function P(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */P=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(_){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=t&&t.prototype instanceof d?t:d,i=Object.create(a.prototype),s=new S(n||[]);return o(i,"_invoke",{value:L(e,r,s)}),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(_){return{type:"throw",arg:_}}}e.wrap=c;var m={};function d(){}function f(){}function h(){}var g={};l(g,a,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(x([])));b&&b!==t&&r.call(b,a)&&(g=b);var y=h.prototype=d.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function n(o,a,i,s){var l=u(e[o],e,a);if("throw"!==l.type){var c=l.arg,m=c.value;return m&&"object"==p(m)&&r.call(m,"__await")?t.resolve(m.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(m).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function L(e,t,r){var o="suspendedStart";return function(n,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===n)throw a;return N()}for(r.method=n,r.arg=a;;){var i=r.delegate;if(i){var s=I(i,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===o)throw o="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o="executing";var l=u(e,t,r);if("normal"===l.type){if(o=r.done?"completed":"suspendedYield",l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o="completed",r.method="throw",r.arg=l.arg)}}}function I(e,t){var r=t.method,o=e.iterator[r];if(void 0===o)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var n=u(o,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function x(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,n=function t(){for(;++o<e.length;)if(r.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:N}}function N(){return{value:void 0,done:!0}}return f.prototype=h,o(y,"constructor",{value:h,configurable:!0}),o(h,"constructor",{value:f,configurable:!0}),f.displayName=l(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,l(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},w(O.prototype),l(O.prototype,i,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,o,n,a){void 0===a&&(a=Promise);var i=new O(c(t,r,o,n),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(y),l(y,s,"Generator"),l(y,a,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function e(){for(;r.length;){var o=r.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},e.values=x,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(r,o){return i.type="throw",i.arg=e,t.next=r,o&&(t.method="next",t.arg=void 0),!!o}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var n=o.arg;j(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},e}function x(e,t,r,o,n,a,i){try{var s=e[a](i),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(o,n)}function N(e){return function(){var t=this,r=arguments;return new Promise((function(o,n){var a=e.apply(t,r);function i(e){x(a,o,n,i,s,"next",e)}function s(e){x(a,o,n,i,s,"throw",e)}i(void 0)}))}}var _={name:"ServingModelConfig",components:{RunParamForm:d["a"],BaseModal:f["a"],AlgorithmForm:h["default"]},dicts:["frame_type"],props:{config:{type:Object,required:!0},labelWidth:{type:String,default:null},deletable:{type:Boolean,default:!0},modelDisabled:{type:Boolean,default:!1},modelBranchIdMap:{type:Object,default:function(){return{}}},releaseRateDisabled:{type:Boolean,default:!0},releaseRateSumValid:{type:Boolean,default:!0},nodeCountValid:{type:Boolean,default:!0}},data:function(){var e=this;return{modelList:[],modelVersionList:[],modelBranchIdList:[],algorithmList:[],imageNameList:[],imageTagList:[],specsList:[],scriptValid:!0,form:{modelResource:0,modelId:null,modelBranchId:null,imageName:null,imageTag:null,resourcesPoolType:0,resourcesPoolSpecs:null,resourcesPoolNode:1,releaseRate:100,deployParams:{},useScript:!1,algorithmId:null},deployParams:{},rules:{modelBranchId:[{required:!0,trigger:"manual",validator:function(t,r,o){e.isPresetModel&&!e.form.modelId&&o(new Error("请选择模型")),e.isPresetModel||e.form.modelBranchId||o(new Error("请选择模型及版本")),o()}}],modelResource:[{required:!0,message:"请选择模型类型",trigger:"change"}],resourcesPoolType:[{required:!0,message:"请选择节点类型",trigger:"change"}],resourcesPoolSpecs:[{required:!0,message:"请选择节点规格",trigger:"change"}],imageTag:[{required:!0,message:"请选择镜像",trigger:"manual"}]},algorithmFormVisible:!1,algorithmFormSubmitting:!1}},computed:{isPresetModel:function(){return 1===this.form.modelResource},releaseRateZeroValid:function(){return 0!==this.form.releaseRate},releaseRateErrMsg:function(){return this.releaseRateSumValid?this.releaseRateZeroValid?null:"灰度分流率不能为 0":"灰度分流总和不为 100%，请检查"},poolNodeErrMsg:function(){return this.nodeCountValid?"":"模型节点总数不能超过".concat(u["h"].onlineServingNodeSumMax,"个")},scriptErrMsg:function(){return this.scriptValid?"":"请选择自定义推理脚本"}},watch:{modelBranchIdMap:{handler:function(e){this.modelBranchIdList=[];for(var t=0,r=Object.keys(e);t<r.length;t++){var o=r[t];o!==this.form.id&&this.modelBranchIdList.push(e[o])}},deep:!0,immediate:!0}},created:function(){Object.assign(this.form,this.config),Object.assign(this.deployParams,this.config.deployParams),this.getModels(this.form.modelResource,!0),this.getImageNames(!0),this.getAlgorithms(!0),this.getSpecList(!0)},methods:{getModels:function(){var e=N(P().mark((function e(t){var r,o,n=this,i=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],e.next=3,Object(a["k"])(t);case 3:if(this.modelList=e.sent,r&&this.form.modelId){e.next=8;break}this.form.modelBranchId=null,e.next=14;break;case 8:if(o=this.modelList.find((function(e){return e.id===n.form.modelId})),o){e.next=13;break}return this.$message.warning("原有模型不存在或不支持部署，请重新选择"),this.form.modelId=this.form.modelBranchId=null,e.abrupt("return");case 13:0===t&&this.getModelVersions(o.id,!0);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getModelVersions:function(){var e=N(P().mark((function e(t){var r,o,n,a=this,s=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]&&s[1],e.next=3,Object(i["f"])({parentId:t,current:1,size:500});case 3:o=e.sent,this.modelVersionList=o.result,r&&this.form.modelBranchId&&(n=this.modelVersionList.find((function(e){return e.id===a.form.modelBranchId})),n||(this.$message.warning("原有模型版本不存在，请重新选择"),this.form.modelBranchId=null));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),clearValidateField:function(e){this.$refs[e].clearValidate()},validateField:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual";this.$refs[e].validate(t)},onModelResourceChange:function(e){this.form.modelId=this.form.modelBranchId=null,this.getModels(e),this.$emit("model-resource-change",e),this.clearValidateField("modelBranchId")},onModelChange:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.form.modelId=e,this.isPresetModel?this.validateField("modelBranchId"):(this.getModelVersions(e),this.form.modelBranchId=null),this.$emit("change",this.form),t&&this.$emit("model-change",e)},onModelVersionChange:function(e){this.validateField("modelBranchId"),this.$emit("model-version-change",e)},onResourcesPoolTypeChange:function(){this.getSpecList()},onPoolNodeChange:function(){this.$emit("change",this.form)},onReleaseRateChange:function(e){this.$emit("release-rate-change",e)},updateModel:function(e){this.form.modelId=e,this.onModelChange(e,!1)},updateReleaseRate:function(e){this.form.releaseRate=e,this.$emit("change",this.form)},validate:function(e,t){var r=this;this.form.deployParams=I({},this.deployParams),this.$emit("change",this.form);var o=!0,n=function(e){o=o&&e};if(this.$refs.form.validate(n),o=this.validateScript()&&o,o=o&&this.releaseRateZeroValid&&this.releaseRateSumValid,o){var a=this.specsList.find((function(e){return e.specsName===r.form.resourcesPoolSpecs}));if(a){var i=a.cpuNum,s=a.gpuNum,l=a.memNum,c=a.workspaceRequest,u={cpuNum:1e3*i,gpuNum:s,memNum:l,workspaceRequest:"".concat(c,"M")};this.form.poolSpecsInfo=JSON.stringify(u)}e&&e(this.form)}else t&&t()},clearValidate:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.$refs.form.clearValidate.apply(this,t)},getAlgorithms:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(l["e"])().then((function(r){e.algorithmList=r,t&&e.form.algorithmId&&(e.algorithmList.some((function(t){return t.id===e.form.algorithmId}))||(e.$message.warning("原有算法不存在，请重新选择"),e.form.algorithmId=null))}))},onUseScriptChange:function(e){this.form.algorithmId=null,!e&&this.validateScript()},goCreateAlgorithm:function(){var e=this;this.algorithmFormVisible=!0,this.$nextTick((function(){e.$refs.algorithmForm.initForm({inference:!0})}))},validateScript:function(){return this.form.useScript?this.scriptValid=null!==this.form.algorithmId:this.scriptValid=!0,this.scriptValid},getImageNames:function(){var e=N(P().mark((function e(){var t,r=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.next=3,Object(s["d"])({imageTypes:[m["g"].SERVING]});case 3:this.imageNameList=e.sent,t&&this.form.imageName?this.imageNameList.includes(this.form.imageName)?this.getImageTags(this.form.imageName,!0):(this.$message.warning("原有镜像不存在，请重新选择"),this.form.imageName=this.form.imageTag=null):this.form.imageTag=null;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getImageTags:function(){var e=N(P().mark((function e(t){var r,o=this,n=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]&&n[1],e.next=3,Object(s["e"])({imageName:t,imageTypes:[m["g"].SERVING]});case 3:this.imageTagList=e.sent,r&&this.form.imageTag&&(this.imageTagList.some((function(e){return e.imageTag===o.form.imageTag}))||(this.$message.warning("原有镜像版本不存在，请重新选择"),this.form.imageTag=null));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onImageNameChange:function(e){this.form.imageTag=null,e?this.getImageTags(e):this.imageTagList=[]},updateDeployParams:function(e){this.deployParams=e},onDialogClose:function(){var e=this;setTimeout((function(){e.$refs.algorithmForm.resetForm()}),700)},onSubmitForm:function(){var e=this;this.$refs.algorithmForm.validate(function(){var t=N(P().mark((function t(r){var o,n;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.algorithmFormSubmitting=!0,t.next=3,Object(l["a"])(r).finally((function(){e.algorithmFormSubmitting=!1}));case 3:o=t.sent,n=g(o,1),e.form.algorithmId=n[0],e.algorithmFormVisible=!1,e.getAlgorithms(!0);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getSpecList:function(){var e=N(P().mark((function e(){var t,r=this,o=arguments;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],e.next=3,Object(c["d"])({module:m["p"].SERVING,resourcesPoolType:this.form.resourcesPoolType,current:1,size:500});case 3:this.specsList=e.sent.result,t&&this.form.resourcesPoolSpecs?this.specsList.find((function(e){return e.specsName===r.form.resourcesPoolSpecs}))||(this.$message.warning("原有资源规格不存在，请重新选择"),this.specsList.length&&(this.form.resourcesPoolSpecs=this.specsList[0].specsName)):this.specsList.length&&(this.form.resourcesPoolSpecs=this.specsList[0].specsName);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},E=_,T=(r("b68e"),r("2877")),R=Object(T["a"])(E,o,n,!1,null,"b0f87324",null);t["default"]=R.exports}}]);