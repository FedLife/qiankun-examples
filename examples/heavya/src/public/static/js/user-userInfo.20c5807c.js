(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["user-userInfo","user-components-updateEmail","user-components-updatePass"],{5851:function(e,t,o){"use strict";o("dc4d")},"88ba":function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{display:"inline-block"}},[o("BaseModal",{attrs:{visible:e.dialog,title:e.title,width:"475px"},on:{"update:visible":function(t){e.dialog=t},close:e.resetForm,cancel:function(t){e.dialog=!1},ok:e.doSubmit}},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"88px"}},[o("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[o("el-input",{staticStyle:{width:"320px"},attrs:{"auto-complete":"on"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"验证码",prop:"code"}},[o("el-input",{staticStyle:{width:"160px"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}}),e._v(" "),o("el-button",{staticStyle:{width:"155px"},attrs:{loading:e.codeLoading,disabled:e.isDisabled},on:{click:e.sendCode}},[e._v(e._s(e.buttonName))])],1),e._v(" "),o("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[o("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1)],1)],1)],1)},r=[],s=o("2f62"),a=o("4360"),n=o("61f7"),l=o("8de4"),c=o("3786"),u=o("c24f"),f=o("f109");function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){b(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function b(e,t,o){return t=v(t),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function v(e){var t=g(e,"string");return"symbol"===m(t)?t:String(t)}function g(e,t){if("object"!==m(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,t||"default");if("object"!==m(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var h={components:{BaseModal:f["a"]},props:{email:{type:String,required:!0}},data:function(){var e=this,t=function(t,o,i){""===o||null===o?i(new Error("新邮箱不能为空")):o===e.email?i(new Error("新邮箱不能与旧邮箱相同")):Object(n["i"])(o)?i():i(new Error("邮箱格式错误"))};return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},users:{email:"",password:""},codeLoading:!1,buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,message:"当前密码不能为空",trigger:"blur"}],email:[{required:!0,validator:t,trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},computed:p({},Object(s["d"])(["user"])),methods:{sendCode:function(){var e=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中";var t={email:this.form.email,type:2};Object(c["a"])(t).then((function(){e.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),e.codeLoading=!1,e.isDisabled=!0,e.buttonName="".concat(e.time-=1,"秒后重新发送"),e.timer=window.setInterval((function(){e.buttonName="".concat(e.time,"秒后重新发送"),e.time-=1,e.time<0&&(e.buttonName="重新发送",e.time=60,e.isDisabled=!1,window.clearInterval(e.timer))}),1e3)})).catch((function(t){e.resetForm(),e.codeLoading=!1,e.$message({message:t.message,type:"error"})}))}},doSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.loading=!0;var o={password:Object(l["b"])(e.form.pass),email:e.form.email,code:e.form.code,userId:e.user.id};return Object(u["c"])(o).then((function(){e.dialog=!1,e.loading=!1,e.resetForm(),e.$notify({title:"邮箱修改成功",type:"success",duration:1500}),a["a"].dispatch("GetUserInfo").then((function(){}))})).catch((function(t){e.loading=!1,e.$message({message:t.message,type:"error"})})),!0}return!1}))},resetForm:function(){this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},y=h,w=o("2877"),_=Object(w["a"])(y,i,r,!1,null,null,null);t["default"]=_.exports},"8a58":function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{display:"inline-block"}},[o("BaseModal",{attrs:{visible:e.dialog,title:e.title,width:"500px"},on:{"update:visible":function(t){e.dialog=t},close:e.resetForm,cancel:function(t){e.dialog=!1},ok:e.doSubmit}},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"88px"}},[o("el-form-item",{attrs:{label:"旧密码",prop:"oldPass"}},[o("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.oldPass,callback:function(t){e.$set(e.form,"oldPass",t)},expression:"form.oldPass"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"新密码",prop:"newPass"}},[o("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.newPass,callback:function(t){e.$set(e.form,"newPass",t)},expression:"form.newPass"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"确认密码",prop:"confirmPass"}},[o("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:e.form.confirmPass,callback:function(t){e.$set(e.form,"confirmPass",t)},expression:"form.confirmPass"}})],1)],1)],1)],1)},r=[],s=o("4360"),a=o("c24f"),n=o("8de4"),l=o("f109"),c={components:{BaseModal:l["a"]},data:function(){var e=this,t=function(t,o,i){o?e.form.newPass!==o?i(new Error("两次输入的密码不一致")):i():i(new Error("请再次输入密码"))};return{loading:!1,dialog:!1,title:"修改密码",form:{oldPass:"",newPass:"",confirmPass:""},rules:{oldPass:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPass:[{required:!0,validator:t,trigger:"blur"}]}}},methods:{doSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.loading=!0;var o={oldPass:Object(n["b"])(e.form.oldPass),newPass:Object(n["b"])(e.form.newPass)};return Object(a["e"])(o).then((function(){e.resetForm(),e.loading=!1,e.dialog=!1,e.$notify({title:"密码修改成功，请重新登录",type:"success",duration:1500}),setTimeout((function(){s["a"].dispatch("LogOut").then((function(){window.location.reload()}))}),1500)})).catch((function(t){e.loading=!1,e.$message({message:t.message,type:"error"})})),!0}return!1}))},resetForm:function(){this.$refs.form.resetFields(),this.form={oldPass:"",newPass:"",confirmPass:""}}}},u=c,f=o("2877"),m=Object(f["a"])(u,i,r,!1,null,null,null);t["default"]=m.exports},dc4d:function(e,t,o){},f10b:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{"margin-left":"30px"}},[o("div",{staticClass:"box-card"},[o("img",{staticClass:"avatar",attrs:{src:e.user.avatar,title:"点击上传头像"},on:{click:e.openUploadDialog}}),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("登录账号")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.user.username))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("用户昵称")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.user.nickName))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("用户性别")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.user.sex))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("手机号码")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.user.phone))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("用户邮箱")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.user.email))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("用户角色")]),e._v(" "),o("div",{staticClass:"info-text"},[e._v(e._s(e.userRoles))])]),e._v(" "),o("div",{staticClass:"info-row"},[o("div",{staticClass:"info-label"},[e._v("用户设置")]),e._v(" "),o("div",{staticClass:"info-text"},[o("el-button",{attrs:{type:"text"},on:{click:function(t){e.infoDialog=!0}}},[e._v("修改信息")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(t){e.$refs.pass.dialog=!0}}},[e._v("修改密码")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(t){e.$refs.email.dialog=!0}}},[e._v("修改邮箱")])],1)])]),e._v(" "),o("UploadForm",{attrs:{action:"fakeApi",title:"上传头像",visible:e.uploadDialogVisible,toggleVisible:e.handleClose,params:e.uploadParams,multiple:!1,limit:1,showFileCount:!1,filters:e.uploadFilters},on:{uploadSuccess:e.uploadSuccess,uploadError:e.uploadError}}),e._v(" "),o("BaseModal",{attrs:{visible:e.infoDialog,title:"修改信息",width:"450px"},on:{"update:visible":function(t){e.infoDialog=t},cancel:function(t){e.infoDialog=!1},open:e.onDialogOpen,ok:e.doSubmit}},[o("el-form",{ref:"form",staticStyle:{"margin-top":"10px"},attrs:{model:e.form,rules:e.rules,"label-width":"65px"}},[o("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[o("el-input",{staticStyle:{width:"40%"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}}),e._v(" "),o("span",{staticStyle:{"margin-left":"10px",color:"#c0c0c0"}},[e._v("用户昵称不作为登录使用")])],1),e._v(" "),o("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[o("el-input",{staticStyle:{width:"40%"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}}),e._v(" "),o("span",{staticStyle:{"margin-left":"10px",color:"#c0c0c0"}},[e._v("一个手机号只能注册一个用户")])],1),e._v(" "),o("el-form-item",{attrs:{label:"性别"}},[o("el-radio-group",{staticStyle:{width:"178px"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[o("el-radio",{attrs:{label:"男"}},[e._v("男")]),e._v(" "),o("el-radio",{attrs:{label:"女"}},[e._v("女")])],1)],1)],1)],1),e._v(" "),o("updateEmail",{ref:"email",attrs:{email:e.user.email}}),e._v(" "),o("updatePass",{ref:"pass"})],1)},r=[],s=o("2f62"),a=o("4360"),n=o("88be"),l=o("61f7"),c=o("ed08"),u=o("c24f"),f=o("f109"),m=o("bce1"),d=o("88ba"),p=o("8a58");function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){h(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function h(e,t,o){return t=y(t),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function y(e){var t=w(e,"string");return"symbol"===b(t)?t:String(t)}function w(e,t){if("object"!==b(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,t||"default");if("object"!==b(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var _={name:"UserInfo",components:{BaseModal:f["a"],UploadForm:m["a"],updatePass:p["default"],updateEmail:d["default"]},data:function(){return{saveLoading:!1,infoDialog:!1,uploadDialogVisible:!1,form:{id:"",nickName:"",sex:"",phone:""},rules:{nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{validator:l["p"],trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1\d{10}$/,message:"请输入正确的11位手机号码",trigger:["blur","change"]}]},uploadFilters:[c["ib"]]}},computed:g(g({},Object(s["d"])(["user"])),{},{userRoles:function(){var e=this.user.roles||[],t=e.map((function(e){return e.name}));return t.join(" ")||"-"},uploadParams:function(){return{objectPath:"avatar/".concat(this.user.id)}}}),created:function(){a["a"].dispatch("GetUserInfo").then((function(){}))},methods:{uploadSuccess:function(e){var t=this;if(e.length){var o=e[0].data.objectName;Object(u["d"])({path:"".concat(n["b"].bucketName,"/").concat(o),realName:"".concat(n["b"].bucketHost,"/").concat(n["b"].bucketName,"/").concat(o)}).then((function(){t.$notify({title:"头像修改成功",type:"success",duration:2500}),a["a"].dispatch("GetUserInfo").then((function(){}))}))}},uploadError:function(){this.$message({message:"头像修改失败",type:"error"})},openUploadDialog:function(){this.uploadDialogVisible=!0},handleClose:function(){this.uploadDialogVisible=!1},onDialogOpen:function(){this.form={id:this.user.id,nickName:this.user.nickName,sex:this.user.sex,phone:this.user.phone}},doSubmit:function(){var e=this;this.$refs.form&&this.$refs.form.validate((function(t){t&&(e.saveLoading=!0,a["a"].dispatch("UpdateUserInfo",e.form).then((function(){e.editSuccessNotify(),e.saveLoading=!1,e.infoDialog=!1})).catch((function(){e.saveLoading=!1,e.infoDialog=!1})))}))}}},P=_,O=(o("5851"),o("2877")),x=Object(O["a"])(P,i,r,!1,null,null,null);t["default"]=x.exports}}]);