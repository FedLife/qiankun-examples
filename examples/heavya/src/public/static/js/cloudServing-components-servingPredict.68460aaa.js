(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["cloudServing-components-servingPredict","cloudServing-components-servingCallGuide","cloudServing-util"],{"0ff8":function(t,e,n){"use strict";n.d(e,"i",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return s})),n.d(e,"k",(function(){return l})),n.d(e,"l",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"e",(function(){return p})),n.d(e,"h",(function(){return m})),n.d(e,"g",(function(){return h})),n.d(e,"j",(function(){return g}));var r=n("b775"),a=n("f121");function i(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services"),method:"get",params:t})}function o(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services"),method:"post",data:t})}function c(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services"),method:"put",data:t})}function u(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services"),method:"delete",data:{id:t}})}function s(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/detail"),method:"get",params:{id:t}})}function l(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/start"),method:"post",data:{id:t}})}function d(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/stop"),method:"post",data:{id:t}})}function f(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/predictParam"),method:"get",params:{id:t}})}function p(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/metrics/").concat(t),method:"get"})}function m(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/servingConfig/pod/").concat(t),method:"get"})}function h(t){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/rollback/").concat(t),method:"get"})}function g(t,e){return Object(r["a"])({url:"/".concat(a["a"].CLOUD_SERVING,"/services/predict"),method:"post",headers:{"Content-Type":"multipart/form-data"},params:e,data:t})}},"12fe":function(t,e,n){},2988:function(t,e,n){"use strict";n.r(e),n.d(e,"SERVING_STATUS_ENUM",(function(){return m})),n.d(e,"ONLINE_SERVING_STATUS_MAP",(function(){return h})),n.d(e,"BATCH_SERVING_STATUS_MAP",(function(){return g})),n.d(e,"ONLINE_SERVING_TYPE",(function(){return v})),n.d(e,"serviceTypeMap",(function(){return b})),n.d(e,"map2Array",(function(){return S})),n.d(e,"numFormatter",(function(){return O})),n.d(e,"upload",(function(){return y})),n.d(e,"cpuFormatter",(function(){return E})),n.d(e,"memFormatter",(function(){return _})),n.d(e,"batchServingProgressColor",(function(){return P})),n.d(e,"getPollId",(function(){return U})),n.d(e,"parseObj",(function(){return C}));var r,a,i,o=n("ed08");function c(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function u(t,e){if(t){if("string"===typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function d(t,e,n){return e=f(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t){var e=p(t,"string");return"symbol"===l(e)?e:String(e)}function p(t,e){if("object"!==l(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var m={EXCEPTION:"0",IN_DEPLOYMENT:"1",WORKING:"2",STOP:"3",COMPLETED:"4",UNKNOWN:"5"},h=(r={},d(r,m.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),d(r,m.WORKING,{name:"运行中",tagMap:"success"}),d(r,m.STOP,{name:"已停止",tagMap:"info"}),d(r,m.EXCEPTION,{name:"运行失败",tagMap:"danger"}),r),g=(a={},d(a,m.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),d(a,m.WORKING,{name:"运行中",tagMap:""}),d(a,m.STOP,{name:"已停止",tagMap:"info"}),d(a,m.EXCEPTION,{name:"运行失败",tagMap:"danger"}),d(a,m.COMPLETED,{name:"运行完成",tagMap:"success"}),d(a,m.UNKNOWN,{name:"未知",tagMap:"info"}),a),v={HTTP:0,GRPC:1},b=(i={},d(i,v.HTTP,"HTTP 模式"),d(i,v.GRPC,"GRPC 模式"),i);function S(t){var e=[];if("object"!==l(t)||null===t)return e;for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];e.push({name:a,type:t[a]})}return e}function O(t){return t<1e4?"".concat(t):"".concat(Math.round(t/1e3)/10,"万")}function N(t){var e=t.response||t.responseText;try{return JSON.parse(e)}catch(n){return e}}function y(t){var e,n=new XMLHttpRequest,r=new FormData,a=c(t.fileList);try{for(a.s();!(e=a.n()).done;){var i=e.value;r.append(t.uploadName,i,i.name)}}catch(o){a.e(o)}finally{a.f()}return n.upload&&t.onUploadProgress&&(n.upload.onprogress=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.onUploadProgress(e)}),n.onreadystatechange=function(){if(4===n.readyState){var e=N(n);if(n.status<200||n.status>=300){var r=new Error(e.msg||"未知错误");return t.onUploadError(r)}t.onUploadSuccess(e)}},n.open("post",t.requestUrl,!0),n.send(r),n}function E(t,e){return e?("n"===e&&(t/=1e6,e="m"),"m"===e?"".concat(Math.round(10*t)/10,"m"):t+e):"".concat(t,"核")}function _(t,e){return"".concat(Math.round(10*Object(o["qb"])(t,e))/10," Gi")}var P=[{color:"#67c23a",percentage:100}];function U(){return(new Date).getTime()}function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"; ";return t instanceof Object?Object.keys(t).filter((function(e){return null!==t[e]||""!==t[e]})).map((function(e){return"".concat(e,": ").concat(t[e])})).join(e):""}},b850:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"serving-predict-wrapper"}},[n("el-form",[n("el-form-item",{attrs:{label:"请求路径："}},[t._v("\n      "+t._s(t.requestUrl)+"\n    ")]),t._v(" "),n("el-form-item",{attrs:{label:"选择预测文件"}},[n("el-upload",{ref:"upload",staticClass:"serving-predict-upload",attrs:{disabled:!t.requestUrl||t.disabled,multiple:"",action:t.requestUrl,"auto-upload":!1,"on-change":t.onFileChange,"on-success":t.onUploadSuccess,name:t.uploadName}},[n("el-button",{attrs:{slot:"trigger",disabled:t.disabled},slot:"trigger"},[t._v("上传")]),t._v(" "),n("el-button",{attrs:{disabled:t.disabled},on:{click:t.toPredict}},[t._v("预测")]),t._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.predictContent,placement:"right"}},[n("i",{staticClass:"el-icon-warning-outline primary f18 vm"})]),t._v(" "),t.predicting?n("i",{staticClass:"el-icon-loading"}):t._e()],1)],1),t._v(" "),n("el-form-item",{attrs:{label:"预测结果："}})],1),t._v(" "),n("el-card",{staticClass:"result-display-area",attrs:{shadow:"never"}},[t._v(t._s(t.result))])],1)},a=[],i=n("0ff8"),o=n("2988"),c=n("f121"),u={name:"ServingPredict",props:{type:{type:Number,default:o["ONLINE_SERVING_TYPE"].HTTP},predictParam:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1},refresh:{type:Boolean,default:!1},uploadName:{type:String,default:"files"}},data:function(){return{fileList:[],result:null,predicting:!1}},computed:{requestUrl:function(){return this.predictParam.url},isGrpc:function(){return this.type===o["ONLINE_SERVING_TYPE"].GRPC},predictContent:function(){return"单次预测选择的文件大小总计不超过 ".concat(c["h"].onlinePredictFileSizeSum,"MB")}},activated:function(){this.refresh&&this.reset()},methods:{toPredict:function(){var t=this;if(!this.predicting)if(this.fileList.length){var e=this.fileList.reduce((function(t,e){return t+e.size}),0)/1024/1024;if(e>c["h"].onlinePredictFileSizeSum)this.$message.warning("当前上传文件大小总和为 ".concat(e.toFixed(2),"MB，超过限制大小"));else if(this.predicting=!0,this.isGrpc){var n=new FormData;this.fileList.forEach((function(t){return n.append("files",t.raw,t.raw.name)})),Object(i["j"])(n,{id:this.predictParam.id,url:this.requestUrl}).then((function(e){t.onUploadSuccess(e)})).catch((function(e){t.onUploadError(e)}))}else Object(o["upload"])({requestUrl:this.requestUrl,fileList:this.fileList.map((function(t){return t.raw})),uploadName:this.uploadName,onUploadError:this.onUploadError,onUploadSuccess:this.onUploadSuccess})}else this.$message.warning("请先选择文件")},reset:function(){this.result=null,this.$refs.upload.clearFiles(),this.predicting=!1,this.$emit("reseted")},onFileChange:function(t,e){this.fileList=e},onUploadError:function(t){this.$message.error(t.message),this.predicting=!1},onUploadSuccess:function(t){try{this.type===o["ONLINE_SERVING_TYPE"].GRPC&&(t=JSON.parse(t)),this.result=JSON.stringify(t.data,null,4)}catch(e){this.result=t}this.$refs.upload.clearFiles(),this.fileList=[],this.predicting=!1}}},s=u,l=(n("f78d"),n("2877")),d=Object(l["a"])(s,r,a,!1,null,"bc1b3ac4",null);e["default"]=d.exports},f78d:function(t,e,n){"use strict";n("12fe")}}]);