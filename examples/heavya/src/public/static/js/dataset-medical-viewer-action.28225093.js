(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["dataset-medical-viewer-action","dataset-medical-lib","dataset-medical-viewer-helpInfo"],{"0843":function(t,e,n){"use strict";n("6131")},17:function(t,e){},"22a3":function(t,e,n){"use strict";n.r(e),n.d(e,"sortInstances",(function(){return S})),n.d(e,"buildWADOUrl",(function(){return E})),n.d(e,"getImageIdsForSeries",(function(){return x})),n.d(e,"getSOPInstanceUID",(function(){return j})),n.d(e,"retrieveBulkData",(function(){return C})),n.d(e,"readRawData",(function(){return F})),n.d(e,"parseDicom",(function(){return P})),n.d(e,"readDicom",(function(){return k})),n.d(e,"readDicoms",(function(){return A})),n.d(e,"validateDicomSeries",(function(){return L})),n.d(e,"genDrawingFromAnnotations",(function(){return N})),n.d(e,"removeAnchorsFromDrawer",(function(){return T})),n.d(e,"getDrawLayer",(function(){return M})),n.d(e,"getShapeEditor",(function(){return U})),n.d(e,"activeShapeGroup",(function(){return B})),n.d(e,"getShapeGroup",(function(){return G})),n.d(e,"dwc",(function(){return D}));var r=n("4e9b"),o=n.n(r),a=n("acd4"),i=n.n(a),c=n("df03"),s=n("2ef0"),l=n("ed08");function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function f(t,e){return p(t)||d(t,e)||m(t,e)||v()}function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==e);s=!0);}catch(u){l=!0,o=u}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}function p(t){if(Array.isArray(t))return t}function h(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=m(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function m(t,e){if(t){if("string"===typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */b=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(F){s=function(t,e,n){return t[e]=n}}function l(t,e,n,o){var a=e&&e.prototype instanceof d?e:d,i=Object.create(a.prototype),c=new x(o||[]);return r(i,"_invoke",{value:I(t,n,c)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(F){return{type:"throw",arg:F}}}t.wrap=l;var v={};function d(){}function p(){}function h(){}var m={};s(m,a,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(j([])));y&&y!==e&&n.call(y,a)&&(m=y);var w=h.prototype=d.prototype=Object.create(m);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function o(r,a,i,c){var s=f(t[r],t,a);if("throw"!==s.type){var l=s.arg,v=l.value;return v&&"object"==u(v)&&n.call(v,"__await")?e.resolve(v.__await).then((function(t){o("next",t,i,c)}),(function(t){o("throw",t,i,c)})):e.resolve(v).then((function(t){l.value=t,i(l)}),(function(t){return o("throw",t,i,c)}))}c(s.arg)}var a;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function I(t,e,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return C()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=D(i,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=f(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function D(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,D(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=f(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,v;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,v):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:C}}function C(){return{value:void 0,done:!0}}return p.prototype=h,r(w,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:p,configurable:!0}),p.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},_(O.prototype),s(O.prototype,i,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new O(l(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(w),s(w,c,"Generator"),s(w,a,(function(){return this})),s(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=j,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:j(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),v}},t}function y(t,e,n,r,o,a,i){try{var c=t[a](i),s=c.value}catch(l){return void n(l)}c.done?e(s):Promise.resolve(s).then(r,o)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){y(a,r,o,i,c,"next",t)}function c(t){y(a,r,o,i,c,"throw",t)}i(void 0)}))}}var _=n("76a0"),O=function(){return{}},I="".concat("http://192.168.26.202:30800/dcm4chee/dcm4chee-arc/aets/DCM4CHEE_ADMIN","/rs"),D=new c["a"].DICOMwebClient({url:I,headers:O()}),S=function(t){return t.sort((function(t,e){var n=t["00200013"].Value[0],r=e["00200013"].Value[0];return n-r}))},E=function(t){var e=t.studyInstanceUID,n=t.seriesInstanceUID,r=t.objectUID;return"".concat("http://192.168.26.202:30800/dcm4chee/dcm4chee-arc/aets/DCM4CHEE_ADMIN","/wado?requestType=WADO&studyUID=").concat(e,"&seriesUID=").concat(n,"&objectUID=").concat(r,"&contentType=application/dicom")},x=function(t){return t&&t.length?S(t).map((function(t){var e=t["7FE00010"].BulkDataURI.replace(/^https?:\/\//,""),n=e.split("/"),r=n.findIndex((function(t){return"studies"===t})),o=n.findIndex((function(t){return"series"===t})),a=n.findIndex((function(t){return"instances"===t}));if(r>-1&&o>-1){var i=n[r+1],c=n[o+1],s=n[a+1];return{studyInstanceUID:i,seriesInstanceUID:c,objectUID:s}}throw new Error("找不到对应的 studyUID 或 seriesUID")})):[]},j=function(t){if("undefined"!==typeof t.x00020010&&"undefined"!==typeof t.x00080018)return o.a.dicom.cleanString(t.x00080018.value[0]);throw new Error("当前 dcm 文件不合法，无法找到 SOPInstanceUID")},C=function(t){return D.retrieveBulkData({BulkDataURI:t})};function F(t){var e={},n=o.a.v01Tov02DrawingsAndDetails(t);return e.drawings=o.a.v02Tov03Drawings(n.drawings).toObject(),e.drawingsDetails=n.drawingsDetails,e}var P=function(t,e){try{var n=i.a.parseDicom(t),r=n.uint16("x00280010"),o=n.uint16("x00280011"),a=n.string("x0020000e"),c=n.string("x00100020"),s=n.string("x0020000d"),l=n.string("x00080060"),u=n.string("x00180015"),f=n.string("x00080018"),v=n.elements.x7fe00010;if(!v)throw new Error("文件信息不完整：7fe00010字段不存在");return{rows:r,columns:o,patientID:c,seriesInstanceUID:a,studyInstanceUID:s,modality:l,bodyPartExamined:u,filename:e,SOPInstanceUID:f}}catch(d){return d instanceof Error?d:new Error(d.exception||d)}},k=function(t){return new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var o=r.target.result,a=new Uint8Array(o),i=P(a,t.raw.name.slice(0,-4));i instanceof Error?n(i):e(i)},r.readAsArrayBuffer(t.raw)}))},A=function(){var t=w(b().mark((function t(e){var n,r;return b().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=function(t){return new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var o=r.target.result,a=new Uint8Array(o),i=P(a,t.raw.name.slice(0,-4));i instanceof Error?n(i):e(i)},r.readAsArrayBuffer(t.raw)}))},t.prev=1,t.next=4,_(e,n,{concurrency:10});case 4:return r=t.sent,t.abrupt("return",r);case 8:return t.prev=8,t.t0=t["catch"](1),t.abrupt("return",Promise.reject(t.t0));case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}(),L=function(t){if(t.length<1)return"文件数量不能为空";var e=Object(l["kb"])(t,"rows");if(!e)return"文件系列 rows 必须一致";var n=Object(l["kb"])(t,"columns");return n?"":"文件系列 columns 必须一致"},N=function(t,e){for(var n=[],r=1,a=[],i={},c=0;c<t.length;c+=1){for(var u=[],f=[],v=0;v<r;v+=1){for(var d=[],p=0;p<t[c].length;p+=1){var h=t[c][p],m=1/e,g=Object(l["L"])(h,m),b=o.a.math.guid();d.push({attrs:{name:"roi-group",id:b},className:"Group",children:[{attrs:{points:Object(s["flatten"])(g),name:"shape",closed:!0,strokeWidth:3,draggable:!0},className:"Line"}]}),a.push(b),f.push(b)}u.push(d)}i[c]=f,n.push(u)}var y=F(n),w=y.drawings,_=y.drawingsDetails;return{drawings:w,drawingsDetails:_,drawingIds:a,sliceDrawingMap:i}},T=function(t){var e=t.getChildren(o.a.draw.isPositionNode);e.forEach((function(t){var e=t.getChildren();e.forEach((function(t){var e=t.getChildren((function(t){return"anchor"===t.name()}));e.each((function(t){return t.remove()}))}))}))},M=function(t){var e=t.getDrawController().getDrawLayer();return e},U=function(t){return t.getShapeEditor()},B=function(t,e){var n=U(t);n.disable(),n.setShape(e),n.setImage(t.getImage()),n.enable()},G=function(t,e){var n,r=e.getChildren(o.a.draw.isPositionNode),a=null,i=h(r);try{for(i.s();!(n=i.n()).done;){var c=n.value,s=c.getChildren(),l=s.filter((function(e){return t===e.id()}));if(l.length){var u=l[0].find(".shape"),v=f(u,1);a=v[0];break}}}catch(d){i.e(d)}finally{i.f()}return a}},6131:function(t,e,n){},"7f3c":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"action-section flex"},[n("div",{staticClass:"ToolbarButton",on:{click:t.fullScreen}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"full-screen"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("全屏")])]),t._v(" "),n("div",{staticClass:"rel"},[n("div",{staticClass:"ToolbarButton",on:{click:t.showTags}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"tag"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("查看标签")])]),t._v(" "),t.state.tagsOpen?n("div",{staticClass:"popup"},[n("div",{staticClass:"fullBg",on:{mousedown:t.closePopup}}),t._v(" "),n("portal",{attrs:{to:"toolsAction"}},[n("div",{staticClass:"dwv-popup",staticStyle:{background:"#fff"}},[n("div",{staticStyle:{width:"30%",padding:"10px"}},[n("el-input",{attrs:{clearable:"",placeholder:"查询标签"},on:{input:t.handleTagFilter},model:{value:t.state.tagSearch,callback:function(e){t.$set(t.state,"tagSearch",e)},expression:"state.tagSearch"}})],1),t._v(" "),n("InfoTable",{attrs:{tableAttrs:t.tableProps,columns:t.columns,dataSource:t.state.metaData,showPagination:!1}})],1)])],1):t._e()]),t._v(" "),n("div",[n("div",{staticClass:"ToolbarButton",on:{click:t.showHelp}},[n("div",{staticClass:"icon-wrapper"},[n("IconFont",{attrs:{type:"help"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("帮助")])]),t._v(" "),t.state.helpOpen?n("div",{staticClass:"popup"},[n("div",{staticClass:"fullBg",on:{mousedown:t.closePopup}}),t._v(" "),n("portal",{attrs:{to:"toolsAction"}},[n("div",{staticClass:"dwv-popup"},[n("HelpInfo")],1)])],1):t._e()]),t._v(" "),n("div",{staticClass:"ToolbarButton",class:t.state.saveIng?"pen":"",on:{click:function(e){return t.saveAnnotation(0)}}},[n("div",{staticClass:"icon-wrapper"},[t.saveState.loading?n("i",{staticClass:"el-icon-loading"}):n("IconFont",{attrs:{type:"baocun"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("保存")])]),t._v(" "),n("div",{staticClass:"ToolbarButton",class:t.state.finishIng?"pen":"",on:{click:function(e){return t.saveAnnotation(1)}}},[n("div",{staticClass:"round icon-wrapper"},[t.saveState.loading?n("i",{staticClass:"el-icon-loading"}):n("IconFont",{attrs:{type:"finish"}})],1),t._v(" "),n("div",{staticClass:"toolbarText"},[t._v("完成")])])])},o=[],a=n("4e9b"),i=n.n(a),c=n("93bf"),s=n.n(c),l=n("2ef0"),u=n("5c96"),f=n("ed09"),v=n("ed35"),d=n("22a3"),p=n("e8c4");function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e,n){return e=y(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function y(t){var e=w(t,"string");return"symbol"===h(e)?e:String(e)}function w(t,e){if("object"!==h(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var _={name:"ToolAction",components:{InfoTable:v["a"],HelpInfo:p["default"]},props:{tools:{type:Array},getApp:Function,save:Function,medicalId:String,rawAutoAnnotationIds:{type:Array,default:function(){return[]}},changedDrawId:{type:Array,default:function(){return[]}},sliceDrawingMap:{type:Object,default:function(){return{}}},saveState:{type:Object,default:function(){return{}}}},setup:function(t){var e=t.getApp,n=Object(f["n"])({tagsOpen:!1,helpOpen:!1,metaData:[],rawMetaData:[],tagSearch:"",saveIng:!1,finishIng:!1,isFullscreen:!1}),r={0:"saveIng",1:"finishIng"},o=function(){Object.assign(n,{tagsOpen:!1,helpOpen:!1})},a=function(t){var e=g({},t);"undefined"!==typeof e.InstanceNumber&&delete e.InstanceNumber;var n=e;return i.a.utils.isObject(e)&&!i.a.utils.isArray(e)&&(n=i.a.utils.objectToArray(e)),n},c=function(o){var a=r[o],c={};Object.assign(n,b({},a,!0));var s=e(),f=s.getDrawController().getDrawLayer();Object(d["removeAnchorsFromDrawer"])(f);var v=f.toObject(),p=s.getDrawStoreDetails(),h=s.getMetaData(),m=h.SOPInstanceUID.value,g=Object(l["isPlainObject"])(m)?m:[m],y=f.getChildren(),w=[];y.forEach((function(e){var n=i.a.draw.getPositionFromGroupId(e.id()),r=e.getChildren().map((function(t){return t.id()})),o=!Object(l["isEqual"])(r,t.sliceDrawingMap[n.sliceNumber])||Object(l["intersection"])(r,t.changedDrawId).length>0,a=Object.keys(g);o&&w.push(a[n.sliceNumber])})),w.length&&y.forEach((function(t){var e=i.a.draw.getPositionFromGroupId(t.id()),n=t.getChildren().map((function(t){return t.id()}));c[e.sliceNumber]=n}));var _={medicalId:Number(t.medicalId),type:o,annotations:JSON.stringify({drawings:v,drawingsDetails:p,sliceDrawingMap:w.length?c:t.sliceDrawingMap})};return 0===o&&w.length&&(_.medicalFiles=w.map((function(t){return g[t]}))),t.save({drawing:_}).then((function(){var t=0===o?"保存成功":"数据集标注完成";u["Message"].success(t)})).finally((function(){Object.assign(n,b({},a,!1))}))},v=function(){var t=e(),r=a(t.getMetaData());Object.assign(n,{tagsOpen:!0,helpOpen:!1,metaData:r,rawMetaData:r})},p=function(){if(!s.a.isEnabled)return u["Message"].info("当前浏览器不支持全屏模式"),!1;n.isFullscreen=!n.isFullscreen,s.a.toggle()},h=function(){Object.assign(n,{tagsOpen:!1,helpOpen:!0})},m=function(t){var e=n.rawMetaData.filter((function(e){for(var n=!1,r=0,o=Object.values(e);r<o.length;r++){var a=o[r];if(String(a).toLowerCase().indexOf(t.toLowerCase())>-1){n=!0;break}}return n}));Object.assign(n,{metaData:e})},y={stripe:!0},w=[{prop:"name",label:"名称",minWidth:150},{prop:"value",label:"值",minWidth:120},{prop:"group",label:"组标签"},{prop:"element",label:"元素标签"},{prop:"vr",label:"VR"}];return{state:n,columns:w,tableProps:y,saveAnnotation:c,showTags:v,fullScreen:p,showHelp:h,handleTagFilter:m,closePopup:o}}},O=_,I=(n("fede"),n("2877")),D=Object(I["a"])(O,r,o,!1,null,"129f3f18",null);e["default"]=D.exports},"93bf":function(t,e,n){
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var e="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},n=t.exports,r=function(){for(var t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,o=n.length,a={};r<o;r++)if(t=n[r],t&&t[1]in e){for(r=0;r<t.length;r++)a[n[0][r]]=t[r];return a}return!1}(),o={change:r.fullscreenchange,error:r.fullscreenerror},a={request:function(t,n){return new Promise(function(o,a){var i=function(){this.off("change",i),o()}.bind(this);this.on("change",i),t=t||e.documentElement;var c=t[r.requestFullscreen](n);c instanceof Promise&&c.then(i).catch(a)}.bind(this))},exit:function(){return new Promise(function(t,n){if(this.isFullscreen){var o=function(){this.off("change",o),t()}.bind(this);this.on("change",o);var a=e[r.exitFullscreen]();a instanceof Promise&&a.then(o).catch(n)}else t()}.bind(this))},toggle:function(t,e){return this.isFullscreen?this.exit():this.request(t,e)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,n){var r=o[t];r&&e.addEventListener(r,n,!1)},off:function(t,n){var r=o[t];r&&e.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),n?t.exports=a:window.screenfull=a):n?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()},da76:function(t,e,n){},e8c4:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dwv-content"},[n("p",[t._v("欢迎使用医疗影像标注工具！")]),t._v(" "),n("p",[t._v("\n    在这里，你可以通过上传标准\n    "),n("el-link",{attrs:{href:"https://www.dicomstandard.org/",target:"_blank"}},[t._v("DICOM")]),t._v("\n    文件就能实现随时随地进行医疗影像查询、阅片、智能识别、影像标注等常见操作。系统还提供了一些标准工具对影像文件进行操作，包括滚动浏览，缩放/拖拽，窗宽/窗位，对比，预设窗口等工具。\n  ")],1),t._v(" "),n("p",[t._v("所有 DICOM 标签都可以点击「查看标签」按钮进行查询，你可以指定搜索条件对信息进行过滤。")]),t._v(" "),n("p",[t._v("下列工具定义了与用户操作相关的产品交互行为：")]),t._v(" "),n("el-collapse",{attrs:{accordion:""},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[n("el-collapse-item",{attrs:{title:"滚动浏览（Scroll）",name:"Scroll"}},[n("div",[t._v("鼠标滚轮：使用快速浏览模式，可以通过鼠标滚轮动作对图像切片（slice）进行快速切换。")]),t._v(" "),n("div",[t._v("键盘快键：按住键盘快捷键右键可以切换下一张切片，左键切换上一张切片。")]),t._v(" "),n("div",[t._v("自动播放：双击切片开始切片逐帧自动切换模式，再次单击停止。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"缩放拖拽（ZoomAndPan）",name:"ZoomAndPan"}},[n("div",[t._v("缩放/拖拽工具用于放大缩小和拖拽图像。")]),t._v(" "),n("div",[t._v("缩放：鼠标滚轮用于缩放图像。")]),t._v(" "),n("div",[t._v("拖拽：按住鼠标拖动图片到想要的位置")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"窗宽窗位（WW/WC）",name:"WindowLevel"}},[n("div",[t._v("改变图像的窗位和窗宽。")]),t._v(" "),n("div",[t._v("按住鼠标按住拖动图像，沿水平方向改变窗宽，沿竖直方向改变窗位。")]),t._v(" "),n("div",[t._v("双击影像，可将该点作为窗位窗宽中心值。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"绘制标注（Draw）",name:"Draw"}},[n("div",[t._v("基于锚点绘制标注")]),t._v(" "),n("div",[t._v("\n        绘制标注：按下鼠标开始绘制锚点，移动鼠标到想要的地点，再次单击鼠标连接两个锚点，双击完成绘制。\n      ")]),t._v(" "),n("div",[t._v("\n        修改标注：单击选中标注路径，路径出现锚点，拖动锚点到想要的位置，点击「保存」按钮完成修改\n      ")]),t._v(" "),n("div",[t._v("删除标注：单击选中标注，按住 delete 快捷键删除标注")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"展示、隐藏信息（Info）",name:"Info"}},[n("div",[t._v("切换影像信息展示")]),t._v(" "),n("div",[t._v("展示信息：点击「展示信息」按钮。")]),t._v(" "),n("div",[t._v("隐藏信息：点击「隐藏信息」按钮。")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"重置（Reset）",name:"Reset"}},[n("div",[t._v("重置标注工具状态")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"预设窗口（PresetLevel）",name:"PresetLevel"}},[n("div",{staticClass:"mb-10"},[t._v("提供一些不同器官标准预设窗口、窗位设置。")]),t._v(" "),n("div",[t._v("以下数据按照（窗口/窗位）格式提供。")]),t._v(" "),n("div",[t._v("软组织：400/40")]),t._v(" "),n("div",[t._v("肺：1500/-600")]),t._v(" "),n("div",[t._v("肝脏：150/90")]),t._v(" "),n("div",[t._v("大脑：80/40")]),t._v(" "),n("p"),t._v(" "),n("div",[t._v("注：实际以图像真实窗口、窗位信息为准")])]),t._v(" "),n("el-collapse-item",{attrs:{title:"更多（More）",name:"More"}},[n("div",{staticClass:"ml-40"},[n("el-collapse",{attrs:{accordion:""},model:{value:t.activeSubNames,callback:function(e){t.activeSubNames=e},expression:"activeSubNames"}},[n("el-collapse-item",{attrs:{title:"标注精度（AnnotationPrecision）",name:"AnnotationPrecision"}},[n("div",[t._v("设置自动标注生成路径的显示精度")]),t._v(" "),n("div",[t._v("精度可调范围为1%~100%，手动标注结果不支持调节。")]),t._v(" "),n("div",[t._v("100%时显示算法生成的所有标注点。")])])],1)],1)])],1)],1)},o=[],a={name:"DCOMHelpInfo",data:function(){return{activeNames:["Scroll"],activeSubNames:[]}}},i=a,c=(n("0843"),n("2877")),s=Object(c["a"])(i,r,o,!1,null,"1a39669b",null);e["default"]=s.exports},fede:function(t,e,n){"use strict";n("da76")}}]);