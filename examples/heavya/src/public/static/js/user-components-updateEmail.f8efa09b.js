(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["user-components-updateEmail"],{"88ba":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{display:"inline-block"}},[r("BaseModal",{attrs:{visible:e.dialog,title:e.title,width:"475px"},on:{"update:visible":function(t){e.dialog=t},close:e.resetForm,cancel:function(t){e.dialog=!1},ok:e.doSubmit}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"88px"}},[r("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[r("el-input",{staticStyle:{width:"320px"},attrs:{"auto-complete":"on"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"验证码",prop:"code"}},[r("el-input",{staticStyle:{width:"160px"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}}),e._v(" "),r("el-button",{staticStyle:{width:"155px"},attrs:{loading:e.codeLoading,disabled:e.isDisabled},on:{click:e.sendCode}},[e._v(e._s(e.buttonName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[r("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:e.form.pass,callback:function(t){e.$set(e.form,"pass",t)},expression:"form.pass"}})],1)],1)],1)],1)},i=[],n=r("2f62"),s=r("4360"),a=r("61f7"),l=r("8de4"),c=r("3786"),m=r("c24f"),u=r("f109");function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t=g(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e){var t=y(e,"string");return"symbol"===d(t)?t:String(t)}function y(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==d(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var h={components:{BaseModal:u["a"]},props:{email:{type:String,required:!0}},data:function(){var e=this,t=function(t,r,o){""===r||null===r?o(new Error("新邮箱不能为空")):r===e.email?o(new Error("新邮箱不能与旧邮箱相同")):Object(a["i"])(r)?o():o(new Error("邮箱格式错误"))};return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},users:{email:"",password:""},codeLoading:!1,buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,message:"当前密码不能为空",trigger:"blur"}],email:[{required:!0,validator:t,trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},computed:p({},Object(n["d"])(["user"])),methods:{sendCode:function(){var e=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中";var t={email:this.form.email,type:2};Object(c["a"])(t).then((function(){e.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),e.codeLoading=!1,e.isDisabled=!0,e.buttonName="".concat(e.time-=1,"秒后重新发送"),e.timer=window.setInterval((function(){e.buttonName="".concat(e.time,"秒后重新发送"),e.time-=1,e.time<0&&(e.buttonName="重新发送",e.time=60,e.isDisabled=!1,window.clearInterval(e.timer))}),1e3)})).catch((function(t){e.resetForm(),e.codeLoading=!1,e.$message({message:t.message,type:"error"})}))}},doSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.loading=!0;var r={password:Object(l["b"])(e.form.pass),email:e.form.email,code:e.form.code,userId:e.user.id};return Object(m["c"])(r).then((function(){e.dialog=!1,e.loading=!1,e.resetForm(),e.$notify({title:"邮箱修改成功",type:"success",duration:1500}),s["a"].dispatch("GetUserInfo").then((function(){}))})).catch((function(t){e.loading=!1,e.$message({message:t.message,type:"error"})})),!0}return!1}))},resetForm:function(){this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},v=h,w=r("2877"),O=Object(w["a"])(v,o,i,!1,null,null,null);t["default"]=O.exports}}]);