(window["webpackJsonp_dubhe_web"]=window["webpackJsonp_dubhe_web"]||[]).push([["cloudServing-components-forms-servingForm","cloudServing-components-servingCallGuide","cloudServing-util"],{2020:function(e,t,n){},2988:function(e,t,n){"use strict";n.r(t),n.d(t,"SERVING_STATUS_ENUM",(function(){return g})),n.d(t,"ONLINE_SERVING_STATUS_MAP",(function(){return h})),n.d(t,"BATCH_SERVING_STATUS_MAP",(function(){return p})),n.d(t,"ONLINE_SERVING_TYPE",(function(){return b})),n.d(t,"serviceTypeMap",(function(){return y})),n.d(t,"map2Array",(function(){return v})),n.d(t,"numFormatter",(function(){return C})),n.d(t,"upload",(function(){return S})),n.d(t,"cpuFormatter",(function(){return P})),n.d(t,"memFormatter",(function(){return O})),n.d(t,"batchServingProgressColor",(function(){return R})),n.d(t,"getPollId",(function(){return L})),n.d(t,"parseObj",(function(){return E}));var o,r,i,a=n("ed08");function l(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}function s(e,t){if(e){if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function d(e,t,n){return t=f(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){var t=m(e,"string");return"symbol"===c(t)?t:String(t)}function m(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==c(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var g={EXCEPTION:"0",IN_DEPLOYMENT:"1",WORKING:"2",STOP:"3",COMPLETED:"4",UNKNOWN:"5"},h=(o={},d(o,g.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),d(o,g.WORKING,{name:"运行中",tagMap:"success"}),d(o,g.STOP,{name:"已停止",tagMap:"info"}),d(o,g.EXCEPTION,{name:"运行失败",tagMap:"danger"}),o),p=(r={},d(r,g.IN_DEPLOYMENT,{name:"部署中",tagMap:""}),d(r,g.WORKING,{name:"运行中",tagMap:""}),d(r,g.STOP,{name:"已停止",tagMap:"info"}),d(r,g.EXCEPTION,{name:"运行失败",tagMap:"danger"}),d(r,g.COMPLETED,{name:"运行完成",tagMap:"success"}),d(r,g.UNKNOWN,{name:"未知",tagMap:"info"}),r),b={HTTP:0,GRPC:1},y=(i={},d(i,b.HTTP,"HTTP 模式"),d(i,b.GRPC,"GRPC 模式"),i);function v(e){var t=[];if("object"!==c(e)||null===e)return t;for(var n=0,o=Object.keys(e);n<o.length;n++){var r=o[n];t.push({name:r,type:e[r]})}return t}function C(e){return e<1e4?"".concat(e):"".concat(Math.round(e/1e3)/10,"万")}function M(e){var t=e.response||e.responseText;try{return JSON.parse(t)}catch(n){return t}}function S(e){var t,n=new XMLHttpRequest,o=new FormData,r=l(e.fileList);try{for(r.s();!(t=r.n()).done;){var i=t.value;o.append(e.uploadName,i,i.name)}}catch(a){r.e(a)}finally{r.f()}return n.upload&&e.onUploadProgress&&(n.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onUploadProgress(t)}),n.onreadystatechange=function(){if(4===n.readyState){var t=M(n);if(n.status<200||n.status>=300){var o=new Error(t.msg||"未知错误");return e.onUploadError(o)}e.onUploadSuccess(t)}},n.open("post",e.requestUrl,!0),n.send(o),n}function P(e,t){return t?("n"===t&&(e/=1e6,t="m"),"m"===t?"".concat(Math.round(10*e)/10,"m"):e+t):"".concat(e,"核")}function O(e,t){return"".concat(Math.round(10*Object(a["qb"])(e,t))/10," Gi")}var R=[{color:"#67c23a",percentage:100}];function L(){return(new Date).getTime()}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"; ";return e instanceof Object?Object.keys(e).filter((function(t){return null!==e[t]||""!==e[t]})).map((function(t){return"".concat(t,": ").concat(e[t])})).join(t):""}},"5d71":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"服务名称",prop:"name"}},[n("el-input",{ref:"nameInput",attrs:{maxlength:"32","show-word-limit":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"服务类型",prop:"type"}},[n("el-radio-group",{on:{change:e.onTypeChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[n("el-radio",{staticClass:"mr-0 w-150",attrs:{border:"",label:0}},[e._v("HTTP 模式")]),e._v(" "),n("el-radio",{staticClass:"w-150",attrs:{border:"",label:1}},[e._v("GRPC 模式")])],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"服务描述",prop:"description"}},[n("el-input",{attrs:{type:"textarea",rows:4,maxlength:"200","show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),n("el-divider"),e._v(" "),e._l(e.modelConfigList,(function(t,o){return n("el-card",{key:t.id,staticClass:"mb-10 ml-120"},[n("ServingModelConfig",{ref:"modelConfig",refInFor:!0,attrs:{"label-width":"120px",deletable:e.modelConfigList.length>=2,config:t,"model-disabled":0!==o,"model-address-map":e.modelBranchIdMap,"release-rate-disabled":1===e.modelConfigList.length,"release-rate-sum-valid":e.releaseRateSumValid,"node-count-valid":e.nodeCountValid},on:{"model-resource-change":e.onModelResourceChange,"model-change":e.onModelChange,"model-version-change":function(n){return e.onModelVersionChange(t.id,n)},"release-rate-change":function(t){return e.onModelReleaseRateChange(t,o)},change:function(t){return e.onModelConfigChange(t,o)},delete:e.onModelConfigDelete}})],1)})),e._v(" "),n("el-button",{staticClass:"ml-120",attrs:{icon:"el-icon-circle-plus-outline",disabled:e.disableAddModelConfig},on:{click:e.addModelConfig}},[e._v("添加模型版本进行灰度发布")])],2)},r=[],i=n("61f7"),a=n("f121"),l=n("2988"),s=n("c844");function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e){return g(e)||m(e)||f(e)||d()}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function m(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function g(e){if(Array.isArray(e))return h(e)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t=v(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=C(e,"string");return"symbol"===u(t)?t:String(t)}function C(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var M={id:null,name:null,type:l["ONLINE_SERVING_TYPE"].HTTP,description:null,modelConfigList:[]},S={modelResource:0,modelId:null,modelBranchId:null,imageName:null,imageTag:null,resourcesPoolType:0,resourcesPoolSpecs:null,resourcesPoolNode:1,releaseRate:100,deployParams:{},useScript:!1,algorithmId:null},P=1,O={name:"ServingForm",components:{ServingModelConfig:s["default"]},data:function(){return{modelConfigList:[],modelBranchIdMap:{},isPresetModel:!1,releaseRateSumValid:!0,nodeCountValid:!0,form:b(b({},M),{},{modelConfigList:[]}),rules:{name:[{required:!0,message:"请输入服务名称",trigger:["blur","change"]},{max:32,message:"长度在 32 个字符以内",trigger:["blur","change"]},{validator:i["q"],trigger:["blur","change"]}],type:[{required:!0,message:"请选择服务类型",trigger:"change"}]}}},computed:{disableAddModelConfig:function(){return this.form.type===l["ONLINE_SERVING_TYPE"].GRPC||this.modelConfigList.length>=2||this.isPresetModel}},methods:{onTypeChange:function(e){e===l["ONLINE_SERVING_TYPE"].GRPC&&this.modelConfigList.length>1&&(this.modelBranchIdMap=y({},this.modelConfigList[0].id,this.modelConfigList[0].modelBranchId),this.modelConfigList.splice(1,this.modelConfigList.length-1),this.modelConfigList.length&&this.$refs.modelConfig[0].updateReleaseRate(100))},onModelResourceChange:function(e){this.modelBranchIdMap={},this.isPresetModel=1===e,this.modelConfigList.splice(1,this.modelConfigList.length-1),this.modelConfigList.length&&this.$refs.modelConfig[0].updateReleaseRate(100)},onModelChange:function(e){for(var t=1;t<this.modelConfigList.length;t+=1)this.$refs.modelConfig[t].updateModel(e);this.modelBranchIdMap={}},onModelVersionChange:function(e,t){this.updateModelAddressMap(e,t)},onModelReleaseRateChange:function(e,t){this.modelConfigList[t].releaseRate=e,2===this.modelConfigList.length&&this.$refs.modelConfig[1-t].updateReleaseRate(100-e),this.validateReleaseRate()},onModelConfigChange:function(e,t){this.modelConfigList[t]=e,this.validateReleaseRate(),this.validateNodeCount()},onModelConfigDelete:function(e){var t=this,n=this.modelConfigList.findIndex((function(t){return t.id===e}));-1!==n&&(this.modelConfigList.splice(n,1),Reflect.deleteProperty(this.modelBranchIdMap,e)),this.$nextTick((function(){1===t.modelConfigList.length?t.$refs.modelConfig[0].updateReleaseRate(100):t.validateReleaseRate()}))},initForm:function(e){var t=this,n=e||Object.create(null);Object.keys(this.form).forEach((function(e){n[e]&&(t.form[e]=n[e])})),this.modelConfigList=c(this.form.modelConfigList)||[],this.modelConfigList.length||this.modelConfigList.push(b({},S)),this.isPresetModel=1===this.modelConfigList[0].modelResource,this.modelConfigList.forEach((function(e){Object.keys(S).forEach((function(t){void 0===e[t]&&(e[t]=S[t])})),e.id=P++,t.modelBranchIdMap[e.id]=e.modelBranchId||void 0})),this.$nextTick((function(){t.clearValidate()}))},resetForm:function(){var e=this;this.form=b(b({},M),{},{modelConfigList:[]}),this.modelBranchIdMap={},this.$nextTick((function(){e.clearValidate()}))},validate:function(e,t){var n=!0;this.$refs.form.validate((function(e){e||(n=!1)})),this.$refs.modelConfig.forEach((function(e){e.validate(null,(function(){n=!1}))})),n=n&&this.releaseRateSumValid&&this.nodeCountValid,n?(this.form.modelConfigList=this.modelConfigList,e&&e(this.form)):t&&t()},clearValidate:function(){this.releaseRateSumValid=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.$refs.form.clearValidate.apply(this,t)},addModelConfig:function(){var e=b(b({},S),{},{id:P++}),t=100;this.modelConfigList.forEach((function(e){t-=e.releaseRate})),e.releaseRate=t>=0?t:0,this.modelConfigList.length&&(e.modelId=this.modelConfigList[0].modelId),this.modelConfigList.push(e)},validateReleaseRate:function(){var e=0;this.modelConfigList.forEach((function(t){e+=t.releaseRate})),this.releaseRateSumValid=100===e},validateNodeCount:function(){var e=this.modelConfigList.reduce((function(e,t){return e+t.resourcesPoolNode}),0);this.nodeCountValid=e<=a["h"].onlineServingNodeSumMax},updateModelAddressMap:function(e,t){this.modelBranchIdMap=b(b({},this.modelBranchIdMap),{},y({},e,t))}}},R=O,L=(n("dc97"),n("2877")),E=Object(L["a"])(R,o,r,!1,null,"2c7892bd",null);t["default"]=E.exports},dc97:function(e,t,n){"use strict";n("2020")}}]);